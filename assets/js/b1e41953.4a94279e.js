"use strict";(self.webpackChunkliangchao_website=self.webpackChunkliangchao_website||[]).push([[3357],{62835:(e,t,r)=>{r.d(t,{A:()=>d});var a=r(96540),n=r(74848);const s={maxWidth:"800px",margin:"60px auto 0",textAlign:"left",padding:"0 20px"},o={fontSize:"2rem",fontWeight:"600",marginBottom:"16px",color:"var(--ifm-color-emphasis-900)"},i={fontSize:"1.1rem",color:"var(--ifm-color-emphasis-700)",lineHeight:1.6,marginBottom:"16px"},l={borderLeft:"4px solid var(--ifm-border-color)",paddingLeft:"16px",color:"var(--ifm-color-emphasis-700)",fontStyle:"italic",lineHeight:1.6,marginBottom:"16px"},c={backgroundColor:"var(--ifm-background-surface-color)",padding:"16px",borderRadius:"12px",overflowX:"auto",border:"1px solid var(--ifm-border-color)",color:"var(--ifm-color-emphasis-800)"},u={fontSize:"1.5rem",fontWeight:"600",marginBottom:"16px",color:"var(--ifm-color-emphasis-900)"};function d({containerStyle:e}){const[t,r]=(0,a.useState)(!1),[d,p]=(0,a.useState)(!1),m="LiangchaoDeng. (2025). smiler488/smiler488.github.io: Digital Plant Phenotyping Platform v25.0 (v25.0.0). Zenodo. https://doi.org/10.5281/zenodo.17544584",h="@software{Deng2025_DPPP_v25,\n  author       = {Deng, Liangchao},\n  title        = {Digital Plant Phenotyping Platform (v25.0)},\n  year         = {2025},\n  publisher    = {Zenodo},\n  doi          = {10.5281/zenodo.17544584},\n  url          = {https://doi.org/10.5281/zenodo.17544584},\n  note         = {[Computer software]}\n}";return(0,n.jsxs)("div",{style:{...s,...e},children:[(0,n.jsx)("h2",{style:o,children:"Citation"}),(0,n.jsxs)("p",{style:i,children:["If you use ",(0,n.jsx)("strong",{children:"Digital Plant Phenotyping Platform v25.0"})," or any of its applications in your research, please cite it as:"]}),(0,n.jsxs)("blockquote",{style:l,children:["LiangchaoDeng. (2025)."," ",(0,n.jsx)("em",{children:"smiler488/smiler488.github.io: Digital Plant Phenotyping Platform v25.0 (v25.0.0)"}),". Zenodo.",(0,n.jsx)("br",{}),(0,n.jsx)("a",{href:"https://doi.org/10.5281/zenodo.17544584",children:"https://doi.org/10.5281/zenodo.17544584"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",gap:"12px"},children:[(0,n.jsx)("button",{type:"button",onClick:async()=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(m);else if("undefined"!=typeof document){const e=document.createElement("textarea");e.value=m,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}r(!0),setTimeout((()=>r(!1)),2e3)}catch{r(!1)}},style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid var(--ifm-color-emphasis-900)",backgroundColor:"var(--ifm-color-emphasis-900)",color:"var(--ifm-color-emphasis-0)",cursor:"pointer",fontSize:"0.95rem",fontWeight:500,transition:"transform 0.15s ease, background-color 0.15s ease"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-primary)",e.currentTarget.style.borderColor="var(--ifm-color-primary)",e.currentTarget.style.transform="translateY(-1px)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.borderColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.transform="translateY(0)"},children:t?"Copied!":"Copy citation"}),(0,n.jsx)("span",{style:{fontSize:"0.9rem",color:t?"var(--ifm-color-success)":"var(--ifm-color-emphasis-600)"},children:t?"Citation copied to clipboard.":"Click to copy APA citation."})]}),(0,n.jsx)("a",{href:"https://doi.org/10.5281/zenodo.17544584",style:{display:"inline-block",marginBottom:"24px"},children:(0,n.jsx)("img",{src:"https://img.shields.io/badge/DOI-10.5281%2Fzenodo.17544584-blue",alt:"DOI badge",style:{height:"28px"}})}),(0,n.jsx)("hr",{style:{border:"none",borderTop:"1px solid var(--ifm-border-color)",marginBottom:"24px"}}),(0,n.jsx)("h3",{style:u,children:"BibTeX citation (Zotero \u2192 File \u2192 Import from Clipboard)"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",gap:"12px"},children:[(0,n.jsx)("button",{type:"button",onClick:async()=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(h);else if("undefined"!=typeof document){const e=document.createElement("textarea");e.value=h,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}p(!0),setTimeout((()=>p(!1)),2e3)}catch{p(!1)}},style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid var(--ifm-color-emphasis-900)",backgroundColor:"var(--ifm-color-emphasis-900)",color:"var(--ifm-color-emphasis-0)",cursor:"pointer",fontSize:"0.95rem",fontWeight:500,transition:"transform 0.15s ease, background-color 0.15s ease"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-primary)",e.currentTarget.style.borderColor="var(--ifm-color-primary)",e.currentTarget.style.transform="translateY(-1px)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.borderColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.transform="translateY(0)"},children:d?"Copied!":"Copy BibTeX"}),(0,n.jsx)("span",{style:{fontSize:"0.9rem",color:d?"var(--ifm-color-success)":"var(--ifm-color-emphasis-600)"},children:d?"BibTeX copied to clipboard. Switch to Zotero and choose Import from Clipboard.":"Click to copy BibTeX to clipboard for Zotero import."})]}),(0,n.jsx)("pre",{style:c,children:(0,n.jsx)("code",{children:h})})]})}},74911:(e,t,r)=>{r.d(t,{B2:()=>l,S:()=>s,dO:()=>i,kh:()=>a,lJ:()=>o,wn:()=>n});const a="https://api.hunyuan.cloud.tencent.com/v1/chat/completions",n="sk-JdwAvFcfyW5ngP2i3cpeB43QrR92gjnRcNzKkMfpcEVu8hlE";function s(){return a}function o(e,t){return{model:t||"hunyuan-lite",messages:[{role:"system",content:[{type:"text",text:"Respond ONLY with strict JSON object. No markdown, no prose."}]},{role:"user",content:[{type:"text",text:(e||"").trim()||"You are a helpful assistant that generates ECharts option JSON based on CSV summaries."}]}],response_format:{type:"json_object"},stream:!1}}function i(e){return Array.isArray(e?.choices)&&e.choices.length>0?e.choices[0].message?.content||"":e?.Response&&Array.isArray(e.Response.Choices)&&e.Response.Choices.length>0?e.Response.Choices[0].Message?.Content||"":"string"==typeof e?e:JSON.stringify(e,null,2)}async function l(e,t,r={}){if("string"==typeof e&&e.startsWith("mock://")){const r=e.slice(7);if("ai-data-visualizer"===r){const e={summary:"Sample analysis: sales grew steadily across quarters, with Q4 showing the highest revenue. Seasonal dips occur in Q2 due to inventory resets.",insights:["Strong upward trend overall; expect ~12% YoY growth.","Product beta overtook alpha in Q3 and maintained the lead.","Recommend stacked area chart to communicate contribution per product."],chart_option:{title:{text:"Mock Revenue Correlation Heatmap",left:"center"},tooltip:{position:"top"},grid:{left:"5%",right:"5%",top:"12%",bottom:"18%"},xAxis:{type:"category",data:["North","South","East","West"],splitArea:{show:!0}},yAxis:{type:"category",data:["Q1","Q2","Q3","Q4"],splitArea:{show:!0}},visualMap:{min:60,max:210,calculable:!0,orient:"horizontal",left:"center",bottom:"4%"},series:[{name:"Revenue",type:"heatmap",label:{show:!0},data:[[0,0,120],[1,0,135],[2,0,150],[3,0,110],[0,1,98],[1,1,142],[2,1,160],[3,1,100],[0,2,160],[1,2,175],[2,2,182],[3,2,138],[0,3,190],[1,3,205],[2,3,210],[3,3,168]]}]}},t={choices:[{message:{content:JSON.stringify(e,null,2)}}]};return{ok:!0,status:200,json:async()=>t,text:async()=>JSON.stringify(t),headers:new Map([["content-type","application/json"]])}}if("journal-selector"===r){const e={overview:{abstract_summary:t?.question?.slice(0,120)||"N/A",alignment_summary:"Mocked response (replace API URL for real results)."},journals:[{journal_name:"Mock Journal of AI",publisher:"Mock Press",discipline_scope:"AI & Data Science",impact_factor_2024:"8.5",jcr_quartile:"Q1",acceptance_rate:"18%",initial_review_weeks:6,oa_type:"Hybrid OA",apc_usd:2400,submission_advice:"Strong alignment with ML/DS topics.",warning_status:"-"}],notes:"This is a mock response generated locally."},r={choices:[{message:{content:JSON.stringify(e,null,2)}}]};return{ok:!0,status:200,json:async()=>r,text:async()=>JSON.stringify(r),headers:new Map([["content-type","application/json"]])}}if("ai-solver"===r){const e=(new Date).toISOString(),r=t?.question||"No question provided",a=t?.model||"hunyuan-lite",n=`${!!t?.imageBase64||!!t?.imageUrl?"Mock Vision Analysis":"Mock Text Analysis"} (model: ${a})\n\nUser question:\n${r}\n\nThis is a mocked response for demo purposes. Replace proxy URL with your real API when ready.`,s={Response:{RequestId:"mock-"+Math.random().toString(36).slice(2),Choices:[{Message:{Content:n}}],Usage:{PromptTokens:128,CompletionTokens:256,TotalTokens:384},Timestamp:e}};return{ok:!0,status:200,json:async()=>s,text:async()=>JSON.stringify(s),headers:new Map([["content-type","application/json"]])}}}return fetch(e,{method:"POST",headers:{"Content-Type":"application/json",...r},body:JSON.stringify(t)})}},99483:(e,t,r)=>{r.r(t),r.d(t,{default:()=>T});var a=r(96540),n=r(34164),s=r(46280),o=r(62835),i=r(74911);const l={appContainer:"appContainer_isI3",heroRow:"heroRow_FJUs",heroTitle:"heroTitle_jqMG",heroDescription:"heroDescription_qcQW",mainGrid:"mainGrid_eMBy",leftColumn:"leftColumn_b8mH",rightColumn:"rightColumn_VP0V",card:"card_Aa6Q",cardHeading:"cardHeading_YYAr",cardTitle:"cardTitle_JA1M",stepBadge:"stepBadge_YLAV",fileInputWrapper:"fileInputWrapper_Aoow",fileInput:"fileInput_NjcX",textArea:"textArea_rFiB",monoArea:"monoArea_wreA",textInput:"textInput_FrIQ",fieldGroup:"fieldGroup_Yrn0",fieldLabel:"fieldLabel_Uiov",checkboxRow:"checkboxRow_AQvQ",metaText:"metaText_s1tu",statusBadge:"statusBadge_N3J_","status--muted":"status--muted_RVCL","status--info":"status--info_KhHG","status--success":"status--success_RQIz","status--warning":"status--warning_b68s","status--danger":"status--danger_Cr5j",tableScroll:"tableScroll_BA0F",previewTable:"previewTable_j082",insightList:"insightList_cBGD",errorText:"errorText_LRKa",chartShell:"chartShell_qU3U",chartContainer:"chartContainer_up7U",codeBlock:"codeBlock_JSKd"};var c=r(74848);const u=40,d=1e4,p=8e3,m=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc948","#b07aa1","#ff9da7","#9c755f","#bab0ab"],h={doughnut:"pie",donut:"pie",area:"line",stackedarea:"line",horizontalbar:"bar",verticalbar:"bar"},g=["line","bar","scatter","pie","radar","heatmap","funnel","gauge","treemap","sankey","boxplot"],y="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js";let f=null;const x="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js";let b=null;function v(e){if(!e)return null;const t=function(e){if(!e)return"";let t=e.trim();return t.startsWith("```")&&(t=t.replace(/^```(?:json)?/i,"").replace(/```$/,"").trim()),t}(e);try{return JSON.parse(t)}catch{const e=A(t);if(e)try{return JSON.parse(e)}catch{}const r=function(e){if(!e)return null;const t=String(e);let r=!1,a=!1,n=0,s=-1;for(let o=0;o<t.length;o+=1){const e=t[o];if(r)a?a=!1:"\\"===e?a=!0:'"'===e&&(r=!1);else if('"'!==e)if("{"!==e){if("}"===e&&n>0&&(n-=1,0===n&&-1!==s))return t.slice(s,o+1)}else 0===n&&(s=o),n+=1;else r=!0,a=!1}return null}(t);if(r)try{return JSON.parse(r)}catch{const e=A(r);if(e)try{return JSON.parse(e)}catch{}}return null}}function A(e){if(!e)return null;let t=e;t=t.replace(/[\u201C\u201D]/g,'"').replace(/[\u2018\u2019]/g,"'").replace(/\bTrue\b/g,"true").replace(/\bFalse\b/g,"false").replace(/\bNone\b/g,"null"),t=t.replace(/(^|\n)\s*```(?:json)?[\s\S]*?\n/g,""),t=t.replace(/(^|\n)\s*```\s*$/g,""),t=t.replace(/(^|\n)\s*Response:?/gi,"$1"),t=t.replace(/([{,\s])'([^'"]+?)'\s*:/g,'$1"$2":'),t=t.replace(/:\s*'([^'"]*?)'/g,':"$1"'),t=t.replace(/,\s*([}\]])/g,"$1");const r=(t.match(/{/g)||[]).length-(t.match(/}/g)||[]).length;return r>0?t+="}".repeat(r):r<0&&(t=t.replace(/}{1,}$/,"")),t}function w({datasetSummary:e,goal:t,mapping:r}){const a=e&&e.length>0?e:"Dataset summary missing. Ask the user for data.",n=t&&t.trim().length>0?t.trim():"Highlight the most actionable trend and propose the best chart.";return["You are an expert data scientist that returns high quality **ECharts** visualizations.","Instructions:","- Use the dataset summary below (tabular, tidy rows).","- Choose the most expressive chart type supported by Apache ECharts (line, bar, scatter, pie, radar, heatmap, sankey, etc.). Heatmaps are encouraged for correlation matrices.","- Respond with strict JSON only. Start with { and end with }. No Markdown or explanations:","  {",'    "summary": "<2-3 sentence natural-language overview>",','    "insights": ["<bullet insight 1>", "<bullet insight 2>", "..."],','    "chart_option": { /* valid ECharts option */ }',"  }","- The `chart_option` must be a valid ECharts option object (title/tooltip/grid/xAxis/yAxis/visualMap/series/etc).","- Include axes labels, legends, tooltips, and visualMap (when using heatmap or continuous color scales).","- Keep series arrays short (<=6) and align data lengths with category axes.","- Never include functions or comments in the JSON.",'- If the goal mentions ANOVA/Tukey or group letters, return an additional field `tukey_letters` as a JSON object mapping each category name (x-axis label) to its letter(s), e.g., {"Treatment_A":"a","Treatment_B":"ab"}.','- Do NOT create a second series for Standard Error. If uncertainty must be represented, return an `error_bars` array like [{"name":"Treatment_A","low":2450,"high":2550}] and the app will render whiskers; letters must be TEXT labels only.',"- If the goal requests a correlation heatmap, build a rectangular heatmap using [xIndex, yIndex, value] tuples.",r&&(r.xField||r.yField||r.groupField)?`Field mapping: x=${r.xField||"auto"}, y=${r.yField||"auto"}, group=${r.groupField||"none"}, agg=${r.agg||"mean"}, error=${r.errorMetric||"none"}, multi=${r.multiCharts?"true":"false"}`:"",`User goal: ${n}`,"Dataset summary (JSON):",a].join("\n")}function j(e,t){if(!e&&""!==e)return[];const r=[];let a="",n=!1;for(let s=0;s<e.length;s+=1){const o=e[s];'"'!==o?n||o!==t?a+=o:(r.push(a.trim()),a=""):n&&'"'===e[s+1]?(a+='"',s+=1):n=!n}return r.push(a.trim()),r.map((e=>e.replace(/^"|"$/g,"")))}function S(e){if(!e)return null;const t=e.replace(/\r\n/g,"\n").trim();if(!t)return null;const r=t.split("\n").filter((e=>e.trim().length>0));if(0===r.length)return null;const a=function(e){const t=Array.isArray(e)?e.join("\n"):e||"";return t.includes("\t")?"\t":(t.match(/,/g)||[]).length>=(t.match(/;/g)||[]).length?",":";"}([r[0],r[1]||""]),n=j(r[0],a).map(((e,t)=>e&&e.trim()?e.trim():`Column ${t+1}`)),s=[],o=[],i=n.map((()=>new Map));for(let m=1;m<r.length;m+=1){const e=j(r[m],a),t={};n.forEach(((r,a)=>{const n=void 0!==e[a]?e[a].trim():"";if(t[r]=n,n&&n.length>0){const e=i[a];e.set(n,(e.get(n)||0)+1)}})),s.length<u&&s.push(t),o.length<d&&o.push(t)}const l=n.map((e=>{const t=s.map((t=>t[e])).filter((e=>N(e))).length;return(s.length>0?t/s.length:0)>=.6?e:null})).filter(Boolean),c=n.reduce(((e,t,r)=>{const a=i[r],n=Array.from(a.entries()).sort(((e,t)=>t[1]-e[1])).slice(0,8).map((([e,t])=>({value:e,count:t})));return e[t]={unique_count:a.size,top_values:n},e}),{}),p=n.map(((e,t)=>({header:e,idx:t}))).filter((({header:e})=>!l.includes(e))).flatMap((({idx:e})=>(c[n[e]]?.top_values||[]).map((e=>e.value)))).filter(((e,t,r)=>e&&r.indexOf(e)===t)).slice(0,40);return{headers:n,sampleRows:s,rows:o,delimiter:a,rowCount:Math.max(r.length-1,s.length),numericHints:l,valueStats:c,categoryHints:p}}function N(e){if(null==e)return!1;const t=String(e).trim();if(!t)return!1;const r=t.replace(/,/g,"").replace(/%$/,"").replace(/^\((.*)\)$/,"-$1");return!Number.isNaN(Number(r))}function C(e,t={}){if(!e||"object"!=typeof e)return null;const r={color:Array.isArray(e.color)&&e.color.length>0?e.color:m,tooltip:e.tooltip||{trigger:"axis"},...e},a={xCategories:null,yCategories:null,min:1/0,max:-1/0},n=new Set;t&&"object"==typeof t&&(t.letters&&"object"==typeof t.letters&&Object.keys(t.letters).forEach((e=>{null!=e&&n.add(String(e))})),Array.isArray(t.errorBars)&&t.errorBars.forEach((e=>{e&&void 0!==e.name&&null!==e.name&&n.add(String(e.name))})),Array.isArray(t.categoryHints)&&t.categoryHints.forEach((e=>{null!=e&&n.add(String(e))})));const s=Array.isArray(r.series)?r.series:r.series?[r.series]:[];if(0===s.length)return null;r.series=s.map(((e,t)=>{const r=_(e.type,0===t?"line":e.type);let n={name:e.name||e.label||`Series ${t+1}`,...e,type:r};if("pie"!==r||n.radius||(n.radius=["40%","70%"]),"heatmap"===r){const e=function(e){const t=Array.isArray(e)?e:[],r=new Map,a=new Map,n=[],s=[],o=[];let i=1/0,l=-1/0;const c=(e,t,r)=>{if(null==e)return null;if("number"==typeof e&&Number.isFinite(e))return e;const a=String(e);if(t.has(a))return t.get(a);const n=r.length;return r.push(a),t.set(a,n),n};return t.forEach((e=>{let t,u,d;if(Array.isArray(e)&&e.length>=3)[t,u,d]=e;else{if(!e||"object"!=typeof e)return;t=e.x??e.col??e.column??e.column_name??e.columnName??e.i??e.j,u=e.y??e.row??e.index??e.row_name??e.rowName??e.k??e.l,d=e.value??e.v??e.score??e.z??e.correlation}if(null==d||Number.isNaN(Number(d)))return;const p=Number(d),m=c(t,r,n),h=c(u,a,s);null!=m&&null!=h&&(o.push([Number(m),Number(h),p]),p<i&&(i=p),p>l&&(l=p))})),{data:o,xCategories:n.length>0?n:null,yCategories:s.length>0?s:null,valueRange:o.length>0?{min:i,max:l}:null}}(n.data);n={...n,data:e.data},n.label?void 0===n.label.show&&(n.label={...n.label,show:e.data.length<=250}):n.label={show:e.data.length<=250},n.label={...n.label,formatter:e=>{const t=Array.isArray(e?.value)?e.value[2]:e?.value,r=Number(t);return Number.isFinite(r)?r.toFixed(2):""}},n.emphasis||(n.emphasis={itemStyle:{shadowBlur:10,shadowColor:"rgba(0,0,0,0.4)"}}),e.xCategories&&!a.xCategories&&(a.xCategories=e.xCategories),e.yCategories&&!a.yCategories&&(a.yCategories=e.yCategories),e.valueRange&&(a.min=Math.min(a.min,e.valueRange.min),a.max=Math.max(a.max,e.valueRange.max))}return n})),!r.legend&&r.series.some((e=>!!e.name))&&(r.legend={top:"bottom"});r.series.some((e=>!["pie","funnel","gauge","treemap","sankey"].includes(e.type)))&&!r.grid&&(r.grid={left:"6%",right:"4%",top:"8%",bottom:"10%",containLabel:!0});const o=n.size>0?Array.from(n):null;return a.xCategories?r.xAxis=M(r.xAxis,a.xCategories):o&&(r.xAxis=M(r.xAxis,o,{merge:!0})),a.yCategories&&(r.yAxis=M(r.yAxis,a.yCategories)),a.min===1/0||void 0!==r.visualMap&&null!==r.visualMap||(r.visualMap={min:a.min,max:a.max,calculable:!0,orient:"horizontal",left:"center",bottom:"5%"}),Array.isArray(r.series)&&(r.series=r.series.filter((e=>{const t=e&&(e.name||e.label)?String(e.name||e.label).toLowerCase():"";return!/standard\s*error|std\s*error|\bse\b/.test(t)}))),r}function k(e){if(!e||"object"!=typeof e)return null;const t=e.data||e.chartData;if(!t)return null;const r=Array.isArray(t.datasets)?t.datasets:[],a=Array.isArray(t.labels)?t.labels:Array.from({length:r[0]?.data?.length||0},((e,t)=>`Item ${t+1}`)),n=_(e.type||e.chartType,1===r.length?"line":"bar");return"pie"===n?function(e,t){const r=t[0]?.data||[],a=e.map(((e,t)=>({name:e||`Slice ${t+1}`,value:r[t]??0})));return{color:m,tooltip:{trigger:"item"},legend:{top:"bottom"},series:[{type:"pie",radius:["40%","70%"],data:a,emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.2)"}}}]}}(a,r):function(e,t,r,a={}){const n="y"===a?.indexAxis,s=n?"yAxis":"xAxis",o=n?"xAxis":"yAxis";return{color:m,tooltip:{trigger:"axis"},legend:{top:"bottom"},grid:{left:"4%",right:"3%",bottom:"8%",containLabel:!0},[s]:{type:"category",data:t},[o]:{type:"value"},series:r.map(((t,r)=>({name:t.label||`Series ${r+1}`,type:e,smooth:"line"===e,data:t.data||[],emphasis:{focus:"series"}})))}}(n,a,r,e.options)}function _(e,t="line"){const r="string"==typeof e?e.toLowerCase().trim():"",a=h[r]||r;return a&&g.includes(a)?a:t}function M(e,t,{merge:r=!1}={}){if(!t||0===t.length)return e||{type:"category"};if(Array.isArray(e)){const a=e.length>0?e.map((e=>({...e}))):[{}];return a[0]?(a[0].type||(a[0].type="category"),a[0].data&&0!==a[0].data.length?r&&(a[0].data=$(a[0].data,t)):a[0].data=t):a[0]={type:"category",data:t},a}const a=e&&"object"==typeof e?{...e}:{type:"category"};return a.type||(a.type="category"),a.data&&0!==a.data.length?r&&(a.data=$(a.data,t)):a.data=t,a}function $(e,t){const r=Array.isArray(e)?e.map((e=>null!=e?String(e):e)):[],a=new Set(r);return t.forEach((e=>{const t=null!=e?String(e):e;null==t||a.has(t)||(r.push(e),a.add(t))})),r}function I(e,t){try{if(!e||!Array.isArray(t)||0===t.length)return e;const r=Array.isArray(e.xAxis)?e.xAxis[0]:e.xAxis,a=Array.isArray(e.yAxis)?e.yAxis[0]:e.yAxis,n=r&&Array.isArray(r.data)?r.data:null,s=Array.isArray(e.series)&&e.series[0]&&"bar"===String(e.series[0].type).toLowerCase()&&(!r||"category"===r.type)&&(!a||"category"!==a.type);if(!n||!s)return e;const o=new Map((n||[]).map(((e,t)=>[String(e),t]))),i=[];for(const e of t){if(!e||null==e.low||null==e.high||null==e.name)continue;const t=o.get(String(e.name));if(null==t)continue;const r=Number(e.low),a=Number(e.high);Number.isFinite(r)&&Number.isFinite(a)&&i.push([t,r,a])}if(0===i.length)return e;const l={name:"SE whiskers",type:"custom",tooltip:{show:!1},renderItem:function(e,t){if(!t||"function"!=typeof t.coord||"function"!=typeof t.value)return null;const r=t.value(0),a=t.value(1),n=t.value(2);if(!Number.isFinite(r)||!Number.isFinite(a)||!Number.isFinite(n))return null;const s=t.coord([r,0]),o=t.coord([r,a]),i=t.coord([r,n]);if(!s||!o||!i)return null;const l=s[0],c=o[1],u=i[1],d="function"==typeof t.size?t.size([1,0])[0]:10,p=Math.max(6,Math.min(12,.25*d||8)),m=t.style({stroke:"var(--ifm-color-emphasis-800)",fill:null,lineWidth:1.2});return{type:"group",children:[{type:"line",shape:{x1:l,y1:c,x2:l,y2:u},style:m},{type:"line",shape:{x1:l-p,y1:c,x2:l+p,y2:c},style:m},{type:"line",shape:{x1:l-p,y1:u,x2:l+p,y2:u},style:m}]}},encode:{x:0,y:[1,2]},z:10,data:i};return{...e,series:Array.isArray(e.series)?[...e.series,l]:[l]}}catch(r){return e}}function T(){const e=(0,a.useMemo)(i.S,[]),[t,r]=(0,a.useState)(!0),[d,m]=(0,a.useState)(""),[h,g]=(0,a.useState)(""),[A,j]=(0,a.useState)("hunyuan-t1-latest"),[_,M]=(0,a.useState)("Highlight the clearest trend, choose the best chart for stakeholders, and annotate anomalies."),[$,T]=(0,a.useState)(null),[F,z]=(0,a.useState)(""),[L,O]=(0,a.useState)(null),[B,R]=(0,a.useState)([]),[P,H]=(0,a.useState)(""),[J,D]=(0,a.useState)({}),[X,q]=(0,a.useState)({text:"Upload a CSV/TSV to get started.",tone:"muted"}),[V,G]=(0,a.useState)(!1),[W,U]=(0,a.useState)(""),[Y,Q]=(0,a.useState)([]),[K,Z]=(0,a.useState)(null),[ee,te]=(0,a.useState)(""),[re,ae]=(0,a.useState)(""),ne=(0,a.useRef)(null),se=(0,a.useRef)(null),[oe,ie]=(0,a.useState)(!1),[le,ce]=(0,a.useState)(""),[ue,de]=(0,a.useState)(""),[pe,me]=(0,a.useState)(""),[he,ge]=(0,a.useState)(""),[ye,fe]=(0,a.useState)("mean"),[xe,be]=(0,a.useState)("none"),[ve,Ae]=(0,a.useState)(!1),we=(0,a.useMemo)((()=>L||S(F)),[L,F]),je=(0,a.useMemo)((()=>function(e,t){if(!t)return"";const r={file:e?{name:e.name,size:e.size,type:e.type}:null,stats:{estimated_rows:t.rowCount,column_count:t.headers.length,delimiter:"\t"===t.delimiter?"tab":t.delimiter,mostly_numeric_columns:t.numericHints,category_hint_examples:t.categoryHints||[]},columns:t.headers,sample_rows:t.sampleRows.slice(0,8),column_profiles:t.headers.map((e=>({name:e,mostly_numeric:t.numericHints.includes(e),unique_values:t.valueStats?.[e]?.unique_count??0,top_values:(t.valueStats?.[e]?.top_values||[]).slice(0,5)})))};let a=JSON.stringify(r,null,2);return a.length>p&&(a=`${a.slice(0,p)}\n... (truncated for token safety)`),a}($,we)),[$,we]),Se=(e,t="info")=>{q({text:e,tone:t})};async function Ne(e){const t=v(e);if(!t){const e=E(we,_,{xField:ue,yField:pe,groupField:he,agg:ye,errorMetric:xe,multiCharts:ve});if(e&&e.option)return U(e.summary||"Offline visualization."),Q(e.insights||[]),Z(e.option),void ae(JSON.stringify({mode:"offline",chart_option:e.option},null,2));throw new Error("AI response was not valid JSON.")}try{ae(JSON.stringify(t,null,2))}catch(n){ae(e)}U(t.summary||"AI did not return a summary."),Q(Array.isArray(t.insights)?t.insights:[]);const r=t&&(t.tukey_letters||t.tukeyLetters||t.letters||t.annotations_letters)||null;let a=C(t.chart_option||t.chartOption||t.option||k(t.chart_config||t.chartConfig),{letters:r,errorBars:t.error_bars,categoryHints:we?.categoryHints||[]});a?(Array.isArray(t.error_bars)&&t.error_bars.length>0&&(a=I(a,t.error_bars)),r&&"object"==typeof r&&(a=function(e,t){try{if(!e||!t||"object"!=typeof t)return e;if(0===Object.keys(t).length)return e;const r=Array.isArray(e.series)?e.series.map((e=>({...e}))):[];if(0===r.length)return e;const a=r.findIndex((e=>"bar"===String(e?.type||"").toLowerCase()));if(-1===a)return e;const n={...r[a]},s=n.label||{};return n.label={show:!0,position:"top",color:"var(--ifm-color-emphasis-900)",fontSize:14,fontWeight:"600",backgroundColor:"rgba(255,255,255,0.0)",padding:[0,0,4,0],offset:[0,-4],...s,formatter:e=>t&&t[e.name]||""},delete n.markPoint,delete n.markLine,r[a]=n,{...e,series:r}}catch(n){return e}}(a,r)),Z(a)):te("AI response missing a valid chart_option; please retry with clearer instructions.")}function Ce(e,t){const r=t.slice(0,u),a=e.reduce(((e,r)=>{const a=new Map;t.forEach((e=>{const t=e[r];t&&String(t).length>0&&a.set(t,(a.get(t)||0)+1)}));const n=Array.from(a.entries()).sort(((e,t)=>t[1]-e[1])).slice(0,8).map((([e,t])=>({value:e,count:t})));return e[r]={unique_count:a.size,top_values:n},e}),{}),n=e.filter((e=>{const t=r.map((t=>t[e])).filter((e=>N(e))).length;return(r.length>0?t/r.length:0)>=.6})),s=e.filter((e=>!n.includes(e))).flatMap((e=>(a[e]?.top_values||[]).map((e=>e.value)))).filter(((e,t,r)=>e&&r.indexOf(e)===t)).slice(0,40);return{headers:e,sampleRows:r,rows:t,delimiter:",",rowCount:t.length,numericHints:n,valueStats:a,categoryHints:s}}(0,a.useEffect)((()=>{let e=!1;return async function(){if(ne.current&&K){ce("");try{const t=await("undefined"==typeof window?Promise.resolve(null):window.echarts?Promise.resolve(window.echarts):f||(f=new Promise(((e,t)=>{const r=document.querySelector('script[data-echarts-loader="true"]');if(r)return window.echarts?void e(window.echarts):(r.addEventListener("load",(()=>e(window.echarts))),void r.addEventListener("error",(e=>t(e))));const a=document.createElement("script");a.src=y,a.async=!0,a.dataset.echartsLoader="true",a.onload=()=>e(window.echarts),a.onerror=e=>t(e||new Error("Failed to load ECharts script.")),document.body.appendChild(a)})),f));if(!t||!ne.current||e)return;se.current||(se.current=t.init(ne.current)),se.current.setOption(K,!0),se.current.resize(),ie(!0)}catch(t){ce(t?.message||"Chart rendering failed."),ie(!1)}}else ie(!1)}(),()=>{e=!0,se.current&&(se.current.dispose(),se.current=null)}}),[K]),(0,a.useEffect)((()=>{if("undefined"==typeof window)return;const e=()=>{se.current&&se.current.resize()};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const ke=Math.min(u,we?.sampleRows?.length||0);return(0,c.jsx)(s.A,{title:"AI Data Visualizer",children:(0,c.jsxs)("main",{className:l.appContainer,children:[(0,c.jsxs)("div",{className:l.heroRow,children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h1",{className:l.heroTitle,children:"AI Data Visualizer"}),(0,c.jsx)("p",{className:l.heroDescription,children:"Upload a CSV/TSV file, describe what you want to learn, and let the AI suggest an interactive ECharts visualization plus insights. Everything runs in your browser \u2014 no server-side storage."})]}),(0,c.jsx)("a",{className:"button button--secondary",href:"/docs/tutorial-apps/ai-data-visualizer-tutorial",children:"Tutorial"})]}),(0,c.jsxs)("div",{className:l.mainGrid,children:[(0,c.jsxs)("div",{className:l.leftColumn,children:[(0,c.jsxs)("section",{className:l.card,children:[(0,c.jsxs)("div",{className:l.cardHeading,children:[(0,c.jsx)("h3",{className:l.cardTitle,children:"Upload data"}),(0,c.jsx)("span",{className:l.stepBadge,children:"Step 1"})]}),(0,c.jsx)("label",{className:l.fileInputWrapper,children:(0,c.jsx)("input",{className:l.fileInput,type:"file",accept:".csv,.tsv,.xlsx,.xls,.json,text/csv,text/tab-separated-values,application/json,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:async function(e){const t=e.target.files&&e.target.files[0];if(!t)return T(null),z(""),O(null),R([]),H(""),void D({});T({name:t.name,size:t.size,type:t.type||"text/csv"}),Se("Reading file\u2026","info");const r=(t.name||"").toLowerCase();if(r.endsWith(".xlsx")||r.endsWith(".xls")){try{const e=await("undefined"==typeof window?Promise.resolve(null):window.XLSX?Promise.resolve(window.XLSX):b||(b=new Promise(((e,t)=>{const r=document.querySelector('script[data-xlsx-loader="true"]');if(r)return window.XLSX?void e(window.XLSX):(r.addEventListener("load",(()=>e(window.XLSX))),void r.addEventListener("error",(e=>t(e))));const a=document.createElement("script");a.src=x,a.async=!0,a.dataset.xlsxLoader="true",a.onload=()=>e(window.XLSX),a.onerror=e=>t(e||new Error("Failed to load XLSX script.")),document.body.appendChild(a)})),b)),r=new FileReader;r.onload=t=>{try{const r=new Uint8Array(t.target?.result||new ArrayBuffer(0)),a=e.read(r,{type:"array"}),n=a.SheetNames||[],s={};n.forEach((t=>{const r=a.Sheets[t],n=e.utils.sheet_to_json(r,{header:1}),o=(n[0]||[]).map(((e,t)=>e&&String(e).trim()||`Column ${t+1}`)),i=n.slice(1).map((e=>{const t={};return o.forEach(((r,a)=>{t[r]=null!=e[a]?String(e[a]):""})),t}));s[t]=Ce(o,i)}));const o=n[0]||"";D(s),R(n),H(o),O(s[o]||null),Se("File ready. Configure the analysis prompt.","success")}catch(r){Se("Failed to parse Excel file.","danger")}},r.onerror=()=>Se("Failed to read file. Please try again.","danger"),r.readAsArrayBuffer(t)}catch(n){Se("Failed to load Excel parser.","danger")}return}const a=new FileReader;a.onload=e=>{const a=e.target?.result||"";if(r.endsWith(".json")||"application/json"===t.type)try{const e=function(e){if(Array.isArray(e)){const t=e.slice(0,200),r=new Set;t.forEach((e=>{e&&"object"==typeof e&&Object.keys(e).forEach((e=>r.add(e)))}));const a=Array.from(r),n=e.map((e=>{const t={};return a.forEach((r=>{const a=e&&null!=e[r]?e[r]:"";t[r]=String(a)})),t}));return Ce(a,n)}if(e&&"object"==typeof e){if(Array.isArray(e.data)&&Array.isArray(e.columns)){const t=e.columns.map(((e,t)=>e&&String(e).trim()||`Column ${t+1}`)),r=e.data.map((e=>{const r={};return t.forEach(((t,a)=>{r[t]=null!=e[a]?String(e[a]):""})),r}));return Ce(t,r)}if(Array.isArray(e.rows)&&Array.isArray(e.headers)){const t=e.headers.map(((e,t)=>e&&String(e).trim()||`Column ${t+1}`)),r=e.rows.map((e=>{const r={};return t.forEach((t=>{r[t]=e&&null!=e[t]?String(e[t]):""})),r}));return Ce(t,r)}}const t=JSON.stringify(e);return S(t)||null}(JSON.parse(a));O(e),z(""),Se("File ready. Configure the analysis prompt.","success")}catch(n){z(a),O(null),Se("JSON parse failed. Treating as text.","warning")}else O(null),z(a),Se("File ready. Configure the analysis prompt.","success")},a.onerror=()=>{Se("Failed to read file. Please try again.","danger")},a.readAsText(t)}})}),B&&B.length>1&&(0,c.jsxs)("label",{className:l.fieldLabel,children:["Excel sheet",(0,c.jsx)("select",{className:l.textInput,value:P,onChange:e=>{const t=e.target.value;H(t),O(J[t]||null)},children:B.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))})]}),$&&(0,c.jsxs)("p",{className:l.metaText,children:[(0,c.jsx)("strong",{children:$.name})," \u2022 ",($.size/1024).toFixed(1)," KB"]}),X?.text&&(0,c.jsx)("div",{className:(0,n.A)(l.statusBadge,l[`status--${X.tone||"info"}`]),children:X.text})]}),(0,c.jsxs)("section",{className:l.card,children:[(0,c.jsxs)("div",{className:l.cardHeading,children:[(0,c.jsx)("h3",{className:l.cardTitle,children:"Analysis goal & API"}),(0,c.jsx)("span",{className:l.stepBadge,children:"Step 2"})]}),(0,c.jsx)("textarea",{className:l.textArea,value:_,onChange:e=>M(e.target.value),placeholder:"Tell the AI what kind of pattern or story to highlight."}),we&&(0,c.jsxs)("div",{className:l.fieldGroup,children:[(0,c.jsxs)("label",{className:l.fieldLabel,children:["X Field",(0,c.jsxs)("select",{className:l.textInput,value:ue,onChange:e=>de(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"Auto"}),we.headers.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))]})]}),(0,c.jsxs)("label",{className:l.fieldLabel,children:["Y Field",(0,c.jsxs)("select",{className:l.textInput,value:pe,onChange:e=>me(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"Auto"}),we.headers.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))]})]}),(0,c.jsxs)("label",{className:l.fieldLabel,children:["Group",(0,c.jsxs)("select",{className:l.textInput,value:he,onChange:e=>ge(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"None"}),we.headers.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))]})]}),(0,c.jsxs)("label",{className:l.fieldLabel,children:["Aggregation",(0,c.jsxs)("select",{className:l.textInput,value:ye,onChange:e=>fe(e.target.value),children:[(0,c.jsx)("option",{value:"mean",children:"mean"}),(0,c.jsx)("option",{value:"median",children:"median"}),(0,c.jsx)("option",{value:"sum",children:"sum"}),(0,c.jsx)("option",{value:"count",children:"count"})]})]}),(0,c.jsxs)("label",{className:l.fieldLabel,children:["Error Bars",(0,c.jsxs)("select",{className:l.textInput,value:xe,onChange:e=>be(e.target.value),children:[(0,c.jsx)("option",{value:"none",children:"none"}),(0,c.jsx)("option",{value:"stddev",children:"stddev"}),(0,c.jsx)("option",{value:"se",children:"se"})]})]}),(0,c.jsxs)("label",{className:l.checkboxRow,children:[(0,c.jsx)("input",{type:"checkbox",checked:ve,onChange:e=>Ae(e.target.checked)}),"Side-by-side multi charts"]}),(0,c.jsx)("button",{className:"button button--secondary margin-top--sm",onClick:()=>{const e=E(we,_,{xField:ue,yField:pe,groupField:he,agg:ye,errorMetric:xe,multiCharts:ve});e&&e.option&&(U(e.summary||"Offline visualization."),Q(e.insights||[]),Z(e.option),ae(JSON.stringify({mode:"offline-mapping",chart_option:e.option},null,2)))},disabled:!we,children:"Apply field mapping"})]}),(0,c.jsxs)("label",{className:l.fieldLabel,children:["Model",(0,c.jsx)("input",{className:l.textInput,value:A,onChange:e=>j(e.target.value),placeholder:"hunyuan-t1-latest"})]}),(0,c.jsx)("button",{className:"button button--primary margin-top--sm",onClick:async function(){if(we){G(!0),Se("Building prompt\u2026","info"),te(""),ce(""),ae(""),U(""),Q([]),Z(null),ie(!1);try{const r=w({datasetSummary:je||"No dataset summary available.",goal:_,mapping:{xField:ue,yField:pe,groupField:he,agg:ye,errorMetric:xe,multiCharts:ve}}),a=t?e:d&&d.trim()&&/^https?:\/\//.test(d.trim())?d.trim():"mock://ai-data-visualizer",n=a===e;Se("Calling AI\u2026","info");let s={question:r,model:A},o={};if(a===i.kh)s=(0,i.lJ)(r,A),o={Authorization:`Bearer ${i.wn}`};else if(!t&&h.trim()){const e=h.trim();o={Authorization:e.toLowerCase().startsWith("bearer ")?e:`Bearer ${e}`},s.response_format={type:"json_object"}}const l=await(0,i.B2)(a,s,o);if(!l.ok){const e=await l.text().catch((()=>""));if(n&&[403,404,405].includes(l.status)){const e=await(0,i.B2)("mock://ai-data-visualizer",s),t=await e.json(),r=(0,i.dO)(t);return await Ne(r),void Se("Mock response shown (default endpoint unavailable).","warning")}throw new Error(e||`API call failed (${l.status})`)}const c=await l.json().catch((async()=>({raw:await l.text()}))),u=(0,i.dO)(c);await Ne(u),Se("Visualization ready!","success")}catch(r){try{let e={question:w({datasetSummary:je||"No dataset summary available.",goal:_,mapping:{xField:ue,yField:pe,groupField:he,agg:ye,errorMetric:xe,multiCharts:ve}}),model:A};const t=await(0,i.B2)("mock://ai-data-visualizer",e),r=await t.json(),a=(0,i.dO)(r);await Ne(a),Se("Mock response shown (AI call failed; using local).","warning")}catch(a){const e=E(we,_,{xField:ue,yField:pe,groupField:he,agg:ye,errorMetric:xe,multiCharts:ve});e&&e.option?(U(e.summary||"Offline visualization."),Q(e.insights||[]),Z(e.option),ae(JSON.stringify({mode:"offline",chart_option:e.option},null,2)),Se("AI failed; offline visualization generated.","warning")):(te(r?.message||"AI call failed."),Se("Analysis failed.","danger"))}}finally{G(!1)}}else Se("Please upload a CSV or TSV file first.","warning")},disabled:V||!we||!1,children:V?"Analyzing\u2026":"Generate visualization"}),(0,c.jsxs)("label",{className:l.checkboxRow,children:[(0,c.jsx)("input",{type:"checkbox",checked:t,onChange:e=>r(e.target.checked)}),"Use built-in HunYuan endpoint"]}),!t&&(0,c.jsxs)("div",{className:l.fieldGroup,children:[(0,c.jsxs)("label",{className:l.fieldLabel,children:["API URL",(0,c.jsx)("input",{type:"text",className:l.textInput,value:d,onChange:e=>m(e.target.value),placeholder:"https://your-proxy-endpoint/v1/chat/completions"})]}),(0,c.jsxs)("label",{className:l.fieldLabel,children:["Bearer token",(0,c.jsx)("input",{type:"password",className:l.textInput,value:h,onChange:e=>g(e.target.value),placeholder:"sk-..."})]}),(0,c.jsx)("p",{className:l.metaText,children:"Keys never leave your browser. Leave blank to use the offline mock endpoint."})]})]}),(0,c.jsxs)("section",{className:l.card,children:[(0,c.jsx)("div",{className:l.cardHeading,children:(0,c.jsx)("h3",{className:l.cardTitle,children:"Dataset summary sent to AI"})}),(0,c.jsx)("textarea",{className:(0,n.A)(l.textArea,l.monoArea),value:je,readOnly:!0})]})]}),(0,c.jsxs)("div",{className:l.rightColumn,children:[(0,c.jsxs)("section",{className:l.card,children:[(0,c.jsx)("div",{className:l.cardHeading,children:(0,c.jsxs)("h3",{className:l.cardTitle,children:["Preview (first ",ke," rows)"]})}),we?(0,c.jsx)("div",{className:l.tableScroll,children:(0,c.jsxs)("table",{className:l.previewTable,children:[(0,c.jsx)("thead",{children:(0,c.jsx)("tr",{children:we.headers.map((e=>(0,c.jsx)("th",{children:e},e)))})}),(0,c.jsx)("tbody",{children:we.sampleRows.slice(0,10).map(((e,t)=>(0,c.jsx)("tr",{children:we.headers.map((t=>(0,c.jsx)("td",{children:e[t]||"-"},t)))},t)))})]})}):(0,c.jsx)("p",{className:l.metaText,children:"No data preview yet."})]}),(0,c.jsxs)("section",{className:l.card,children:[(0,c.jsx)("div",{className:l.cardHeading,children:(0,c.jsx)("h3",{className:l.cardTitle,children:"AI Insights"})}),ee&&(0,c.jsx)("p",{className:l.errorText,children:ee}),W&&(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Summary:"})," ",W]}),Y.length>0&&(0,c.jsx)("ul",{className:l.insightList,children:Y.map(((e,t)=>(0,c.jsx)("li",{children:e},t)))}),!W&&0===Y.length&&!ee&&(0,c.jsx)("p",{className:l.metaText,children:"Run an analysis to see highlights here."})]}),(0,c.jsxs)("section",{className:l.card,children:[(0,c.jsxs)("div",{className:l.cardHeading,children:[(0,c.jsx)("h3",{className:l.cardTitle,children:"Interactive chart"}),(0,c.jsx)("button",{className:"button button--secondary button--sm",onClick:function(){if(!se.current)return;const e=getComputedStyle(document.documentElement).getPropertyValue("--ifm-background-color").trim()||"#ffffff",t=se.current.getDataURL({type:"png",pixelRatio:2,backgroundColor:e}),r=document.createElement("a");r.href=t,r.download=`ai-chart-${Date.now()}.png`,r.click()},disabled:!oe,children:"Download PNG"})]}),le&&(0,c.jsx)("p",{className:l.errorText,children:le}),(0,c.jsx)("div",{className:l.chartShell,children:(0,c.jsx)("div",{ref:ne,className:l.chartContainer})})]}),(0,c.jsxs)("section",{className:l.card,children:[(0,c.jsx)("div",{className:l.cardHeading,children:(0,c.jsx)("h3",{className:l.cardTitle,children:"Raw AI response"})}),(0,c.jsx)("pre",{className:l.codeBlock,children:re||"No response yet."})]})]})]}),(0,c.jsx)(o.A,{})]})})}function E(e,t,r={}){if(!e||!Array.isArray(e.headers)||0===(e.rows||[]).length)return null;const a=function(e){const t=String(e||"").toLowerCase(),r=[];return[["correlation","correlation|\u76f8\u5173\u6027|\u70ed\u56fe|heatmap"],["scatter","scatter|\u6563\u70b9"],["boxplot","boxplot|\u7bb1\u7ebf|\u7bb1\u578b"],["anova","anova|tukey|\u663e\u8457|\u5dee\u5f02"],["histogram","histogram|\u76f4\u65b9|\u5206\u5e03"],["line","line|\u6298\u7ebf|\u65f6\u95f4|\u8d8b\u52bf"],["bar","bar|\u67f1\u72b6"],["pie","pie|\u997c\u56fe"]].forEach((([e,a])=>{new RegExp(a).test(t)&&r.push(e)})),r}(t||""),n=e.headers.filter((t=>e.numericHints.includes(t))),s=e.headers.filter((t=>!e.numericHints.includes(t))),{xField:o,yField:i,groupField:l,agg:c="mean",errorMetric:u="none",multiCharts:d=!1}=r;if(o&&i){if(!l){const t=function(e,t,r,a){const n=new Map;e.forEach((e=>{const a=e[t],s=F(e[r]);if(null==a||null==s)return;const o=n.get(a)||[];o.push(s),n.set(a,o)}));const s=Array.from(n.keys()),o=s.map((e=>z(n.get(e),a)));return{labels:s,values:o}}(e.rows,o,i,c);let r=X(t.labels,t.values,o,`${c}(${i})`);if("none"!==u){const t=function(e,t,r,a){const n=new Map;e.forEach((e=>{const a=e[t],s=F(e[r]);if(null==a||null==s)return;const o=n.get(a)||[];o.push(s),n.set(a,o)}));const s=[];return Array.from(n.keys()).forEach((e=>{const t=n.get(e)||[],r=t.length;if(0===r)return;const o=t.reduce(((e,t)=>e+t),0)/r,i=Math.sqrt(t.reduce(((e,t)=>e+(t-o)*(t-o)),0)/Math.max(1,r-1)),l=i/Math.sqrt(r);"stddev"===a?s.push({name:e,low:o-i,high:o+i}):"se"===a&&s.push({name:e,low:o-l,high:o+l})})),s}(e.rows,o,i,u);r=I(r,t)}if(d){const t=H(e.rows,i,12);return{option:D(r,J(t.labels,t.counts,i)),summary:`${c}(${i}) by ${o} + histogram`,insights:[]}}return{option:r,summary:`${c}(${i}) by ${o}`,insights:[]}}const t=function(e,t,r,a,n){const s=[],o=new Map,i=[],l=new Map,c=[];e.forEach((e=>{const n=e[t],u=e[a],d=F(e[r]);if(null==n||null==u||null==d)return;o.has(n)||(o.set(n,s.length),s.push(n)),l.has(u)||(l.set(u,i.length),i.push(u),c.push({name:u,values:Array.from({length:s.length},(()=>[]))}));const p=o.get(n),m=l.get(u);c[m].values[p].push(d)}));const u=c.map((e=>({name:e.name,data:e.values.map((e=>z(e,n)))})));return{labels:s,series:u}}(e.rows,o,i,l,c),r=function(e,t,r,a){return C({title:{text:`${a} by ${r}`,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:a},series:t.map((e=>({type:"bar",name:e.name,data:e.data})))})}(t.labels,t.series,o,`${c}(${i})`);if(d){const t=q(e.rows,o,i,l);return{option:D(r,B(t.labelsX,t.groups,t.valuesByGroup,i)),summary:`${c}(${i}) by ${o} grouped + violin`,insights:[]}}return{option:r,summary:`${c}(${i}) by ${o} grouped by ${l}`,insights:[]}}if(a.includes("correlation")&&n.length>=2){const t=function(e,t){const r=t.length,a=t.map((()=>[]));e.forEach((e=>{const r=t.map((t=>F(e[t])));r.some((e=>null==e))||r.forEach(((e,t)=>a[t].push(e)))}));const n=Array.from({length:r},(()=>Array.from({length:r},(()=>0))));for(let s=0;s<r;s+=1)for(let e=0;e<r;e+=1)n[s][e]=L(a[s],a[e]);return{labelsX:t,labelsY:t,matrix:n}}(e.rows,n);return{option:function(e,t,r){const a=[];for(let n=0;n<e.length;n+=1)for(let e=0;e<t.length;e+=1){const t=r[e][n];a.push([n,e,Number.isFinite(t)?Math.round(100*t)/100:0])}return C({title:{text:"Correlation Heatmap",left:"center"},tooltip:{position:"top"},grid:{left:"5%",right:"5%",top:"12%",bottom:"16%"},xAxis:{type:"category",data:e},yAxis:{type:"category",data:t},series:[{type:"heatmap",data:a}],visualMap:{min:-1,max:1,calculable:!0,orient:"horizontal",left:"center",bottom:"4%"}})}(t.labelsX,t.labelsY,t.matrix),summary:"Correlation heatmap across numeric columns.",insights:[]}}if(a.includes("scatter")&&n.length>=2){const t=n[0],r=n[1],a=s[0]||null,o=function(e,t,r,a){const n={};e.forEach((e=>{const s=F(e[t]),o=F(e[r]);if(null==s||null==o)return;const i=a?String(e[a]||"Group"):"Series";n[i]||(n[i]=[]),n[i].push([s,o])}));const s=Object.keys(n).map((e=>({name:e,type:"scatter",data:n[e]})));return C({title:{text:`${t} vs ${r}`,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"value",name:t},yAxis:{type:"value",name:r},series:s})}(e.rows,t,r,a);if(d){const a=H(e.rows,r,12);return{option:D(o,J(a.labels,a.counts,r)),summary:`Scatter of ${t} vs ${r} + histogram`,insights:[]}}return{option:o,summary:`Scatter of ${t} vs ${r}.`,insights:[]}}if((a.includes("boxplot")||a.includes("anova"))&&n.length>=1&&s.length>=1){const t=n[0],r=s[0];if(l){const a=q(e.rows,r,t,l),n=function(e,t,r,a){const n=t.length,s=e=>(e-(n-1)/2)*(.8/Math.max(1,n)),o=t.map(((t,a)=>({type:"custom",name:String(t),encode:{x:0,y:[1,2,3,4]},renderItem:function(e,t){const r=e.data,n=r.xIdx+s(a),o=r.stats[0],i=r.stats[1],l=r.stats[2],c=r.stats[3],u=r.stats[4],d=t.coord([n,o]),p=t.coord([n,i]),m=t.coord([n,l]),h=t.coord([n,c]),g=t.coord([n,u]);if(!(d&&p&&m&&h&&g))return null;const y="function"==typeof t.size?.18*t.size([1,0])[0]:12,f=t.style({fill:"rgba(0,0,0,0.06)",stroke:"var(--ifm-color-emphasis-800)",lineWidth:1});return{type:"group",children:[{type:"line",shape:{x1:d[0],y1:d[1],x2:p[0],y2:p[1]},style:f},{type:"line",shape:{x1:h[0],y1:h[1],x2:g[0],y2:g[1]},style:f},{type:"line",shape:{x1:m[0]-y,y1:m[1],x2:m[0]+y,y2:m[1]},style:f},{type:"rect",shape:{x:p[0]-y,y:h[1],width:2*y,height:Math.max(1,p[1]-h[1])},style:f}]}},data:e.map(((e,a)=>({xIdx:a,stats:O(r[t][a])})))})));return C({title:{text:`Grouped Boxplot of ${a}`,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:a},legend:{top:"bottom"},series:o})}(a.labelsX,a.groups,a.valuesByGroup,t);return{option:D(n,B(a.labelsX,a.groups,a.valuesByGroup,t)),summary:`Grouped boxplot + violin of ${t} by ${r}`,insights:[]}}const a=function(e,t,r){const a=new Map;e.forEach((e=>{const n=e[t],s=F(e[r]);if(null==n||null==s)return;const o=a.get(n)||[];o.push(s),a.set(n,o)}));const n=Array.from(a.keys()),s=n.map((e=>O(a.get(e))));return{labels:n,boxes:s}}(e.rows,r,t);return{option:(p=a.labels,m=a.boxes,C({title:{text:"Boxplot",left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:p},yAxis:{type:"value"},series:[{type:"boxplot",data:m}]})),summary:`Distribution of ${t} by ${r}.`,insights:[]}}var p,m;if(a.includes("violin")&&n.length>=1&&s.length>=1){const t=n[0],r=s[0],a=function(e,t,r){const a=new Map;e.forEach((e=>{const n=e[t],s=F(e[r]);if(null==n||null==s)return;const o=a.get(n)||[];o.push(s),a.set(n,o)}));const n={};return Array.from(a.keys()).forEach((e=>{n[e]=a.get(e)})),n}(e.rows,r,t),o=function(e,t,r){const a=e.map(((e,r)=>({xIdx:r,label:e,values:t[e]||[]})));return C({title:{text:`Violin of ${r}`,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:r},series:[{type:"custom",name:"Violin",renderItem:function(e,t){const r=e.data,a=r.xIdx,n=Array.isArray(r.values)?r.values.filter((e=>Number.isFinite(e))):[];if(0===n.length)return null;const s=Math.min.apply(null,n),o=Math.max.apply(null,n),i=30,l=R(n),c=Array.from({length:i},((e,t)=>s+t/(i-1)*(o-s))),u=c.map((e=>P(n,e,l))),d=Math.max.apply(null,u)||1,p="function"==typeof t.size?.15*t.size([1,0])[0]:12,m=[],h=[];for(let g=0;g<c.length;g+=1){const e=u[g]/d*p,r=t.coord([a-.3,c[g]]),n=t.coord([a+.3,c[g]]);m.push([r[0]-e,r[1]]),h.push([n[0]+e,n[1]])}return{type:"polygon",shape:{points:m.concat(h.reverse())},style:t.style({fill:"rgba(79,129,189,0.35)",stroke:"var(--ifm-color-emphasis-800)"})}},encode:{x:0,y:1},data:a}]})}(Object.keys(a),a,t);return{option:o,summary:`Violin of ${t} by ${r}.`,insights:[]}}if(a.includes("histogram")&&n.length>=1){const t=n[0],r=H(e.rows,t,12);return{option:J(r.labels,r.counts,t),summary:`Histogram of ${t}.`,insights:[]}}const h=n[0],g=s[0];if(h&&g){const t=function(e,t,r){const a=new Map;e.forEach((e=>{const n=e[t],s=F(e[r]);if(null==n||null==s)return;const o=a.get(n)||{sum:0,count:0};o.sum+=s,o.count+=1,a.set(n,o)}));const n=Array.from(a.keys()),s=n.map((e=>{const t=a.get(e);return t.count>0?t.sum/t.count:0}));return{labels:n,means:s}}(e.rows,g,h);return{option:X(t.labels,t.means,g,h),summary:`Mean ${h} by ${g}.`,insights:[]}}if(h&&!g){const t=function(e,t){const r=e.map((e=>F(e[t]))).filter((e=>null!=e)),a=r.map(((e,t)=>`Item ${t+1}`));return{labels:a,values:r}}(e.rows,h),r=function(e,t,r){return C({title:{text:r,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:e},yAxis:{type:"value"},series:[{type:"line",name:r,smooth:!0,data:t}]})}(t.labels,t.values,h);return{option:r,summary:`Sequence of ${h}.`,insights:[]}}return null}function F(e){if(null==e)return null;const t=String(e).trim().replace(/,/g,"").replace(/%$/,"").replace(/^\((.*)\)$/,"-$1"),r=Number(t);return Number.isFinite(r)?r:null}function z(e,t){const r=(e||[]).filter((e=>null!=e));if(0===r.length)return 0;if("sum"===t)return r.reduce(((e,t)=>e+t),0);if("count"===t)return r.length;if("median"===t){const e=r.slice().sort(((e,t)=>e-t)),t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}return r.reduce(((e,t)=>e+t),0)/r.length}function L(e,t){const r=Math.min(e.length,t.length);if(0===r)return 0;let a=0,n=0,s=0,o=0,i=0;for(let p=0;p<r;p+=1){const r=e[p],l=t[p];a+=r,n+=l,s+=r*r,o+=l*l,i+=r*l}const l=i/r-a/r*(n/r),c=s/r-a/r*(a/r),u=o/r-n/r*(n/r),d=Math.sqrt(c*u);return Number.isFinite(d)&&0!==d?l/d:0}function O(e){const t=(e||[]).slice().sort(((e,t)=>e-t));if(0===t.length)return[0,0,0,0,0];const r=e=>{const r=(t.length-1)*e,a=Math.floor(r),n=Math.ceil(r);if(a===n)return t[a];const s=r-a;return t[a]*(1-s)+t[n]*s},a=t[0],n=t[t.length-1];return[a,r(.25),r(.5),r(.75),n]}function B(e,t,r,a){const n=t.length,s=t.map(((t,a)=>({type:"custom",name:String(t),renderItem:function(e,t){const r=e.data,s=r.xIdx+(e=>(e-(n-1)/2)*(.8/Math.max(1,n)))(a),o=Array.isArray(r.values)?r.values.filter((e=>Number.isFinite(e))):[];if(0===o.length)return null;const i=Math.min.apply(null,o),l=Math.max.apply(null,o),c=R(o),u=Array.from({length:30},((e,t)=>i+t/29*(l-i))),d=u.map((e=>P(o,e,c))),p=Math.max.apply(null,d)||1,m="function"==typeof t.size?.12*t.size([1,0])[0]:10,h=[],g=[];for(let a=0;a<u.length;a+=1){const e=d[a]/p*m,r=t.coord([s,u[a]]);h.push([r[0]-e,r[1]]),g.push([r[0]+e,r[1]])}return{type:"polygon",shape:{points:h.concat(g.reverse())},style:t.style({fill:"rgba(79,129,189,0.25)",stroke:"var(--ifm-color-emphasis-800)"})}},data:e.map(((e,a)=>({xIdx:a,values:r[t][a]||[]})))})));return C({title:{text:`Grouped Violin of ${a}`,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:a},legend:{top:"bottom"},series:s})}function R(e){const t=e.length,r=e.reduce(((e,t)=>e+t),0)/t;return 1.06*Math.sqrt(e.reduce(((e,t)=>e+(t-r)*(t-r)),0)/Math.max(1,t-1))*Math.pow(t,-.2)||(Math.max(...e)-Math.min(...e))/20||1}function P(e,t,r){const a=1/(r*Math.sqrt(2*Math.PI));let n=0;for(let s=0;s<e.length;s+=1){const a=(t-e[s])/r;n+=Math.exp(-.5*a*a)}return a*n}function H(e,t,r){const a=e.map((e=>F(e[t]))).filter((e=>null!=e));if(0===a.length)return{labels:[],counts:[]};const n=Math.min(...a),s=(Math.max(...a)-n)/Math.max(1,r),o=Array.from({length:r+1},((e,t)=>n+t*s)),i=Array.from({length:r},(()=>0));a.forEach((e=>{const t=Math.min(r-1,Math.max(0,Math.floor((e-n)/s)));i[t]+=1}));return{labels:Array.from({length:r},((e,t)=>`${o[t].toFixed(2)}\u2013${o[t+1].toFixed(2)}`)),counts:i}}function J(e,t,r){return C({title:{text:`Histogram of ${r}`,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:e},yAxis:{type:"value"},series:[{type:"bar",name:r,data:t}]})}function D(e,t){const r=C(e)||{},a=C(t)||{},n=Array.isArray(r.xAxis)?r.xAxis[0]:r.xAxis||{type:"category"},s=Array.isArray(r.yAxis)?r.yAxis[0]:r.yAxis||{type:"value"},o=Array.isArray(a.xAxis)?a.xAxis[0]:a.xAxis||{type:"category"},i=Array.isArray(a.yAxis)?a.yAxis[0]:a.yAxis||{type:"value"},l=Array.isArray(r.series)?r.series.map((e=>({...e,xAxisIndex:0,yAxisIndex:0}))):[],c=Array.isArray(a.series)?a.series.map((e=>({...e,xAxisIndex:1,yAxisIndex:1}))):[];return{color:r.color||a.color||m,tooltip:{trigger:"axis"},legend:{top:"bottom"},grid:[{left:"6%",right:"52%",top:"10%",bottom:"12%",containLabel:!0},{left:"52%",right:"6%",top:"10%",bottom:"12%",containLabel:!0}],xAxis:[{...n,gridIndex:0},{...o,gridIndex:1}],yAxis:[{...s,gridIndex:0},{...i,gridIndex:1}],series:[...l,...c]}}function X(e,t,r,a){return C({title:{text:`Mean ${a} by ${r}`,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:a},series:[{type:"bar",name:a,data:t}]})}function q(e,t,r,a){const n=[],s=new Map,o=[],i=new Map,l={};return e.forEach((e=>{const c=e[t],u=e[a],d=F(e[r]);if(null==c||null==u||null==d)return;s.has(c)||(s.set(c,n.length),n.push(c)),i.has(u)||(i.set(u,o.length),l[u]=Array.from({length:n.length},(()=>[])),o.push(u));const p=s.get(c);l[u][p].push(d)})),{labelsX:n,groups:o,valuesByGroup:l}}}}]);