"use strict";(self.webpackChunkliangchao_website=self.webpackChunkliangchao_website||[]).push([[3357],{17921:(e,t,r)=>{function n(){const e="undefined"!=typeof window?window.localStorage.getItem("app_users"):null;if(!e)return[];try{return JSON.parse(e)||[]}catch{return[]}}function a(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}async function s(e,t){const r=(new TextEncoder).encode(e),n=function(e){const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++)t[r]=parseInt(e.substr(2*r,2),16);return t.buffer}(t),s=await crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveBits"]);return a(await crypto.subtle.deriveBits({name:"PBKDF2",salt:n,iterations:15e4,hash:"SHA-256"},s,256))}async function o(e,t){const r=n();if(r.find((t=>t.email.toLowerCase()===String(e).toLowerCase())))throw new Error("Email already registered");const o=a(crypto.getRandomValues(new Uint8Array(16)).buffer),i=await s(t,o);return r.push({email:e,saltHex:o,hashHex:i,createdAt:(new Date).toISOString()}),function(e){"undefined"!=typeof window&&window.localStorage.setItem("app_users",JSON.stringify(e))}(r),c({email:e}),{email:e}}async function i(e,t){const r=n().find((t=>t.email.toLowerCase()===String(e).toLowerCase()));if(!r)throw new Error("Account not found");if(await s(t,r.saltHex)!==r.hashHex)throw new Error("Invalid credentials");return c({email:e}),{email:e}}function l(){if("undefined"==typeof window)return null;const e=window.localStorage.getItem("app_session");if(!e)return null;try{return JSON.parse(e)||null}catch{return null}}function c(e){"undefined"!=typeof window&&window.localStorage.setItem("app_session",JSON.stringify({email:e.email,at:Date.now()}))}function u(){"undefined"!=typeof window&&window.localStorage.removeItem("app_session")}r.d(t,{Ht:()=>l,iD:()=>i,kz:()=>o,ri:()=>u})},34619:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(96540),a=r(17921),s=r(95082),o=r(74848);function i({children:e}){const[t,r]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{const e=(0,s.b)();if(e){e.auth.getUser().then((({data:e})=>{const t=!!e?.user;r(t),"undefined"!=typeof window&&(window.__APP_AUTH_OK__=t)}));const{data:t}=e.auth.onAuthStateChange(((e,t)=>{const n=!!t?.user;r(n),"undefined"!=typeof window&&(window.__APP_AUTH_OK__=n)}));return()=>t?.subscription?.unsubscribe?.()}const t=!!(0,a.Ht)();r(t),"undefined"!=typeof window&&(window.__APP_AUTH_OK__=t)}),[]),(0,o.jsxs)("div",{children:[!t&&(0,o.jsx)("div",{className:"app-card",style:{marginBottom:12},children:(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.jsx)("span",{className:"app-muted",children:"Please login to use app features"}),(0,o.jsx)("a",{className:"button button--secondary",href:"/auth",children:"Login / Register"})]})}),e]})}},62835:(e,t,r)=>{r.d(t,{A:()=>d});var n=r(96540),a=r(74848);const s={maxWidth:"800px",margin:"60px auto 0",textAlign:"left",padding:"0 20px"},o={fontSize:"2rem",fontWeight:"600",marginBottom:"16px",color:"var(--ifm-color-emphasis-900)"},i={fontSize:"1.1rem",color:"var(--ifm-color-emphasis-700)",lineHeight:1.6,marginBottom:"16px"},l={borderLeft:"4px solid var(--ifm-border-color)",paddingLeft:"16px",color:"var(--ifm-color-emphasis-700)",fontStyle:"italic",lineHeight:1.6,marginBottom:"16px"},c={backgroundColor:"var(--ifm-background-surface-color)",padding:"16px",borderRadius:"12px",overflowX:"auto",border:"1px solid var(--ifm-border-color)",color:"var(--ifm-color-emphasis-800)"},u={fontSize:"1.5rem",fontWeight:"600",marginBottom:"16px",color:"var(--ifm-color-emphasis-900)"};function d({containerStyle:e}){const[t,r]=(0,n.useState)(!1),[d,p]=(0,n.useState)(!1),m="LiangchaoDeng. (2025). smiler488/smiler488.github.io: Digital Plant Phenotyping Platform v25.0 (v25.0.0). Zenodo. https://doi.org/10.5281/zenodo.17544584",h="@software{Deng2025_DPPP_v25,\n  author       = {Deng, Liangchao},\n  title        = {Digital Plant Phenotyping Platform (v25.0)},\n  year         = {2025},\n  publisher    = {Zenodo},\n  doi          = {10.5281/zenodo.17544584},\n  url          = {https://doi.org/10.5281/zenodo.17544584},\n  note         = {[Computer software]}\n}";return(0,a.jsxs)("div",{style:{...s,...e},children:[(0,a.jsx)("h2",{style:o,children:"Citation"}),(0,a.jsxs)("p",{style:i,children:["If you use ",(0,a.jsx)("strong",{children:"Digital Plant Phenotyping Platform v25.0"})," or any of its applications in your research, please cite it as:"]}),(0,a.jsxs)("blockquote",{style:l,children:["LiangchaoDeng. (2025)."," ",(0,a.jsx)("em",{children:"smiler488/smiler488.github.io: Digital Plant Phenotyping Platform v25.0 (v25.0.0)"}),". Zenodo.",(0,a.jsx)("br",{}),(0,a.jsx)("a",{href:"https://doi.org/10.5281/zenodo.17544584",children:"https://doi.org/10.5281/zenodo.17544584"})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",gap:"12px"},children:[(0,a.jsx)("button",{type:"button",onClick:async()=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(m);else if("undefined"!=typeof document){const e=document.createElement("textarea");e.value=m,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}r(!0),setTimeout((()=>r(!1)),2e3)}catch{r(!1)}},style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid var(--ifm-color-emphasis-900)",backgroundColor:"var(--ifm-color-emphasis-900)",color:"var(--ifm-color-emphasis-0)",cursor:"pointer",fontSize:"0.95rem",fontWeight:500,transition:"transform 0.15s ease, background-color 0.15s ease"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-primary)",e.currentTarget.style.borderColor="var(--ifm-color-primary)",e.currentTarget.style.transform="translateY(-1px)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.borderColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.transform="translateY(0)"},children:t?"Copied!":"Copy citation"}),(0,a.jsx)("span",{style:{fontSize:"0.9rem",color:t?"var(--ifm-color-success)":"var(--ifm-color-emphasis-600)"},children:t?"Citation copied to clipboard.":"Click to copy APA citation."})]}),(0,a.jsx)("a",{href:"https://doi.org/10.5281/zenodo.17544584",style:{display:"inline-block",marginBottom:"24px"},children:(0,a.jsx)("img",{src:"https://zenodo.org/badge/DOI/10.5281/zenodo.17544584.svg",alt:"DOI badge",style:{height:"32px"}})}),(0,a.jsx)("hr",{style:{border:"none",borderTop:"1px solid var(--ifm-border-color)",marginBottom:"24px"}}),(0,a.jsx)("h3",{style:u,children:"BibTeX citation (Zotero \u2192 File \u2192 Import from Clipboard)"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",gap:"12px"},children:[(0,a.jsx)("button",{type:"button",onClick:async()=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(h);else if("undefined"!=typeof document){const e=document.createElement("textarea");e.value=h,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}p(!0),setTimeout((()=>p(!1)),2e3)}catch{p(!1)}},style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid var(--ifm-color-emphasis-900)",backgroundColor:"var(--ifm-color-emphasis-900)",color:"var(--ifm-color-emphasis-0)",cursor:"pointer",fontSize:"0.95rem",fontWeight:500,transition:"transform 0.15s ease, background-color 0.15s ease"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-primary)",e.currentTarget.style.borderColor="var(--ifm-color-primary)",e.currentTarget.style.transform="translateY(-1px)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.borderColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.transform="translateY(0)"},children:d?"Copied!":"Copy BibTeX"}),(0,a.jsx)("span",{style:{fontSize:"0.9rem",color:d?"var(--ifm-color-success)":"var(--ifm-color-emphasis-600)"},children:d?"BibTeX copied to clipboard. Switch to Zotero and choose Import from Clipboard.":"Click to copy BibTeX to clipboard for Zotero import."})]}),(0,a.jsx)("pre",{style:c,children:(0,a.jsx)("code",{children:h})})]})}},74911:(e,t,r)=>{r.d(t,{B2:()=>l,S:()=>s,dO:()=>i,kh:()=>n,lJ:()=>o,wn:()=>a});const n="https://api.hunyuan.cloud.tencent.com/v1/chat/completions",a="sk-JdwAvFcfyW5ngP2i3cpeB43QrR92gjnRcNzKkMfpcEVu8hlE";function s(){return n}function o(e,t){return{model:t||"hunyuan-lite",messages:[{role:"system",content:[{type:"text",text:"Respond ONLY with strict JSON object. No markdown, no prose."}]},{role:"user",content:[{type:"text",text:(e||"").trim()||"You are a helpful assistant that generates ECharts option JSON based on CSV summaries."}]}],response_format:{type:"json_object"},stream:!1}}function i(e){return Array.isArray(e?.choices)&&e.choices.length>0?e.choices[0].message?.content||"":e?.Response&&Array.isArray(e.Response.Choices)&&e.Response.Choices.length>0?e.Response.Choices[0].Message?.Content||"":"string"==typeof e?e:JSON.stringify(e,null,2)}async function l(e,t,r={}){if("string"==typeof e&&e.startsWith("mock://")){const r=e.slice(7);if("ai-data-visualizer"===r){const e={summary:"Sample analysis: sales grew steadily across quarters, with Q4 showing the highest revenue. Seasonal dips occur in Q2 due to inventory resets.",insights:["Strong upward trend overall; expect ~12% YoY growth.","Product beta overtook alpha in Q3 and maintained the lead.","Recommend stacked area chart to communicate contribution per product."],chart_option:{title:{text:"Mock Revenue Correlation Heatmap",left:"center"},tooltip:{position:"top"},grid:{left:"5%",right:"5%",top:"12%",bottom:"18%"},xAxis:{type:"category",data:["North","South","East","West"],splitArea:{show:!0}},yAxis:{type:"category",data:["Q1","Q2","Q3","Q4"],splitArea:{show:!0}},visualMap:{min:60,max:210,calculable:!0,orient:"horizontal",left:"center",bottom:"4%"},series:[{name:"Revenue",type:"heatmap",label:{show:!0},data:[[0,0,120],[1,0,135],[2,0,150],[3,0,110],[0,1,98],[1,1,142],[2,1,160],[3,1,100],[0,2,160],[1,2,175],[2,2,182],[3,2,138],[0,3,190],[1,3,205],[2,3,210],[3,3,168]]}]}},t={choices:[{message:{content:JSON.stringify(e,null,2)}}]};return{ok:!0,status:200,json:async()=>t,text:async()=>JSON.stringify(t),headers:new Map([["content-type","application/json"]])}}if("journal-selector"===r){const e={overview:{abstract_summary:t?.question?.slice(0,120)||"N/A",alignment_summary:"Mocked response (replace API URL for real results)."},journals:[{journal_name:"Mock Journal of AI",publisher:"Mock Press",discipline_scope:"AI & Data Science",impact_factor_2024:"8.5",jcr_quartile:"Q1",acceptance_rate:"18%",initial_review_weeks:6,oa_type:"Hybrid OA",apc_usd:2400,submission_advice:"Strong alignment with ML/DS topics.",warning_status:"-"}],notes:"This is a mock response generated locally."},r={choices:[{message:{content:JSON.stringify(e,null,2)}}]};return{ok:!0,status:200,json:async()=>r,text:async()=>JSON.stringify(r),headers:new Map([["content-type","application/json"]])}}if("ai-solver"===r){const e=(new Date).toISOString(),r=t?.question||"No question provided",n=t?.model||"hunyuan-lite",a=`${!!t?.imageBase64||!!t?.imageUrl?"Mock Vision Analysis":"Mock Text Analysis"} (model: ${n})\n\nUser question:\n${r}\n\nThis is a mocked response for demo purposes. Replace proxy URL with your real API when ready.`,s={Response:{RequestId:"mock-"+Math.random().toString(36).slice(2),Choices:[{Message:{Content:a}}],Usage:{PromptTokens:128,CompletionTokens:256,TotalTokens:384},Timestamp:e}};return{ok:!0,status:200,json:async()=>s,text:async()=>JSON.stringify(s),headers:new Map([["content-type","application/json"]])}}}return fetch(e,{method:"POST",headers:{"Content-Type":"application/json",...r},body:JSON.stringify(t)})}},95082:(e,t,r)=>{r.d(t,{b:()=>s});var n=r(51270);let a=null;function s(){if(a)return a;if("undefined"==typeof window)return null;const e=window.__SUPABASE_URL__,t=window.__SUPABASE_ANON_KEY__;return e&&t?(a=(0,n.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}),a):null}},99483:(e,t,r)=>{r.r(t),r.d(t,{default:()=>E});var n=r(96540),a=r(34164),s=r(39495),o=r(34619),i=r(62835),l=r(74911);const c={appContainer:"appContainer_isI3",heroRow:"heroRow_FJUs",heroTitle:"heroTitle_jqMG",heroDescription:"heroDescription_qcQW",mainGrid:"mainGrid_eMBy",leftColumn:"leftColumn_b8mH",rightColumn:"rightColumn_VP0V",card:"card_Aa6Q",cardHeading:"cardHeading_YYAr",cardTitle:"cardTitle_JA1M",stepBadge:"stepBadge_YLAV",fileInputWrapper:"fileInputWrapper_Aoow",fileInput:"fileInput_NjcX",textArea:"textArea_rFiB",monoArea:"monoArea_wreA",textInput:"textInput_FrIQ",fieldGroup:"fieldGroup_Yrn0",fieldLabel:"fieldLabel_Uiov",checkboxRow:"checkboxRow_AQvQ",metaText:"metaText_s1tu",statusBadge:"statusBadge_N3J_","status--muted":"status--muted_RVCL","status--info":"status--info_KhHG","status--success":"status--success_RQIz","status--warning":"status--warning_b68s","status--danger":"status--danger_Cr5j",tableScroll:"tableScroll_BA0F",previewTable:"previewTable_j082",insightList:"insightList_cBGD",errorText:"errorText_LRKa",chartShell:"chartShell_qU3U",chartContainer:"chartContainer_up7U",codeBlock:"codeBlock_JSKd"};var u=r(74848);const d=40,p=1e4,m=8e3,h=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc948","#b07aa1","#ff9da7","#9c755f","#bab0ab"],g={doughnut:"pie",donut:"pie",area:"line",stackedarea:"line",horizontalbar:"bar",verticalbar:"bar"},f=["line","bar","scatter","pie","radar","heatmap","funnel","gauge","treemap","sankey","boxplot"],y="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js";let x=null;const b="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js";let v=null;function w(e){if(!e)return null;const t=function(e){if(!e)return"";let t=e.trim();return t.startsWith("```")&&(t=t.replace(/^```(?:json)?/i,"").replace(/```$/,"").trim()),t}(e);try{return JSON.parse(t)}catch{const e=A(t);if(e)try{return JSON.parse(e)}catch{}const r=function(e){if(!e)return null;const t=String(e);let r=!1,n=!1,a=0,s=-1;for(let o=0;o<t.length;o+=1){const e=t[o];if(r)n?n=!1:"\\"===e?n=!0:'"'===e&&(r=!1);else if('"'!==e)if("{"!==e){if("}"===e&&a>0&&(a-=1,0===a&&-1!==s))return t.slice(s,o+1)}else 0===a&&(s=o),a+=1;else r=!0,n=!1}return null}(t);if(r)try{return JSON.parse(r)}catch{const e=A(r);if(e)try{return JSON.parse(e)}catch{}}return null}}function A(e){if(!e)return null;let t=e;t=t.replace(/[\u201C\u201D]/g,'"').replace(/[\u2018\u2019]/g,"'").replace(/\bTrue\b/g,"true").replace(/\bFalse\b/g,"false").replace(/\bNone\b/g,"null"),t=t.replace(/(^|\n)\s*```(?:json)?[\s\S]*?\n/g,""),t=t.replace(/(^|\n)\s*```\s*$/g,""),t=t.replace(/(^|\n)\s*Response:?/gi,"$1"),t=t.replace(/([{,\s])'([^'"]+?)'\s*:/g,'$1"$2":'),t=t.replace(/:\s*'([^'"]*?)'/g,':"$1"'),t=t.replace(/,\s*([}\]])/g,"$1");const r=(t.match(/{/g)||[]).length-(t.match(/}/g)||[]).length;return r>0?t+="}".repeat(r):r<0&&(t=t.replace(/}{1,}$/,"")),t}function j({datasetSummary:e,goal:t,mapping:r}){const n=e&&e.length>0?e:"Dataset summary missing. Ask the user for data.",a=t&&t.trim().length>0?t.trim():"Highlight the most actionable trend and propose the best chart.";return["You are an expert data scientist that returns high quality **ECharts** visualizations.","Instructions:","- Use the dataset summary below (tabular, tidy rows).","- Choose the most expressive chart type supported by Apache ECharts (line, bar, scatter, pie, radar, heatmap, sankey, etc.). Heatmaps are encouraged for correlation matrices.","- Respond with strict JSON only. Start with { and end with }. No Markdown or explanations:","  {",'    "summary": "<2-3 sentence natural-language overview>",','    "insights": ["<bullet insight 1>", "<bullet insight 2>", "..."],','    "chart_option": { /* valid ECharts option */ }',"  }","- The `chart_option` must be a valid ECharts option object (title/tooltip/grid/xAxis/yAxis/visualMap/series/etc).","- Include axes labels, legends, tooltips, and visualMap (when using heatmap or continuous color scales).","- Keep series arrays short (<=6) and align data lengths with category axes.","- Never include functions or comments in the JSON.",'- If the goal mentions ANOVA/Tukey or group letters, return an additional field `tukey_letters` as a JSON object mapping each category name (x-axis label) to its letter(s), e.g., {"Treatment_A":"a","Treatment_B":"ab"}.','- Do NOT create a second series for Standard Error. If uncertainty must be represented, return an `error_bars` array like [{"name":"Treatment_A","low":2450,"high":2550}] and the app will render whiskers; letters must be TEXT labels only.',"- If the goal requests a correlation heatmap, build a rectangular heatmap using [xIndex, yIndex, value] tuples.",r&&(r.xField||r.yField||r.groupField)?`Field mapping: x=${r.xField||"auto"}, y=${r.yField||"auto"}, group=${r.groupField||"none"}, agg=${r.agg||"mean"}, error=${r.errorMetric||"none"}, multi=${r.multiCharts?"true":"false"}`:"",`User goal: ${a}`,"Dataset summary (JSON):",n].join("\n")}function S(e,t){if(!e&&""!==e)return[];const r=[];let n="",a=!1;for(let s=0;s<e.length;s+=1){const o=e[s];'"'!==o?a||o!==t?n+=o:(r.push(n.trim()),n=""):a&&'"'===e[s+1]?(n+='"',s+=1):a=!a}return r.push(n.trim()),r.map((e=>e.replace(/^"|"$/g,"")))}function N(e){if(!e)return null;const t=e.replace(/\r\n/g,"\n").trim();if(!t)return null;const r=t.split("\n").filter((e=>e.trim().length>0));if(0===r.length)return null;const n=function(e){const t=Array.isArray(e)?e.join("\n"):e||"";return t.includes("\t")?"\t":(t.match(/,/g)||[]).length>=(t.match(/;/g)||[]).length?",":";"}([r[0],r[1]||""]),a=S(r[0],n).map(((e,t)=>e&&e.trim()?e.trim():`Column ${t+1}`)),s=[],o=[],i=a.map((()=>new Map));for(let m=1;m<r.length;m+=1){const e=S(r[m],n),t={};a.forEach(((r,n)=>{const a=void 0!==e[n]?e[n].trim():"";if(t[r]=a,a&&a.length>0){const e=i[n];e.set(a,(e.get(a)||0)+1)}})),s.length<d&&s.push(t),o.length<p&&o.push(t)}const l=a.map((e=>{const t=s.map((t=>t[e])).filter((e=>C(e))).length;return(s.length>0?t/s.length:0)>=.6?e:null})).filter(Boolean),c=a.reduce(((e,t,r)=>{const n=i[r],a=Array.from(n.entries()).sort(((e,t)=>t[1]-e[1])).slice(0,8).map((([e,t])=>({value:e,count:t})));return e[t]={unique_count:n.size,top_values:a},e}),{}),u=a.map(((e,t)=>({header:e,idx:t}))).filter((({header:e})=>!l.includes(e))).flatMap((({idx:e})=>(c[a[e]]?.top_values||[]).map((e=>e.value)))).filter(((e,t,r)=>e&&r.indexOf(e)===t)).slice(0,40);return{headers:a,sampleRows:s,rows:o,delimiter:n,rowCount:Math.max(r.length-1,s.length),numericHints:l,valueStats:c,categoryHints:u}}function C(e){if(null==e)return!1;const t=String(e).trim();if(!t)return!1;const r=t.replace(/,/g,"").replace(/%$/,"").replace(/^\((.*)\)$/,"-$1");return!Number.isNaN(Number(r))}function _(e,t={}){if(!e||"object"!=typeof e)return null;const r={color:Array.isArray(e.color)&&e.color.length>0?e.color:h,tooltip:e.tooltip||{trigger:"axis"},...e},n={xCategories:null,yCategories:null,min:1/0,max:-1/0},a=new Set;t&&"object"==typeof t&&(t.letters&&"object"==typeof t.letters&&Object.keys(t.letters).forEach((e=>{null!=e&&a.add(String(e))})),Array.isArray(t.errorBars)&&t.errorBars.forEach((e=>{e&&void 0!==e.name&&null!==e.name&&a.add(String(e.name))})),Array.isArray(t.categoryHints)&&t.categoryHints.forEach((e=>{null!=e&&a.add(String(e))})));const s=Array.isArray(r.series)?r.series:r.series?[r.series]:[];if(0===s.length)return null;r.series=s.map(((e,t)=>{const r=M(e.type,0===t?"line":e.type);let a={name:e.name||e.label||`Series ${t+1}`,...e,type:r};if("pie"!==r||a.radius||(a.radius=["40%","70%"]),"heatmap"===r){const e=function(e){const t=Array.isArray(e)?e:[],r=new Map,n=new Map,a=[],s=[],o=[];let i=1/0,l=-1/0;const c=(e,t,r)=>{if(null==e)return null;if("number"==typeof e&&Number.isFinite(e))return e;const n=String(e);if(t.has(n))return t.get(n);const a=r.length;return r.push(n),t.set(n,a),a};return t.forEach((e=>{let t,u,d;if(Array.isArray(e)&&e.length>=3)[t,u,d]=e;else{if(!e||"object"!=typeof e)return;t=e.x??e.col??e.column??e.column_name??e.columnName??e.i??e.j,u=e.y??e.row??e.index??e.row_name??e.rowName??e.k??e.l,d=e.value??e.v??e.score??e.z??e.correlation}if(null==d||Number.isNaN(Number(d)))return;const p=Number(d),m=c(t,r,a),h=c(u,n,s);null!=m&&null!=h&&(o.push([Number(m),Number(h),p]),p<i&&(i=p),p>l&&(l=p))})),{data:o,xCategories:a.length>0?a:null,yCategories:s.length>0?s:null,valueRange:o.length>0?{min:i,max:l}:null}}(a.data);a={...a,data:e.data},a.label||(a.label={show:e.data.length<=250}),a.emphasis||(a.emphasis={itemStyle:{shadowBlur:10,shadowColor:"rgba(0,0,0,0.4)"}}),e.xCategories&&!n.xCategories&&(n.xCategories=e.xCategories),e.yCategories&&!n.yCategories&&(n.yCategories=e.yCategories),e.valueRange&&(n.min=Math.min(n.min,e.valueRange.min),n.max=Math.max(n.max,e.valueRange.max))}return a})),!r.legend&&r.series.some((e=>!!e.name))&&(r.legend={top:"bottom"});r.series.some((e=>!["pie","funnel","gauge","treemap","sankey"].includes(e.type)))&&!r.grid&&(r.grid={left:"6%",right:"4%",top:"8%",bottom:"10%",containLabel:!0});const o=a.size>0?Array.from(a):null;return n.xCategories?r.xAxis=I(r.xAxis,n.xCategories):o&&(r.xAxis=I(r.xAxis,o,{merge:!0})),n.yCategories&&(r.yAxis=I(r.yAxis,n.yCategories)),n.min===1/0||void 0!==r.visualMap&&null!==r.visualMap||(r.visualMap={min:n.min,max:n.max,calculable:!0,orient:"horizontal",left:"center",bottom:"5%"}),Array.isArray(r.series)&&(r.series=r.series.filter((e=>{const t=e&&(e.name||e.label)?String(e.name||e.label).toLowerCase():"";return!/standard\s*error|std\s*error|\bse\b/.test(t)}))),r}function k(e){if(!e||"object"!=typeof e)return null;const t=e.data||e.chartData;if(!t)return null;const r=Array.isArray(t.datasets)?t.datasets:[],n=Array.isArray(t.labels)?t.labels:Array.from({length:r[0]?.data?.length||0},((e,t)=>`Item ${t+1}`)),a=M(e.type||e.chartType,1===r.length?"line":"bar");return"pie"===a?function(e,t){const r=t[0]?.data||[],n=e.map(((e,t)=>({name:e||`Slice ${t+1}`,value:r[t]??0})));return{color:h,tooltip:{trigger:"item"},legend:{top:"bottom"},series:[{type:"pie",radius:["40%","70%"],data:n,emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.2)"}}}]}}(n,r):function(e,t,r,n={}){const a="y"===n?.indexAxis,s=a?"yAxis":"xAxis",o=a?"xAxis":"yAxis";return{color:h,tooltip:{trigger:"axis"},legend:{top:"bottom"},grid:{left:"4%",right:"3%",bottom:"8%",containLabel:!0},[s]:{type:"category",data:t},[o]:{type:"value"},series:r.map(((t,r)=>({name:t.label||`Series ${r+1}`,type:e,smooth:"line"===e,data:t.data||[],emphasis:{focus:"series"}})))}}(a,n,r,e.options)}function M(e,t="line"){const r="string"==typeof e?e.toLowerCase().trim():"",n=g[r]||r;return n&&f.includes(n)?n:t}function I(e,t,{merge:r=!1}={}){if(!t||0===t.length)return e||{type:"category"};if(Array.isArray(e)){const n=e.length>0?e.map((e=>({...e}))):[{}];return n[0]?(n[0].type||(n[0].type="category"),n[0].data&&0!==n[0].data.length?r&&(n[0].data=$(n[0].data,t)):n[0].data=t):n[0]={type:"category",data:t},n}const n=e&&"object"==typeof e?{...e}:{type:"category"};return n.type||(n.type="category"),n.data&&0!==n.data.length?r&&(n.data=$(n.data,t)):n.data=t,n}function $(e,t){const r=Array.isArray(e)?e.map((e=>null!=e?String(e):e)):[],n=new Set(r);return t.forEach((e=>{const t=null!=e?String(e):e;null==t||n.has(t)||(r.push(e),n.add(t))})),r}function T(e,t){try{if(!e||!Array.isArray(t)||0===t.length)return e;const r=Array.isArray(e.xAxis)?e.xAxis[0]:e.xAxis,n=Array.isArray(e.yAxis)?e.yAxis[0]:e.yAxis,a=r&&Array.isArray(r.data)?r.data:null,s=Array.isArray(e.series)&&e.series[0]&&"bar"===String(e.series[0].type).toLowerCase()&&(!r||"category"===r.type)&&(!n||"category"!==n.type);if(!a||!s)return e;const o=new Map((a||[]).map(((e,t)=>[String(e),t]))),i=[];for(const e of t){if(!e||null==e.low||null==e.high||null==e.name)continue;const t=o.get(String(e.name));if(null==t)continue;const r=Number(e.low),n=Number(e.high);Number.isFinite(r)&&Number.isFinite(n)&&i.push([t,r,n])}if(0===i.length)return e;const l={name:"SE whiskers",type:"custom",tooltip:{show:!1},renderItem:function(e,t){if(!t||"function"!=typeof t.coord||"function"!=typeof t.value)return null;const r=t.value(0),n=t.value(1),a=t.value(2);if(!Number.isFinite(r)||!Number.isFinite(n)||!Number.isFinite(a))return null;const s=t.coord([r,0]),o=t.coord([r,n]),i=t.coord([r,a]);if(!s||!o||!i)return null;const l=s[0],c=o[1],u=i[1],d="function"==typeof t.size?t.size([1,0])[0]:10,p=Math.max(6,Math.min(12,.25*d||8)),m=t.style({stroke:"var(--ifm-color-emphasis-800)",fill:null,lineWidth:1.2});return{type:"group",children:[{type:"line",shape:{x1:l,y1:c,x2:l,y2:u},style:m},{type:"line",shape:{x1:l-p,y1:c,x2:l+p,y2:c},style:m},{type:"line",shape:{x1:l-p,y1:u,x2:l+p,y2:u},style:m}]}},encode:{x:0,y:[1,2]},z:10,data:i};return{...e,series:Array.isArray(e.series)?[...e.series,l]:[l]}}catch(r){return e}}function E(){const e=(0,n.useMemo)(l.S,[]),[t,r]=(0,n.useState)(!0),[p,h]=(0,n.useState)(""),[g,f]=(0,n.useState)(""),[A,S]=(0,n.useState)("hunyuan-t1-latest"),[M,I]=(0,n.useState)("Highlight the clearest trend, choose the best chart for stakeholders, and annotate anomalies."),[$,E]=(0,n.useState)(null),[z,L]=(0,n.useState)(""),[F,B]=(0,n.useState)(null),[P,R]=(0,n.useState)([]),[H,J]=(0,n.useState)(""),[D,U]=(0,n.useState)({}),[X,q]=(0,n.useState)({text:"Upload a CSV/TSV to get started.",tone:"muted"}),[V,G]=(0,n.useState)(!1),[W,Y]=(0,n.useState)(""),[K,Q]=(0,n.useState)([]),[Z,ee]=(0,n.useState)(null),[te,re]=(0,n.useState)(""),[ne,ae]=(0,n.useState)(""),se=(0,n.useRef)(null),oe=(0,n.useRef)(null),[ie,le]=(0,n.useState)(!1),[ce,ue]=(0,n.useState)(""),[de,pe]=(0,n.useState)(""),[me,he]=(0,n.useState)(""),[ge,fe]=(0,n.useState)(""),[ye,xe]=(0,n.useState)("mean"),[be,ve]=(0,n.useState)("none"),[we,Ae]=(0,n.useState)(!1),je=(0,n.useMemo)((()=>F||N(z)),[F,z]),Se=(0,n.useMemo)((()=>function(e,t){if(!t)return"";const r={file:e?{name:e.name,size:e.size,type:e.type}:null,stats:{estimated_rows:t.rowCount,column_count:t.headers.length,delimiter:"\t"===t.delimiter?"tab":t.delimiter,mostly_numeric_columns:t.numericHints,category_hint_examples:t.categoryHints||[]},columns:t.headers,sample_rows:t.sampleRows.slice(0,8),column_profiles:t.headers.map((e=>({name:e,mostly_numeric:t.numericHints.includes(e),unique_values:t.valueStats?.[e]?.unique_count??0,top_values:(t.valueStats?.[e]?.top_values||[]).slice(0,5)})))};let n=JSON.stringify(r,null,2);return n.length>m&&(n=`${n.slice(0,m)}\n... (truncated for token safety)`),n}($,je)),[$,je]),Ne=(e,t="info")=>{q({text:e,tone:t})};async function Ce(e){ae(e);const t=w(e);if(!t){const e=O(je,M,{xField:de,yField:me,groupField:ge,agg:ye,errorMetric:be,multiCharts:we});if(e&&e.option)return Y(e.summary||"Offline visualization."),Q(e.insights||[]),ee(e.option),void ae(JSON.stringify({mode:"offline",chart_option:e.option},null,2));throw new Error("AI response was not valid JSON.")}Y(t.summary||"AI did not return a summary."),Q(Array.isArray(t.insights)?t.insights:[]);const r=t&&(t.tukey_letters||t.tukeyLetters||t.letters||t.annotations_letters)||null;let n=_(t.chart_option||t.chartOption||t.option||k(t.chart_config||t.chartConfig),{letters:r,errorBars:t.error_bars,categoryHints:je?.categoryHints||[]});n?(Array.isArray(t.error_bars)&&t.error_bars.length>0&&(n=T(n,t.error_bars)),r&&"object"==typeof r&&(n=function(e,t){try{if(!e||!t||"object"!=typeof t)return e;if(0===Object.keys(t).length)return e;const r=Array.isArray(e.series)?e.series.map((e=>({...e}))):[];if(0===r.length)return e;const n=r.findIndex((e=>"bar"===String(e?.type||"").toLowerCase()));if(-1===n)return e;const a={...r[n]},s=a.label||{};return a.label={show:!0,position:"top",color:"var(--ifm-color-emphasis-900)",fontSize:14,fontWeight:"600",backgroundColor:"rgba(255,255,255,0.0)",padding:[0,0,4,0],offset:[0,-4],...s,formatter:e=>t&&t[e.name]||""},delete a.markPoint,delete a.markLine,r[n]=a,{...e,series:r}}catch(r){return e}}(n,r)),ee(n)):re("AI response missing a valid chart_option; please retry with clearer instructions.")}function _e(e,t){const r=t.slice(0,d),n=e.reduce(((e,r)=>{const n=new Map;t.forEach((e=>{const t=e[r];t&&String(t).length>0&&n.set(t,(n.get(t)||0)+1)}));const a=Array.from(n.entries()).sort(((e,t)=>t[1]-e[1])).slice(0,8).map((([e,t])=>({value:e,count:t})));return e[r]={unique_count:n.size,top_values:a},e}),{}),a=e.filter((e=>{const t=r.map((t=>t[e])).filter((e=>C(e))).length;return(r.length>0?t/r.length:0)>=.6})),s=e.filter((e=>!a.includes(e))).flatMap((e=>(n[e]?.top_values||[]).map((e=>e.value)))).filter(((e,t,r)=>e&&r.indexOf(e)===t)).slice(0,40);return{headers:e,sampleRows:r,rows:t,delimiter:",",rowCount:t.length,numericHints:a,valueStats:n,categoryHints:s}}(0,n.useEffect)((()=>{let e=!1;return async function(){if(se.current&&Z){ue("");try{const t=await("undefined"==typeof window?Promise.resolve(null):window.echarts?Promise.resolve(window.echarts):x||(x=new Promise(((e,t)=>{const r=document.querySelector('script[data-echarts-loader="true"]');if(r)return window.echarts?void e(window.echarts):(r.addEventListener("load",(()=>e(window.echarts))),void r.addEventListener("error",(e=>t(e))));const n=document.createElement("script");n.src=y,n.async=!0,n.dataset.echartsLoader="true",n.onload=()=>e(window.echarts),n.onerror=e=>t(e||new Error("Failed to load ECharts script.")),document.body.appendChild(n)})),x));if(!t||!se.current||e)return;oe.current||(oe.current=t.init(se.current)),oe.current.setOption(Z,!0),oe.current.resize(),le(!0)}catch(t){ue(t?.message||"Chart rendering failed."),le(!1)}}else le(!1)}(),()=>{e=!0,oe.current&&(oe.current.dispose(),oe.current=null)}}),[Z]),(0,n.useEffect)((()=>{if("undefined"==typeof window)return;const e=()=>{oe.current&&oe.current.resize()};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const ke=Math.min(d,je?.sampleRows?.length||0);return(0,u.jsx)(s.A,{title:"AI Data Visualizer",children:(0,u.jsxs)("main",{className:c.appContainer,children:[(0,u.jsxs)("div",{className:c.heroRow,children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h1",{className:c.heroTitle,children:"AI Data Visualizer"}),(0,u.jsx)("p",{className:c.heroDescription,children:"Upload a CSV/TSV file, describe what you want to learn, and let the AI suggest an interactive ECharts visualization plus insights. Everything runs in your browser \u2014 no server-side storage."})]}),(0,u.jsx)("a",{className:"button button--secondary",href:"/docs/tutorial-apps/ai-data-visualizer-tutorial",children:"Tutorial"})]}),(0,u.jsx)(o.A,{}),(0,u.jsxs)("div",{className:c.mainGrid,children:[(0,u.jsxs)("div",{className:c.leftColumn,children:[(0,u.jsxs)("section",{className:c.card,children:[(0,u.jsxs)("div",{className:c.cardHeading,children:[(0,u.jsx)("h3",{className:c.cardTitle,children:"Upload data"}),(0,u.jsx)("span",{className:c.stepBadge,children:"Step 1"})]}),(0,u.jsx)("label",{className:c.fileInputWrapper,children:(0,u.jsx)("input",{className:c.fileInput,type:"file",accept:".csv,.tsv,.xlsx,.xls,.json,text/csv,text/tab-separated-values,application/json,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:async function(e){const t=e.target.files&&e.target.files[0];if(!t)return E(null),L(""),B(null),R([]),J(""),void U({});E({name:t.name,size:t.size,type:t.type||"text/csv"}),Ne("Reading file\u2026","info");const r=(t.name||"").toLowerCase();if(r.endsWith(".xlsx")||r.endsWith(".xls")){try{const e=await("undefined"==typeof window?Promise.resolve(null):window.XLSX?Promise.resolve(window.XLSX):v||(v=new Promise(((e,t)=>{const r=document.querySelector('script[data-xlsx-loader="true"]');if(r)return window.XLSX?void e(window.XLSX):(r.addEventListener("load",(()=>e(window.XLSX))),void r.addEventListener("error",(e=>t(e))));const n=document.createElement("script");n.src=b,n.async=!0,n.dataset.xlsxLoader="true",n.onload=()=>e(window.XLSX),n.onerror=e=>t(e||new Error("Failed to load XLSX script.")),document.body.appendChild(n)})),v)),r=new FileReader;r.onload=t=>{try{const r=new Uint8Array(t.target?.result||new ArrayBuffer(0)),n=e.read(r,{type:"array"}),a=n.SheetNames||[],s={};a.forEach((t=>{const r=n.Sheets[t],a=e.utils.sheet_to_json(r,{header:1}),o=(a[0]||[]).map(((e,t)=>e&&String(e).trim()||`Column ${t+1}`)),i=a.slice(1).map((e=>{const t={};return o.forEach(((r,n)=>{t[r]=null!=e[n]?String(e[n]):""})),t}));s[t]=_e(o,i)}));const o=a[0]||"";U(s),R(a),J(o),B(s[o]||null),Ne("File ready. Configure the analysis prompt.","success")}catch(r){Ne("Failed to parse Excel file.","danger")}},r.onerror=()=>Ne("Failed to read file. Please try again.","danger"),r.readAsArrayBuffer(t)}catch(a){Ne("Failed to load Excel parser.","danger")}return}const n=new FileReader;n.onload=e=>{const n=e.target?.result||"";if(r.endsWith(".json")||"application/json"===t.type)try{const e=function(e){if(Array.isArray(e)){const t=e.slice(0,200),r=new Set;t.forEach((e=>{e&&"object"==typeof e&&Object.keys(e).forEach((e=>r.add(e)))}));const n=Array.from(r),a=e.map((e=>{const t={};return n.forEach((r=>{const n=e&&null!=e[r]?e[r]:"";t[r]=String(n)})),t}));return _e(n,a)}if(e&&"object"==typeof e){if(Array.isArray(e.data)&&Array.isArray(e.columns)){const t=e.columns.map(((e,t)=>e&&String(e).trim()||`Column ${t+1}`)),r=e.data.map((e=>{const r={};return t.forEach(((t,n)=>{r[t]=null!=e[n]?String(e[n]):""})),r}));return _e(t,r)}if(Array.isArray(e.rows)&&Array.isArray(e.headers)){const t=e.headers.map(((e,t)=>e&&String(e).trim()||`Column ${t+1}`)),r=e.rows.map((e=>{const r={};return t.forEach((t=>{r[t]=e&&null!=e[t]?String(e[t]):""})),r}));return _e(t,r)}}const t=JSON.stringify(e);return N(t)||null}(JSON.parse(n));B(e),L(""),Ne("File ready. Configure the analysis prompt.","success")}catch(a){L(n),B(null),Ne("JSON parse failed. Treating as text.","warning")}else B(null),L(n),Ne("File ready. Configure the analysis prompt.","success")},n.onerror=()=>{Ne("Failed to read file. Please try again.","danger")},n.readAsText(t)}})}),P&&P.length>1&&(0,u.jsxs)("label",{className:c.fieldLabel,children:["Excel sheet",(0,u.jsx)("select",{className:c.textInput,value:H,onChange:e=>{const t=e.target.value;J(t),B(D[t]||null)},children:P.map((e=>(0,u.jsx)("option",{value:e,children:e},e)))})]}),$&&(0,u.jsxs)("p",{className:c.metaText,children:[(0,u.jsx)("strong",{children:$.name})," \u2022 ",($.size/1024).toFixed(1)," KB"]}),X?.text&&(0,u.jsx)("div",{className:(0,a.A)(c.statusBadge,c[`status--${X.tone||"info"}`]),children:X.text})]}),(0,u.jsxs)("section",{className:c.card,children:[(0,u.jsxs)("div",{className:c.cardHeading,children:[(0,u.jsx)("h3",{className:c.cardTitle,children:"Analysis goal & API"}),(0,u.jsx)("span",{className:c.stepBadge,children:"Step 2"})]}),(0,u.jsx)("textarea",{className:c.textArea,value:M,onChange:e=>I(e.target.value),placeholder:"Tell the AI what kind of pattern or story to highlight."}),je&&(0,u.jsxs)("div",{className:c.fieldGroup,children:[(0,u.jsxs)("label",{className:c.fieldLabel,children:["X Field",(0,u.jsxs)("select",{className:c.textInput,value:de,onChange:e=>pe(e.target.value),children:[(0,u.jsx)("option",{value:"",children:"Auto"}),je.headers.map((e=>(0,u.jsx)("option",{value:e,children:e},e)))]})]}),(0,u.jsxs)("label",{className:c.fieldLabel,children:["Y Field",(0,u.jsxs)("select",{className:c.textInput,value:me,onChange:e=>he(e.target.value),children:[(0,u.jsx)("option",{value:"",children:"Auto"}),je.headers.map((e=>(0,u.jsx)("option",{value:e,children:e},e)))]})]}),(0,u.jsxs)("label",{className:c.fieldLabel,children:["Group",(0,u.jsxs)("select",{className:c.textInput,value:ge,onChange:e=>fe(e.target.value),children:[(0,u.jsx)("option",{value:"",children:"None"}),je.headers.map((e=>(0,u.jsx)("option",{value:e,children:e},e)))]})]}),(0,u.jsxs)("label",{className:c.fieldLabel,children:["Aggregation",(0,u.jsxs)("select",{className:c.textInput,value:ye,onChange:e=>xe(e.target.value),children:[(0,u.jsx)("option",{value:"mean",children:"mean"}),(0,u.jsx)("option",{value:"median",children:"median"}),(0,u.jsx)("option",{value:"sum",children:"sum"}),(0,u.jsx)("option",{value:"count",children:"count"})]})]}),(0,u.jsxs)("label",{className:c.fieldLabel,children:["Error Bars",(0,u.jsxs)("select",{className:c.textInput,value:be,onChange:e=>ve(e.target.value),children:[(0,u.jsx)("option",{value:"none",children:"none"}),(0,u.jsx)("option",{value:"stddev",children:"stddev"}),(0,u.jsx)("option",{value:"se",children:"se"})]})]}),(0,u.jsxs)("label",{className:c.checkboxRow,children:[(0,u.jsx)("input",{type:"checkbox",checked:we,onChange:e=>Ae(e.target.checked)}),"Side-by-side multi charts"]}),(0,u.jsx)("button",{className:"button button--secondary margin-top--sm",onClick:()=>{const e=O(je,M,{xField:de,yField:me,groupField:ge,agg:ye,errorMetric:be,multiCharts:we});e&&e.option&&(Y(e.summary||"Offline visualization."),Q(e.insights||[]),ee(e.option),ae(JSON.stringify({mode:"offline-mapping",chart_option:e.option},null,2)))},disabled:!je,children:"Apply field mapping"})]}),(0,u.jsxs)("label",{className:c.fieldLabel,children:["Model",(0,u.jsx)("input",{className:c.textInput,value:A,onChange:e=>S(e.target.value),placeholder:"hunyuan-t1-latest"})]}),(0,u.jsx)("button",{className:"button button--primary margin-top--sm",onClick:async function(){if(je){G(!0),Ne("Building prompt\u2026","info"),re(""),ue(""),ae(""),Y(""),Q([]),ee(null),le(!1);try{const r=j({datasetSummary:Se||"No dataset summary available.",goal:M,mapping:{xField:de,yField:me,groupField:ge,agg:ye,errorMetric:be,multiCharts:we}}),n=t?e:p&&p.trim()&&/^https?:\/\//.test(p.trim())?p.trim():"mock://ai-data-visualizer",a=n===e;Ne("Calling AI\u2026","info");let s={question:r,model:A},o={};if(n===l.kh)s=(0,l.lJ)(r,A),o={Authorization:`Bearer ${l.wn}`};else if(!t&&g.trim()){const e=g.trim();o={Authorization:e.toLowerCase().startsWith("bearer ")?e:`Bearer ${e}`},s.response_format={type:"json_object"}}const i=await(0,l.B2)(n,s,o);if(!i.ok){const e=await i.text().catch((()=>""));if(a&&[403,404,405].includes(i.status)){const e=await(0,l.B2)("mock://ai-data-visualizer",s),t=await e.json(),r=(0,l.dO)(t);return await Ce(r),void Ne("Mock response shown (default endpoint unavailable).","warning")}throw new Error(e||`API call failed (${i.status})`)}const c=await i.json().catch((async()=>({raw:await i.text()}))),u=(0,l.dO)(c);await Ce(u),Ne("Visualization ready!","success")}catch(r){try{let e={question:j({datasetSummary:Se||"No dataset summary available.",goal:M,mapping:{xField:de,yField:me,groupField:ge,agg:ye,errorMetric:be,multiCharts:we}}),model:A};const t=await(0,l.B2)("mock://ai-data-visualizer",e),r=await t.json(),n=(0,l.dO)(r);await Ce(n),Ne("Mock response shown (AI call failed; using local).","warning")}catch(n){const e=O(je,M,{xField:de,yField:me,groupField:ge,agg:ye,errorMetric:be,multiCharts:we});e&&e.option?(Y(e.summary||"Offline visualization."),Q(e.insights||[]),ee(e.option),ae(JSON.stringify({mode:"offline",chart_option:e.option},null,2)),Ne("AI failed; offline visualization generated.","warning")):(re(r?.message||"AI call failed."),Ne("Analysis failed.","danger"))}}finally{G(!1)}}else Ne("Please upload a CSV or TSV file first.","warning")},disabled:V||!je||"undefined"!=typeof window&&!window.__APP_AUTH_OK__,children:V?"Analyzing\u2026":"Generate visualization"}),(0,u.jsxs)("label",{className:c.checkboxRow,children:[(0,u.jsx)("input",{type:"checkbox",checked:t,onChange:e=>r(e.target.checked)}),"Use built-in HunYuan endpoint"]}),!t&&(0,u.jsxs)("div",{className:c.fieldGroup,children:[(0,u.jsxs)("label",{className:c.fieldLabel,children:["API URL",(0,u.jsx)("input",{type:"text",className:c.textInput,value:p,onChange:e=>h(e.target.value),placeholder:"https://your-proxy-endpoint/v1/chat/completions"})]}),(0,u.jsxs)("label",{className:c.fieldLabel,children:["Bearer token",(0,u.jsx)("input",{type:"password",className:c.textInput,value:g,onChange:e=>f(e.target.value),placeholder:"sk-..."})]}),(0,u.jsx)("p",{className:c.metaText,children:"Keys never leave your browser. Leave blank to use the offline mock endpoint."})]})]}),(0,u.jsxs)("section",{className:c.card,children:[(0,u.jsx)("div",{className:c.cardHeading,children:(0,u.jsx)("h3",{className:c.cardTitle,children:"Dataset summary sent to AI"})}),(0,u.jsx)("textarea",{className:(0,a.A)(c.textArea,c.monoArea),value:Se,readOnly:!0})]})]}),(0,u.jsxs)("div",{className:c.rightColumn,children:[(0,u.jsxs)("section",{className:c.card,children:[(0,u.jsx)("div",{className:c.cardHeading,children:(0,u.jsxs)("h3",{className:c.cardTitle,children:["Preview (first ",ke," rows)"]})}),je?(0,u.jsx)("div",{className:c.tableScroll,children:(0,u.jsxs)("table",{className:c.previewTable,children:[(0,u.jsx)("thead",{children:(0,u.jsx)("tr",{children:je.headers.map((e=>(0,u.jsx)("th",{children:e},e)))})}),(0,u.jsx)("tbody",{children:je.sampleRows.slice(0,10).map(((e,t)=>(0,u.jsx)("tr",{children:je.headers.map((t=>(0,u.jsx)("td",{children:e[t]||"-"},t)))},t)))})]})}):(0,u.jsx)("p",{className:c.metaText,children:"No data preview yet."})]}),(0,u.jsxs)("section",{className:c.card,children:[(0,u.jsx)("div",{className:c.cardHeading,children:(0,u.jsx)("h3",{className:c.cardTitle,children:"AI Insights"})}),te&&(0,u.jsx)("p",{className:c.errorText,children:te}),W&&(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Summary:"})," ",W]}),K.length>0&&(0,u.jsx)("ul",{className:c.insightList,children:K.map(((e,t)=>(0,u.jsx)("li",{children:e},t)))}),!W&&0===K.length&&!te&&(0,u.jsx)("p",{className:c.metaText,children:"Run an analysis to see highlights here."})]}),(0,u.jsxs)("section",{className:c.card,children:[(0,u.jsxs)("div",{className:c.cardHeading,children:[(0,u.jsx)("h3",{className:c.cardTitle,children:"Interactive chart"}),(0,u.jsx)("button",{className:"button button--secondary button--sm",onClick:function(){if(!oe.current)return;const e=getComputedStyle(document.documentElement).getPropertyValue("--ifm-background-color").trim()||"#ffffff",t=oe.current.getDataURL({type:"png",pixelRatio:2,backgroundColor:e}),r=document.createElement("a");r.href=t,r.download=`ai-chart-${Date.now()}.png`,r.click()},disabled:!ie,children:"Download PNG"})]}),ce&&(0,u.jsx)("p",{className:c.errorText,children:ce}),(0,u.jsx)("div",{className:c.chartShell,children:(0,u.jsx)("div",{ref:se,className:c.chartContainer})})]}),(0,u.jsxs)("section",{className:c.card,children:[(0,u.jsx)("div",{className:c.cardHeading,children:(0,u.jsx)("h3",{className:c.cardTitle,children:"Raw AI response"})}),(0,u.jsx)("pre",{className:c.codeBlock,children:ne||"No response yet."})]})]})]}),(0,u.jsx)(i.A,{})]})})}function O(e,t,r={}){if(!e||!Array.isArray(e.headers)||0===(e.rows||[]).length)return null;const n=function(e){const t=String(e||"").toLowerCase(),r=[];return[["correlation","correlation|\u76f8\u5173\u6027|\u70ed\u56fe|heatmap"],["scatter","scatter|\u6563\u70b9"],["boxplot","boxplot|\u7bb1\u7ebf|\u7bb1\u578b"],["anova","anova|tukey|\u663e\u8457|\u5dee\u5f02"],["histogram","histogram|\u76f4\u65b9|\u5206\u5e03"],["line","line|\u6298\u7ebf|\u65f6\u95f4|\u8d8b\u52bf"],["bar","bar|\u67f1\u72b6"],["pie","pie|\u997c\u56fe"]].forEach((([e,n])=>{new RegExp(n).test(t)&&r.push(e)})),r}(t||""),a=e.headers.filter((t=>e.numericHints.includes(t))),s=e.headers.filter((t=>!e.numericHints.includes(t))),{xField:o,yField:i,groupField:l,agg:c="mean",errorMetric:u="none",multiCharts:d=!1}=r;if(o&&i){if(!l){const t=function(e,t,r,n){const a=new Map;e.forEach((e=>{const n=e[t],s=z(e[r]);if(null==n||null==s)return;const o=a.get(n)||[];o.push(s),a.set(n,o)}));const s=Array.from(a.keys()),o=s.map((e=>L(a.get(e),n)));return{labels:s,values:o}}(e.rows,o,i,c);let r=X(t.labels,t.values,o,`${c}(${i})`);if("none"!==u){const t=function(e,t,r,n){const a=new Map;e.forEach((e=>{const n=e[t],s=z(e[r]);if(null==n||null==s)return;const o=a.get(n)||[];o.push(s),a.set(n,o)}));const s=[];return Array.from(a.keys()).forEach((e=>{const t=a.get(e)||[],r=t.length;if(0===r)return;const o=t.reduce(((e,t)=>e+t),0)/r,i=Math.sqrt(t.reduce(((e,t)=>e+(t-o)*(t-o)),0)/Math.max(1,r-1)),l=i/Math.sqrt(r);"stddev"===n?s.push({name:e,low:o-i,high:o+i}):"se"===n&&s.push({name:e,low:o-l,high:o+l})})),s}(e.rows,o,i,u);r=T(r,t)}if(d){const t=J(e.rows,i,12);return{option:U(r,D(t.labels,t.counts,i)),summary:`${c}(${i}) by ${o} + histogram`,insights:[]}}return{option:r,summary:`${c}(${i}) by ${o}`,insights:[]}}const t=function(e,t,r,n,a){const s=[],o=new Map,i=[],l=new Map,c=[];e.forEach((e=>{const a=e[t],u=e[n],d=z(e[r]);if(null==a||null==u||null==d)return;o.has(a)||(o.set(a,s.length),s.push(a)),l.has(u)||(l.set(u,i.length),i.push(u),c.push({name:u,values:Array.from({length:s.length},(()=>[]))}));const p=o.get(a),m=l.get(u);c[m].values[p].push(d)}));const u=c.map((e=>({name:e.name,data:e.values.map((e=>L(e,a)))})));return{labels:s,series:u}}(e.rows,o,i,l,c),r=function(e,t,r,n){return _({title:{text:`${n} by ${r}`,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:n},series:t.map((e=>({type:"bar",name:e.name,data:e.data})))})}(t.labels,t.series,o,`${c}(${i})`);if(d){const t=q(e.rows,o,i,l);return{option:U(r,P(t.labelsX,t.groups,t.valuesByGroup,i)),summary:`${c}(${i}) by ${o} grouped + violin`,insights:[]}}return{option:r,summary:`${c}(${i}) by ${o} grouped by ${l}`,insights:[]}}if(n.includes("correlation")&&a.length>=2){const t=function(e,t){const r=t.length,n=t.map((()=>[]));e.forEach((e=>{const r=t.map((t=>z(e[t])));r.some((e=>null==e))||r.forEach(((e,t)=>n[t].push(e)))}));const a=Array.from({length:r},(()=>Array.from({length:r},(()=>0))));for(let s=0;s<r;s+=1)for(let e=0;e<r;e+=1)a[s][e]=F(n[s],n[e]);return{labelsX:t,labelsY:t,matrix:a}}(e.rows,a);return{option:function(e,t,r){const n=[];for(let a=0;a<e.length;a+=1)for(let e=0;e<t.length;e+=1){const t=r[e][a];n.push([a,e,Number.isFinite(t)?Math.round(100*t)/100:0])}return _({title:{text:"Correlation Heatmap",left:"center"},tooltip:{position:"top"},grid:{left:"5%",right:"5%",top:"12%",bottom:"16%"},xAxis:{type:"category",data:e},yAxis:{type:"category",data:t},series:[{type:"heatmap",data:n}],visualMap:{min:-1,max:1,calculable:!0,orient:"horizontal",left:"center",bottom:"4%"}})}(t.labelsX,t.labelsY,t.matrix),summary:"Correlation heatmap across numeric columns.",insights:[]}}if(n.includes("scatter")&&a.length>=2){const t=a[0],r=a[1],n=s[0]||null,o=function(e,t,r,n){const a={};e.forEach((e=>{const s=z(e[t]),o=z(e[r]);if(null==s||null==o)return;const i=n?String(e[n]||"Group"):"Series";a[i]||(a[i]=[]),a[i].push([s,o])}));const s=Object.keys(a).map((e=>({name:e,type:"scatter",data:a[e]})));return _({title:{text:`${t} vs ${r}`,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"value",name:t},yAxis:{type:"value",name:r},series:s})}(e.rows,t,r,n);if(d){const n=J(e.rows,r,12);return{option:U(o,D(n.labels,n.counts,r)),summary:`Scatter of ${t} vs ${r} + histogram`,insights:[]}}return{option:o,summary:`Scatter of ${t} vs ${r}.`,insights:[]}}if((n.includes("boxplot")||n.includes("anova"))&&a.length>=1&&s.length>=1){const t=a[0],r=s[0];if(l){const n=q(e.rows,r,t,l),a=function(e,t,r,n){const a=t.length,s=e=>(e-(a-1)/2)*(.8/Math.max(1,a)),o=t.map(((t,n)=>({type:"custom",name:String(t),encode:{x:0,y:[1,2,3,4]},renderItem:function(e,t){const r=e.data,a=r.xIdx+s(n),o=r.stats[0],i=r.stats[1],l=r.stats[2],c=r.stats[3],u=r.stats[4],d=t.coord([a,o]),p=t.coord([a,i]),m=t.coord([a,l]),h=t.coord([a,c]),g=t.coord([a,u]);if(!(d&&p&&m&&h&&g))return null;const f="function"==typeof t.size?.18*t.size([1,0])[0]:12,y=t.style({fill:"rgba(0,0,0,0.06)",stroke:"var(--ifm-color-emphasis-800)",lineWidth:1});return{type:"group",children:[{type:"line",shape:{x1:d[0],y1:d[1],x2:p[0],y2:p[1]},style:y},{type:"line",shape:{x1:h[0],y1:h[1],x2:g[0],y2:g[1]},style:y},{type:"line",shape:{x1:m[0]-f,y1:m[1],x2:m[0]+f,y2:m[1]},style:y},{type:"rect",shape:{x:p[0]-f,y:h[1],width:2*f,height:Math.max(1,p[1]-h[1])},style:y}]}},data:e.map(((e,n)=>({xIdx:n,stats:B(r[t][n])})))})));return _({title:{text:`Grouped Boxplot of ${n}`,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:n},legend:{top:"bottom"},series:o})}(n.labelsX,n.groups,n.valuesByGroup,t);return{option:U(a,P(n.labelsX,n.groups,n.valuesByGroup,t)),summary:`Grouped boxplot + violin of ${t} by ${r}`,insights:[]}}const n=function(e,t,r){const n=new Map;e.forEach((e=>{const a=e[t],s=z(e[r]);if(null==a||null==s)return;const o=n.get(a)||[];o.push(s),n.set(a,o)}));const a=Array.from(n.keys()),s=a.map((e=>B(n.get(e))));return{labels:a,boxes:s}}(e.rows,r,t);return{option:(p=n.labels,m=n.boxes,_({title:{text:"Boxplot",left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:p},yAxis:{type:"value"},series:[{type:"boxplot",data:m}]})),summary:`Distribution of ${t} by ${r}.`,insights:[]}}var p,m;if(n.includes("violin")&&a.length>=1&&s.length>=1){const t=a[0],r=s[0],n=function(e,t,r){const n=new Map;e.forEach((e=>{const a=e[t],s=z(e[r]);if(null==a||null==s)return;const o=n.get(a)||[];o.push(s),n.set(a,o)}));const a={};return Array.from(n.keys()).forEach((e=>{a[e]=n.get(e)})),a}(e.rows,r,t),o=function(e,t,r){const n=e.map(((e,r)=>({xIdx:r,label:e,values:t[e]||[]})));return _({title:{text:`Violin of ${r}`,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:r},series:[{type:"custom",name:"Violin",renderItem:function(e,t){const r=e.data,n=r.xIdx,a=Array.isArray(r.values)?r.values.filter((e=>Number.isFinite(e))):[];if(0===a.length)return null;const s=Math.min.apply(null,a),o=Math.max.apply(null,a),i=30,l=R(a),c=Array.from({length:i},((e,t)=>s+t/(i-1)*(o-s))),u=c.map((e=>H(a,e,l))),d=Math.max.apply(null,u)||1,p="function"==typeof t.size?.15*t.size([1,0])[0]:12,m=[],h=[];for(let g=0;g<c.length;g+=1){const e=u[g]/d*p,r=t.coord([n-.3,c[g]]),a=t.coord([n+.3,c[g]]);m.push([r[0]-e,r[1]]),h.push([a[0]+e,a[1]])}return{type:"polygon",shape:{points:m.concat(h.reverse())},style:t.style({fill:"rgba(79,129,189,0.35)",stroke:"var(--ifm-color-emphasis-800)"})}},encode:{x:0,y:1},data:n}]})}(Object.keys(n),n,t);return{option:o,summary:`Violin of ${t} by ${r}.`,insights:[]}}if(n.includes("histogram")&&a.length>=1){const t=a[0],r=J(e.rows,t,12);return{option:D(r.labels,r.counts,t),summary:`Histogram of ${t}.`,insights:[]}}const h=a[0],g=s[0];if(h&&g){const t=function(e,t,r){const n=new Map;e.forEach((e=>{const a=e[t],s=z(e[r]);if(null==a||null==s)return;const o=n.get(a)||{sum:0,count:0};o.sum+=s,o.count+=1,n.set(a,o)}));const a=Array.from(n.keys()),s=a.map((e=>{const t=n.get(e);return t.count>0?t.sum/t.count:0}));return{labels:a,means:s}}(e.rows,g,h);return{option:X(t.labels,t.means,g,h),summary:`Mean ${h} by ${g}.`,insights:[]}}if(h&&!g){const t=function(e,t){const r=e.map((e=>z(e[t]))).filter((e=>null!=e)),n=r.map(((e,t)=>`Item ${t+1}`));return{labels:n,values:r}}(e.rows,h),r=function(e,t,r){return _({title:{text:r,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:e},yAxis:{type:"value"},series:[{type:"line",name:r,smooth:!0,data:t}]})}(t.labels,t.values,h);return{option:r,summary:`Sequence of ${h}.`,insights:[]}}return null}function z(e){if(null==e)return null;const t=String(e).trim().replace(/,/g,"").replace(/%$/,"").replace(/^\((.*)\)$/,"-$1"),r=Number(t);return Number.isFinite(r)?r:null}function L(e,t){const r=(e||[]).filter((e=>null!=e));if(0===r.length)return 0;if("sum"===t)return r.reduce(((e,t)=>e+t),0);if("count"===t)return r.length;if("median"===t){const e=r.slice().sort(((e,t)=>e-t)),t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}return r.reduce(((e,t)=>e+t),0)/r.length}function F(e,t){const r=Math.min(e.length,t.length);if(0===r)return 0;let n=0,a=0,s=0,o=0,i=0;for(let p=0;p<r;p+=1){const r=e[p],l=t[p];n+=r,a+=l,s+=r*r,o+=l*l,i+=r*l}const l=i/r-n/r*(a/r),c=s/r-n/r*(n/r),u=o/r-a/r*(a/r),d=Math.sqrt(c*u);return Number.isFinite(d)&&0!==d?l/d:0}function B(e){const t=(e||[]).slice().sort(((e,t)=>e-t));if(0===t.length)return[0,0,0,0,0];const r=e=>{const r=(t.length-1)*e,n=Math.floor(r),a=Math.ceil(r);if(n===a)return t[n];const s=r-n;return t[n]*(1-s)+t[a]*s},n=t[0],a=t[t.length-1];return[n,r(.25),r(.5),r(.75),a]}function P(e,t,r,n){const a=t.length,s=t.map(((t,n)=>({type:"custom",name:String(t),renderItem:function(e,t){const r=e.data,s=r.xIdx+(e=>(e-(a-1)/2)*(.8/Math.max(1,a)))(n),o=Array.isArray(r.values)?r.values.filter((e=>Number.isFinite(e))):[];if(0===o.length)return null;const i=Math.min.apply(null,o),l=Math.max.apply(null,o),c=R(o),u=Array.from({length:30},((e,t)=>i+t/29*(l-i))),d=u.map((e=>H(o,e,c))),p=Math.max.apply(null,d)||1,m="function"==typeof t.size?.12*t.size([1,0])[0]:10,h=[],g=[];for(let n=0;n<u.length;n+=1){const e=d[n]/p*m,r=t.coord([s,u[n]]);h.push([r[0]-e,r[1]]),g.push([r[0]+e,r[1]])}return{type:"polygon",shape:{points:h.concat(g.reverse())},style:t.style({fill:"rgba(79,129,189,0.25)",stroke:"var(--ifm-color-emphasis-800)"})}},data:e.map(((e,n)=>({xIdx:n,values:r[t][n]||[]})))})));return _({title:{text:`Grouped Violin of ${n}`,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:n},legend:{top:"bottom"},series:s})}function R(e){const t=e.length,r=e.reduce(((e,t)=>e+t),0)/t;return 1.06*Math.sqrt(e.reduce(((e,t)=>e+(t-r)*(t-r)),0)/Math.max(1,t-1))*Math.pow(t,-.2)||(Math.max(...e)-Math.min(...e))/20||1}function H(e,t,r){const n=1/(r*Math.sqrt(2*Math.PI));let a=0;for(let s=0;s<e.length;s+=1){const n=(t-e[s])/r;a+=Math.exp(-.5*n*n)}return n*a}function J(e,t,r){const n=e.map((e=>z(e[t]))).filter((e=>null!=e));if(0===n.length)return{labels:[],counts:[]};const a=Math.min(...n),s=(Math.max(...n)-a)/Math.max(1,r),o=Array.from({length:r+1},((e,t)=>a+t*s)),i=Array.from({length:r},(()=>0));n.forEach((e=>{const t=Math.min(r-1,Math.max(0,Math.floor((e-a)/s)));i[t]+=1}));return{labels:Array.from({length:r},((e,t)=>`${o[t].toFixed(2)}\u2013${o[t+1].toFixed(2)}`)),counts:i}}function D(e,t,r){return _({title:{text:`Histogram of ${r}`,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:e},yAxis:{type:"value"},series:[{type:"bar",name:r,data:t}]})}function U(e,t){const r=_(e)||{},n=_(t)||{},a=Array.isArray(r.xAxis)?r.xAxis[0]:r.xAxis||{type:"category"},s=Array.isArray(r.yAxis)?r.yAxis[0]:r.yAxis||{type:"value"},o=Array.isArray(n.xAxis)?n.xAxis[0]:n.xAxis||{type:"category"},i=Array.isArray(n.yAxis)?n.yAxis[0]:n.yAxis||{type:"value"},l=Array.isArray(r.series)?r.series.map((e=>({...e,xAxisIndex:0,yAxisIndex:0}))):[],c=Array.isArray(n.series)?n.series.map((e=>({...e,xAxisIndex:1,yAxisIndex:1}))):[];return{color:r.color||n.color||h,tooltip:{trigger:"axis"},legend:{top:"bottom"},grid:[{left:"6%",right:"52%",top:"10%",bottom:"12%",containLabel:!0},{left:"52%",right:"6%",top:"10%",bottom:"12%",containLabel:!0}],xAxis:[{...a,gridIndex:0},{...o,gridIndex:1}],yAxis:[{...s,gridIndex:0},{...i,gridIndex:1}],series:[...l,...c]}}function X(e,t,r,n){return _({title:{text:`Mean ${n} by ${r}`,left:"center"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:e},yAxis:{type:"value",name:n},series:[{type:"bar",name:n,data:t}]})}function q(e,t,r,n){const a=[],s=new Map,o=[],i=new Map,l={};return e.forEach((e=>{const c=e[t],u=e[n],d=z(e[r]);if(null==c||null==u||null==d)return;s.has(c)||(s.set(c,a.length),a.push(c)),i.has(u)||(i.set(u,o.length),l[u]=Array.from({length:a.length},(()=>[])),o.push(u));const p=s.get(c);l[u][p].push(d)})),{labelsX:a,groups:o,valuesByGroup:l}}}}]);