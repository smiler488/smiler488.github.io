"use strict";(self.webpackChunkliangchao_website=self.webpackChunkliangchao_website||[]).push([[2597],{1851:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n(6540),a=n(9139),l=n(4848);function s(){return new Promise((e=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition((t=>{const{latitude:n,longitude:i,altitude:a}=t.coords||{};e({latitude:"number"==typeof n?n:null,longitude:"number"==typeof i?i:null,altitude:"number"==typeof a?a:null})}),(()=>e({latitude:null,longitude:null,altitude:null})),{enableHighAccuracy:!0,timeout:15e3,maximumAge:0}):e({latitude:null,longitude:null,altitude:null})}))}function o(e,t=6){if(null==e||Number.isNaN(e))return"";const n=Number(e);return Number.isFinite(n)?n.toFixed(t):""}function d(){const e=function(){const[e,t]=(0,i.useState)({alpha:0,beta:0,gamma:0}),n=(0,i.useRef)(null);return(0,i.useEffect)((()=>(n.current=e=>{t({alpha:"number"==typeof e.alpha?e.alpha:0,beta:"number"==typeof e.beta?e.beta:0,gamma:"number"==typeof e.gamma?e.gamma:0})},window.addEventListener("deviceorientation",n.current),()=>{n.current&&window.removeEventListener("deviceorientation",n.current)})),[]),e}(),[t,n]=(0,i.useState)(""),[d,r]=(0,i.useState)(null),[c,u]=(0,i.useState)({latitude:null,longitude:null,altitude:null}),[g,p]=(0,i.useState)([]),[h,m]=(0,i.useState)(!1),[f,x]=(0,i.useState)(null);async function y(){return await async function(){try{return"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?"granted"===await DeviceMotionEvent.requestPermission():"undefined"==typeof DeviceOrientationEvent||"function"!=typeof DeviceOrientationEvent.requestPermission||"granted"===await DeviceOrientationEvent.requestPermission()}catch{return!1}}()?(r("granted"),!0):(r("denied"),x("Motion permission denied. Please allow motion/orientation access."),!1)}return(0,l.jsx)(a.A,{title:"Sensor App",children:(0,l.jsxs)("div",{className:"container",style:{padding:20,maxWidth:1100,margin:"0 auto"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,l.jsx)("h1",{style:{marginBottom:8},children:"Device Sensor Recorder"}),(0,l.jsx)("a",{href:"/docs/sensor-app-tutorial",style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",textDecoration:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"500",transition:"all 0.2s ease"},onMouseOver:e=>{e.target.style.backgroundColor="#0056b3",e.target.style.transform="scale(1.05)"},onMouseOut:e=>{e.target.style.backgroundColor="#007bff",e.target.style.transform="scale(1)"},children:"Tutorial"})]}),(0,l.jsx)("p",{style:{color:"#555",marginTop:0},children:"Enter leaf ID, then click \u201cCapture Sample\u201d to record device orientation (alpha/beta/gamma), time, latitude/longitude/altitude, and computed solar elevation/azimuth. Export all data as CSV."}),f&&(0,l.jsx)("div",{style:{padding:12,border:"1px solid #f5c2c7",background:"#f8d7da",color:"#842029",borderRadius:8,marginBottom:16},children:f}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"center",margin:"12px 0 20px"},children:[(0,l.jsx)("input",{type:"text",placeholder:"Enter leaf ID",value:t,onChange:e=>n(e.target.value),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #ced4da",fontSize:14}}),(0,l.jsx)("button",{onClick:async function(){if(!h){m(!0),x(null);try{if(!await y())return void m(!1);const n=await s();u(n);const i=new Date,{elevation:a,azimuth:l}=function(e,t,n){if("number"!=typeof e||"number"!=typeof t)return{elevation:null,azimuth:null};const i=Math.PI/180,a=180/Math.PI,l=new Date(n.getTime()+6e4*n.getTimezoneOffset()),s=new Date(Date.UTC(l.getUTCFullYear(),0,1)),o=Math.floor((l-s)/864e5)+1,d=2*Math.PI*(o-81)/364,r=9.87*Math.sin(2*d)-7.53*Math.cos(d)-1.5*Math.sin(d),c=e*i,u=23.45*Math.sin(2*Math.PI/365*(284+o))*i,g=15*((60*n.getHours()+n.getMinutes()+n.getSeconds()/60+4*t+r- -n.getTimezoneOffset()/60*60)/60-12)*i,p=Math.sin(c)*Math.sin(u)+Math.cos(c)*Math.cos(u)*Math.cos(g);return{elevation:Math.asin(Math.max(-1,Math.min(1,p)))*a,azimuth:(Math.atan2(Math.sin(g),Math.cos(g)*Math.sin(c)-Math.tan(u)*Math.cos(c))*a+180+360)%360}}(n.latitude,n.longitude,i),o={leafId:t||"",timestamp:i.toISOString(),latitude:n.latitude,longitude:n.longitude,altitude:n.altitude,alpha:e.alpha,beta:e.beta,gamma:e.gamma,sunElevationDeg:a,sunAzimuthDeg:l};p((e=>[...e,o]))}catch(n){x(n?.message||String(n))}finally{m(!1)}}},disabled:h,style:{padding:"10px 16px",backgroundColor:h?"#6c757d":"#20c997",color:"white",border:"none",borderRadius:8,cursor:h?"not-allowed":"pointer",fontWeight:600},children:h?"Capturing\u2026":"Capture Sample"}),(0,l.jsx)("button",{onClick:function(){if(!g.length)return;const e=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'+t.replace(/"/g,'""')+'"':t},t=[["leafId","timestamp","latitude","longitude","altitude","alpha_deg","beta_deg","gamma_deg","sunElevation_deg","sunAzimuth_deg"].join(","),...g.map((t=>[t.leafId,t.timestamp,o(t.latitude),o(t.longitude),o(t.altitude,2),o(t.alpha,6),o(t.beta,6),o(t.gamma,6),null==t.sunElevationDeg?"":Number(t.sunElevationDeg).toFixed(6),null==t.sunAzimuthDeg?"":Number(t.sunAzimuthDeg).toFixed(6)].map(e).join(",")))].join("\n"),n=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(n),a=document.createElement("a"),l=(new Date).toISOString().replace(/[:.]/g,"-");a.href=i,a.download=`sensor_leaf_data_${l}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)},disabled:!g.length,style:{padding:"10px 16px",backgroundColor:g.length?"#007bff":"#6c757d",color:"white",border:"none",borderRadius:8,cursor:g.length?"pointer":"not-allowed",fontWeight:600},children:"Export CSV"})]}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:16,marginBottom:20},children:[(0,l.jsxs)("div",{style:{padding:16,background:"#f8f9fa",borderRadius:12},children:[(0,l.jsx)("h3",{style:{marginTop:0,color:"#0d6efd"},children:"Current Orientation"}),(0,l.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)("span",{children:"Alpha (Z, yaw):"}),(0,l.jsxs)("strong",{children:[o(e.alpha,2),"\xb0"]})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)("span",{children:"Beta (X, pitch):"}),(0,l.jsxs)("strong",{children:[o(e.beta,2),"\xb0"]})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)("span",{children:"Gamma (Y, roll):"}),(0,l.jsxs)("strong",{children:[o(e.gamma,2),"\xb0"]})]}),(0,l.jsx)("button",{onClick:async()=>{await y()||x("Please allow motion/orientation access in browser settings.")},style:{marginTop:8,padding:"8px 12px",borderRadius:8,background:"granted"===d?"#198754":"#6c757d",color:"#fff",border:"none",cursor:"pointer"},children:"granted"===d?"Motion Permission Granted":"Enable Motion Permission"})]})]}),(0,l.jsxs)("div",{style:{padding:16,background:"#f8f9fa",borderRadius:12},children:[(0,l.jsx)("h3",{style:{marginTop:0,color:"#20c997"},children:"Latest Geo"}),(0,l.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)("span",{children:"Latitude:"}),(0,l.jsx)("strong",{children:o(c.latitude,6)||"N/A"})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)("span",{children:"Longitude:"}),(0,l.jsx)("strong",{children:o(c.longitude,6)||"N/A"})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,l.jsx)("span",{children:"Altitude:"}),(0,l.jsx)("strong",{children:null==c.altitude?"N/A":o(c.altitude,2)+" m"})]}),(0,l.jsx)("button",{onClick:async()=>u(await s()),style:{marginTop:8,padding:"8px 12px",borderRadius:8,background:"#0d6efd",color:"#fff",border:"none",cursor:"pointer"},children:"Refresh Location"})]})]}),(0,l.jsxs)("div",{style:{padding:16,background:"#f8f9fa",borderRadius:12},children:[(0,l.jsx)("h3",{style:{marginTop:0,color:"#6f42c1"},children:"Status"}),(0,l.jsxs)("div",{children:["Recorded rows: ",(0,l.jsx)("strong",{children:g.length})]}),(0,l.jsxs)("div",{children:["Local time: ",(0,l.jsx)("strong",{children:(new Date).toLocaleString()})]})]})]}),(0,l.jsx)("div",{style:{overflowX:"auto"},children:(0,l.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,l.jsx)("thead",{children:(0,l.jsx)("tr",{style:{background:"#f1f3f5"},children:["leafId","timestamp","latitude","longitude","altitude","alpha_deg","beta_deg","gamma_deg","sunElevation_deg","sunAzimuth_deg"].map((e=>(0,l.jsx)("th",{style:{textAlign:"left",padding:8,borderBottom:"1px solid #dee2e6"},children:e},e)))})}),(0,l.jsxs)("tbody",{children:[g.map(((e,t)=>(0,l.jsxs)("tr",{style:{borderBottom:"1px solid #f1f3f5"},children:[(0,l.jsx)("td",{style:{padding:8},children:e.leafId}),(0,l.jsx)("td",{style:{padding:8},children:e.timestamp}),(0,l.jsx)("td",{style:{padding:8},children:o(e.latitude,6)}),(0,l.jsx)("td",{style:{padding:8},children:o(e.longitude,6)}),(0,l.jsx)("td",{style:{padding:8},children:null==e.altitude?"":o(e.altitude,2)}),(0,l.jsx)("td",{style:{padding:8},children:o(e.alpha,6)}),(0,l.jsx)("td",{style:{padding:8},children:o(e.beta,6)}),(0,l.jsx)("td",{style:{padding:8},children:o(e.gamma,6)}),(0,l.jsx)("td",{style:{padding:8},children:null==e.sunElevationDeg?"":Number(e.sunElevationDeg).toFixed(6)}),(0,l.jsx)("td",{style:{padding:8},children:null==e.sunAzimuthDeg?"":Number(e.sunAzimuthDeg).toFixed(6)})]},t))),!g.length&&(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:10,style:{padding:12,color:"#666"},children:"No data yet. Enter ID and click \u201cCapture Sample\u201d."})})]})]})}),(0,l.jsxs)("div",{style:{backgroundColor:"#fff",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.08)",overflow:"hidden",marginTop:24},children:[(0,l.jsx)("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:16},children:(0,l.jsx)("h2",{style:{margin:0,fontSize:20},children:"Solar Angle Formulas"})}),(0,l.jsxs)("div",{style:{padding:16,lineHeight:1.6,color:"#333"},children:[(0,l.jsx)("p",{style:{margin:"0 0 8px"},children:"Elevation (h) and Azimuth (A) computed in this app follow common remote-sensing approximations:"}),(0,l.jsxs)("div",{style:{fontFamily:"monospace",fontSize:14,background:"#f8f9fa",border:"1px solid #e9ecef",borderRadius:8,padding:12,marginBottom:12},children:["h = asin( sin(\u03c6)\xb7sin(\u03b4) + cos(\u03c6)\xb7cos(\u03b4)\xb7cos(H) )  [in radians]",(0,l.jsx)("br",{}),"A = atan2( sin(H),  cos(H)\xb7sin(\u03c6) \u2212 tan(\u03b4)\xb7cos(\u03c6) )  [in radians]",(0,l.jsx)("br",{}),"(degrees) = (radians) \xd7 180/\u03c0",(0,l.jsx)("br",{}),"Azimuth A is reported from North, clockwise (0..360)."]}),(0,l.jsx)("p",{style:{margin:"0 0 6px"},children:(0,l.jsx)("strong",{children:"Symbols:"})}),(0,l.jsxs)("ul",{style:{margin:0,paddingLeft:18},children:[(0,l.jsx)("li",{children:"\u03c6: geographic latitude"}),(0,l.jsx)("li",{children:"\u03b4: solar declination"}),(0,l.jsx)("li",{children:"H: hour angle (H = 15\xb0 \xd7 (solar time \u2212 12))"})]}),(0,l.jsx)("p",{style:{margin:"8px 0 0",color:"#555"},children:"Note: The implementation also includes Equation of Time (EoT) and time-zone offset to estimate apparent solar time."})]})]})]})})}}}]);