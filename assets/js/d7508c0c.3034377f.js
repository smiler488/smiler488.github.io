"use strict";(self.webpackChunkliangchao_website=self.webpackChunkliangchao_website||[]).push([[4035],{6506:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var a=n(6540),r=n(1656),o=n(5260),i=n(4848);const s="undefined"!=typeof window&&window.__CLOUDNOTE_BACKEND_URL__?window.__CLOUDNOTE_BACKEND_URL__:"";function l(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}function d(e){if(!e)return new Uint8Array;const t=new Uint8Array(e.length/2);for(let n=0;n<t.length;n++)t[n]=parseInt(e.substr(2*n,2),16);return t.buffer}async function c(e,t){const n=d(t),a=(new TextEncoder).encode(e),r=await window.crypto.subtle.importKey("raw",a,"PBKDF2",!1,["deriveKey"]);return await window.crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:2e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function p(e){const t=d(e);return window.crypto.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt","encrypt"])}async function y(e,t){const n=crypto.getRandomValues(new Uint8Array(12)),a=(new TextEncoder).encode(JSON.stringify(t)),r=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},e,a);return{iv:l(n.buffer),ct:(o=r,btoa(String.fromCharCode(...new Uint8Array(o))))};var o}async function u(e,t,n){const a=d(t),r=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n.buffer}(n),o=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},e,r),i=(new TextDecoder).decode(o);return JSON.parse(i)}async function h(e,t=""){if(t&&t.length>0){const a=l(crypto.getRandomValues(new Uint8Array(16)).buffer),r=await c(t,a),o=await y(r,e),i={mode:"pw",salt:a,iv:o.iv,ct:o.ct,meta:{v:1}};try{if(e&&e.name){try{window.localStorage.setItem(`cloudnote_store:${e.name}`,JSON.stringify(i))}catch(n){console.warn("Could not save cloudnote to localStorage:",n)}try{await async function(e,t){if(s&&e)try{await fetch(`${s.replace(/\/$/,"")}/notes/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(n){console.warn("backendSavePayload failed",n)}}(e&&e.name,i)}catch(n){console.warn("backend save failed",n)}}}catch(n){console.warn("localStorage unavailable:",n)}return`note=${btoa(JSON.stringify(i))}`}{const t=await async function(){const e=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return l(await crypto.subtle.exportKey("raw",e))}(),n=await p(t),a=await y(n,e),r={mode:"key",iv:a.iv,ct:a.ct,meta:{v:1}};return`note=${btoa(JSON.stringify(r))}.${t}`}}async function x(e){try{const n=window.localStorage.getItem(`cloudnote_store:${e}`);if(n)try{return JSON.parse(n)}catch(t){}}catch(t){console.warn("Failed to read stored payload from localStorage:",t)}if(s)try{const n=await async function(e){if(!s||!e)return null;try{const t=await fetch(`${s.replace(/\/$/,"")}/notes/${encodeURIComponent(e)}`);return t.ok?await t.json():null}catch(t){return console.warn("backendFetchPayload failed",t),null}}(e);if(n)return n}catch(t){console.warn("backendFetchPayload error",t)}return null}function f(){const[e,t]=(0,a.useState)(""),[n,s]=(0,a.useState)(""),[l,d]=(0,a.useState)(""),[y,f]=(0,a.useState)(""),[g,b]=(0,a.useState)(!1),[m,j]=(0,a.useState)(""),[v,S]=(0,a.useState)(""),[k,C]=(0,a.useState)(null),[O,A]=(0,a.useState)(!1),[T,R]=(0,a.useState)(""),[N,U]=(0,a.useState)(null),[I,P]=(0,a.useState)(""),[$,_]=(0,a.useState)("");function E(e){if(!e)return!1;if(e.expiresAtISO){const t=new Date(e.expiresAtISO);if(isNaN(t.getTime()));else if(Date.now()>t.getTime())return S("This note has expired."),!1}return!0}function G(){history.replaceState(null,"",location.pathname+location.search),U(null),C(null),S("")}function K(){return!!k&&!k.readOnly}return(0,a.useEffect)((()=>{const e=function(){const e=location.hash||"";if(!e.includes("note="))return null;const t=e.split("note=")[1];if(!t)return null;const[n,a]=t.split(".");try{return{payload:JSON.parse(atob(n)),rawKeyHex:a||null}}catch(r){return null}}();U(e),e&&("pw"===e.payload.mode?(A(!0),S("Protected note \u2014 enter password to open.")):"key"===e.payload.mode?e.rawKeyHex?(async()=>{try{const t=await p(e.rawKeyHex),n=await u(t,e.payload.iv,e.payload.ct);E(n)&&(C(n),S("Opened note from link."))}catch(t){console.error(t),S("Failed to decrypt with key from link.")}})():S("Shared link missing key \u2014 cannot open."):S("Unknown link mode."))}),[]),(0,i.jsxs)(r.A,{title:"Cloud Sticky Notes",children:[(0,i.jsx)(o.A,{children:(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})}),(0,i.jsxs)("div",{style:{maxWidth:900,margin:"28px auto",padding:"12px"},children:[(0,i.jsx)("h1",{children:"Cloud Sticky Note (static)"}),(0,i.jsx)("p",{style:{color:"#444"},children:"Create a temporary/shareable note. This zero-backend version stores the note encrypted in the URL fragment. Sharing the link allows others to open it. Use a password for higher privacy (recipient must know the password)."}),(0,i.jsxs)("div",{style:{display:"grid",gap:10,marginTop:12},children:[(0,i.jsxs)("label",{children:["Note name",(0,i.jsx)("input",{style:w.input,value:e,onChange:e=>t(e.target.value)})]}),(0,i.jsxs)("label",{children:["Content",(0,i.jsx)("textarea",{rows:8,style:w.textarea,value:n,onChange:e=>s(e.target.value)})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,i.jsxs)("label",{style:{flex:1},children:["Expires (optional)",(0,i.jsx)("input",{type:"datetime-local",style:w.input,value:l,onChange:e=>d(e.target.value)})]}),(0,i.jsxs)("label",{style:{flexBasis:200},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("input",{type:"checkbox",checked:g,onChange:e=>b(e.target.checked)}),(0,i.jsx)("div",{children:"Read-only link"})]}),(0,i.jsx)("small",{style:{color:"#666"},children:"Marking read-only is advisory in static links."})]}),(0,i.jsxs)("label",{style:{flexBasis:260},children:[(0,i.jsx)("div",{children:"Protect with password (optional)"}),(0,i.jsx)("input",{style:w.input,value:y,onChange:e=>f(e.target.value),placeholder:"Optional password"}),(0,i.jsx)("small",{style:{color:"#666"},children:"If set, recipients will need the password to open the note."})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:10},children:[(0,i.jsx)("button",{onClick:async function(){try{S("Generating link...");const t={name:e||"Untitled",content:n||"",createdAtISO:(new Date).toISOString(),expiresAtISO:l?new Date(l).toISOString():null,readOnly:!!g},a=await h(t,y),r=`${location.origin}${location.pathname}#${a}`;j(r),S("Link generated. Copy and share.")}catch(t){console.error(t),S("Failed to generate link: "+t.message)}},style:w.btnPrimary,children:"Generate share link"}),(0,i.jsx)("button",{onClick:function(){m&&navigator.clipboard.writeText(m).then((()=>S("Link copied to clipboard."))).catch((e=>S("Copy failed: "+e.message)))},style:w.btnSecondary,disabled:!m,children:"Copy link"}),(0,i.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(n||"")},style:w.btnGhost,children:"Copy content"}),(0,i.jsx)("button",{onClick:()=>{t(""),s(""),d(""),f(""),b(!1),j(""),S("")},style:w.btnGhost,children:"Reset"})]}),m&&(0,i.jsxs)("div",{style:{background:"#f6f9ff",padding:8,borderRadius:6},children:[(0,i.jsx)("div",{style:{fontSize:13},children:"Share link (fragment)"}),(0,i.jsx)("textarea",{readOnly:!0,rows:2,style:w.shareArea,value:m})]}),(0,i.jsxs)("div",{style:{marginTop:6},children:[(0,i.jsx)("strong",{children:"Status:"})," ",v]}),(0,i.jsx)("hr",{}),(0,i.jsx)("h3",{children:"Open shared note (from URL)"}),(0,i.jsxs)("div",{style:{marginTop:12},children:[(0,i.jsx)("h4",{children:"Open by name & password"}),(0,i.jsxs)("div",{style:{display:"grid",gap:8,maxWidth:520},children:[(0,i.jsxs)("label",{children:["Note name",(0,i.jsx)("input",{style:w.input,value:I,onChange:e=>P(e.target.value)})]}),(0,i.jsxs)("label",{children:["Password",(0,i.jsx)("input",{type:"password",style:w.input,value:$,onChange:e=>_(e.target.value)})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("button",{onClick:async function(){if(!I)return void S("Please enter a note name to open.");const e=await x(I);if(e)if("pw"===e.mode)if($)try{const t=await c($,e.salt),n=await u(t,e.iv,e.ct);if(!E(n))return;C(n),S("Opened note by name + password."),A(!1),U(null)}catch(t){console.error(t),S("Wrong password or decryption failed.")}else S("Please enter the password to open this note.");else S("Stored note is not password-protected or cannot be opened by name/password.");else S("No stored note with that name found in this browser.")},style:w.btnPrimary,children:"Open"}),(0,i.jsx)("button",{onClick:()=>{P(""),_(""),S("")},style:w.btnGhost,children:"Clear"})]}),(0,i.jsx)("div",{style:{color:"#666",fontSize:13},children:"Notes saved by password-protected generation (this browser) are accessible by entering the same name and password."})]})]}),N?(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{padding:8,background:"#fff8e1",borderRadius:6},children:["Parsed shared link found in URL fragment. Mode: ",(0,i.jsx)("b",{children:N.payload.mode}),"."]}),"pw"===N.payload.mode&&(0,i.jsxs)("div",{style:{marginTop:8},children:[(0,i.jsx)("label",{children:"Enter password to open"}),(0,i.jsx)("input",{style:w.input,value:T,onChange:e=>R(e.target.value)}),(0,i.jsxs)("div",{style:{display:"flex",gap:8,marginTop:8},children:[(0,i.jsx)("button",{onClick:async function(){if(N)try{const e=await c(T,N.payload.salt),t=await u(e,N.payload.iv,N.payload.ct);if(!E(t))return;C(t),S("Opened note with password."),A(!1)}catch(e){console.error(e),S("Wrong password or decryption failed.")}},style:w.btnPrimary,children:"Open"}),(0,i.jsx)("button",{onClick:G,style:w.btnGhost,children:"Clear"})]})]}),"key"===N.payload.mode&&(0,i.jsxs)("div",{style:{marginTop:8},children:[(0,i.jsx)("div",{children:"Key present in fragment (auto-decrypt attempted)."}),(0,i.jsx)("div",{style:{display:"flex",gap:8,marginTop:8},children:(0,i.jsx)("button",{onClick:G,style:w.btnGhost,children:"Clear"})})]})]}):(0,i.jsxs)("div",{children:["No share fragment found in URL. To open a note, paste a link with ",(0,i.jsx)("code",{children:"#note=..."})," and reload."]}),k&&(0,i.jsxs)("div",{style:{marginTop:12,padding:12,borderRadius:8,background:"#f3fff6"},children:[(0,i.jsx)("h3",{children:k.name}),(0,i.jsxs)("div",{style:{color:"#666",fontSize:13},children:["Created: ",k.createdAtISO,k.expiresAtISO&&(0,i.jsxs)("span",{children:[" \xb7 Expires: ",k.expiresAtISO]}),k.readOnly&&(0,i.jsx)("span",{children:" \xb7 Read-only"})]}),(0,i.jsx)("div",{style:{marginTop:8},children:(0,i.jsx)("textarea",{style:w.textarea,rows:8,value:k.content,readOnly:!K(),onChange:e=>C({...k,content:e.target.value})})}),(0,i.jsxs)("div",{style:{display:"flex",gap:8,marginTop:10},children:[(0,i.jsx)("button",{disabled:!K(),onClick:async()=>{await async function(){if(!k)return;const e={...k,content:k.content,createdAtISO:k.createdAtISO||(new Date).toISOString()};let t="";N&&"pw"===N.payload.mode&&(t=T);const n=await h(e,t),a=`${location.origin}${location.pathname}#${n}`;j(a),S("Regenerated link for edited note. Copy to share.")}()},style:w.btnPrimary,children:"Save edits & regenerate link"}),(0,i.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(k.content||"")},style:w.btnSecondary,children:"Copy content"}),(0,i.jsx)("button",{onClick:G,style:w.btnGhost,children:"Close"})]})]})]})]})]})}const w={input:{width:"100%",padding:"8px 10px",marginTop:6,borderRadius:6,border:"1px solid #ccc"},textarea:{width:"100%",padding:"8px 10px",marginTop:6,borderRadius:6,border:"1px solid #ccc",fontFamily:"inherit"},shareArea:{width:"100%",borderRadius:6,border:"1px solid #ddd",padding:6},btnPrimary:{background:"#0ea5e9",color:"#fff",padding:"8px 12px",borderRadius:6,border:"none",cursor:"pointer"},btnSecondary:{background:"#2563eb",color:"#fff",padding:"8px 12px",borderRadius:6,border:"none",cursor:"pointer"},btnGhost:{background:"#fff",color:"#111",padding:"8px 12px",borderRadius:6,border:"1px solid #ddd",cursor:"pointer"}}}}]);