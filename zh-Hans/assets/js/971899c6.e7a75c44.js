"use strict";(self.webpackChunkliangchao_website=self.webpackChunkliangchao_website||[]).push([[7137],{17921:(e,t,o)=>{function n(){const e="undefined"!=typeof window?window.localStorage.getItem("app_users"):null;if(!e)return[];try{return JSON.parse(e)||[]}catch{return[]}}function r(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}async function i(e,t){const o=(new TextEncoder).encode(e),n=function(e){const t=new Uint8Array(e.length/2);for(let o=0;o<t.length;o++)t[o]=parseInt(e.substr(2*o,2),16);return t.buffer}(t),i=await crypto.subtle.importKey("raw",o,"PBKDF2",!1,["deriveBits"]);return r(await crypto.subtle.deriveBits({name:"PBKDF2",salt:n,iterations:15e4,hash:"SHA-256"},i,256))}async function s(e,t){const o=n();if(o.find((t=>t.email.toLowerCase()===String(e).toLowerCase())))throw new Error("Email already registered");const s=r(crypto.getRandomValues(new Uint8Array(16)).buffer),a=await i(t,s);return o.push({email:e,saltHex:s,hashHex:a,createdAt:(new Date).toISOString()}),function(e){"undefined"!=typeof window&&window.localStorage.setItem("app_users",JSON.stringify(e))}(o),c({email:e}),{email:e}}async function a(e,t){const o=n().find((t=>t.email.toLowerCase()===String(e).toLowerCase()));if(!o)throw new Error("Account not found");if(await i(t,o.saltHex)!==o.hashHex)throw new Error("Invalid credentials");return c({email:e}),{email:e}}function l(){if("undefined"==typeof window)return null;const e=window.localStorage.getItem("app_session");if(!e)return null;try{return JSON.parse(e)||null}catch{return null}}function c(e){"undefined"!=typeof window&&window.localStorage.setItem("app_session",JSON.stringify({email:e.email,at:Date.now()}))}function d(){"undefined"!=typeof window&&window.localStorage.removeItem("app_session")}o.d(t,{Ht:()=>l,iD:()=>a,kz:()=>s,ri:()=>d})},34619:(e,t,o)=>{o.d(t,{A:()=>a});var n=o(96540),r=o(17921),i=o(95082),s=o(74848);function a({children:e}){const[t,o]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{const e=(0,i.b)();if(e){e.auth.getUser().then((({data:e})=>{const t=!!e?.user;o(t),"undefined"!=typeof window&&(window.__APP_AUTH_OK__=t)}));const{data:t}=e.auth.onAuthStateChange(((e,t)=>{const n=!!t?.user;o(n),"undefined"!=typeof window&&(window.__APP_AUTH_OK__=n)}));return()=>t?.subscription?.unsubscribe?.()}const t=!!(0,r.Ht)();o(t),"undefined"!=typeof window&&(window.__APP_AUTH_OK__=t)}),[]),(0,s.jsxs)("div",{children:[!t&&(0,s.jsx)("div",{className:"app-card",style:{marginBottom:12},children:(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsx)("span",{className:"app-muted",children:"Please login to use app features"}),(0,s.jsx)("a",{className:"button button--secondary",href:"/auth",children:"Login / Register"})]})}),e]})}},62835:(e,t,o)=>{o.d(t,{A:()=>u});var n=o(96540),r=o(74848);const i={maxWidth:"800px",margin:"60px auto 0",textAlign:"left",padding:"0 20px"},s={fontSize:"2rem",fontWeight:"600",marginBottom:"16px",color:"var(--ifm-color-emphasis-900)"},a={fontSize:"1.1rem",color:"var(--ifm-color-emphasis-700)",lineHeight:1.6,marginBottom:"16px"},l={borderLeft:"4px solid var(--ifm-border-color)",paddingLeft:"16px",color:"var(--ifm-color-emphasis-700)",fontStyle:"italic",lineHeight:1.6,marginBottom:"16px"},c={backgroundColor:"var(--ifm-background-surface-color)",padding:"16px",borderRadius:"12px",overflowX:"auto",border:"1px solid var(--ifm-border-color)",color:"var(--ifm-color-emphasis-800)"},d={fontSize:"1.5rem",fontWeight:"600",marginBottom:"16px",color:"var(--ifm-color-emphasis-900)"};function u({containerStyle:e}){const[t,o]=(0,n.useState)(!1),[u,h]=(0,n.useState)(!1),g="LiangchaoDeng. (2025). smiler488/smiler488.github.io: Digital Plant Phenotyping Platform v25.0 (v25.0.0). Zenodo. https://doi.org/10.5281/zenodo.17544584",p="@software{Deng2025_DPPP_v25,\n  author       = {Deng, Liangchao},\n  title        = {Digital Plant Phenotyping Platform (v25.0)},\n  year         = {2025},\n  publisher    = {Zenodo},\n  doi          = {10.5281/zenodo.17544584},\n  url          = {https://doi.org/10.5281/zenodo.17544584},\n  note         = {[Computer software]}\n}";return(0,r.jsxs)("div",{style:{...i,...e},children:[(0,r.jsx)("h2",{style:s,children:"Citation"}),(0,r.jsxs)("p",{style:a,children:["If you use ",(0,r.jsx)("strong",{children:"Digital Plant Phenotyping Platform v25.0"})," or any of its applications in your research, please cite it as:"]}),(0,r.jsxs)("blockquote",{style:l,children:["LiangchaoDeng. (2025)."," ",(0,r.jsx)("em",{children:"smiler488/smiler488.github.io: Digital Plant Phenotyping Platform v25.0 (v25.0.0)"}),". Zenodo.",(0,r.jsx)("br",{}),(0,r.jsx)("a",{href:"https://doi.org/10.5281/zenodo.17544584",children:"https://doi.org/10.5281/zenodo.17544584"})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",gap:"12px"},children:[(0,r.jsx)("button",{type:"button",onClick:async()=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(g);else if("undefined"!=typeof document){const e=document.createElement("textarea");e.value=g,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}o(!0),setTimeout((()=>o(!1)),2e3)}catch{o(!1)}},style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid var(--ifm-color-emphasis-900)",backgroundColor:"var(--ifm-color-emphasis-900)",color:"var(--ifm-color-emphasis-0)",cursor:"pointer",fontSize:"0.95rem",fontWeight:500,transition:"transform 0.15s ease, background-color 0.15s ease"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-primary)",e.currentTarget.style.borderColor="var(--ifm-color-primary)",e.currentTarget.style.transform="translateY(-1px)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.borderColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.transform="translateY(0)"},children:t?"Copied!":"Copy citation"}),(0,r.jsx)("span",{style:{fontSize:"0.9rem",color:t?"var(--ifm-color-success)":"var(--ifm-color-emphasis-600)"},children:t?"Citation copied to clipboard.":"Click to copy APA citation."})]}),(0,r.jsx)("a",{href:"https://doi.org/10.5281/zenodo.17544584",style:{display:"inline-block",marginBottom:"24px"},children:(0,r.jsx)("img",{src:"https://img.shields.io/badge/DOI-10.5281%2Fzenodo.17544584-blue",alt:"DOI badge",style:{height:"28px"}})}),(0,r.jsx)("hr",{style:{border:"none",borderTop:"1px solid var(--ifm-border-color)",marginBottom:"24px"}}),(0,r.jsx)("h3",{style:d,children:"BibTeX citation (Zotero \u2192 File \u2192 Import from Clipboard)"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",gap:"12px"},children:[(0,r.jsx)("button",{type:"button",onClick:async()=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(p);else if("undefined"!=typeof document){const e=document.createElement("textarea");e.value=p,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}h(!0),setTimeout((()=>h(!1)),2e3)}catch{h(!1)}},style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid var(--ifm-color-emphasis-900)",backgroundColor:"var(--ifm-color-emphasis-900)",color:"var(--ifm-color-emphasis-0)",cursor:"pointer",fontSize:"0.95rem",fontWeight:500,transition:"transform 0.15s ease, background-color 0.15s ease"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-primary)",e.currentTarget.style.borderColor="var(--ifm-color-primary)",e.currentTarget.style.transform="translateY(-1px)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.borderColor="var(--ifm-color-emphasis-900)",e.currentTarget.style.transform="translateY(0)"},children:u?"Copied!":"Copy BibTeX"}),(0,r.jsx)("span",{style:{fontSize:"0.9rem",color:u?"var(--ifm-color-success)":"var(--ifm-color-emphasis-600)"},children:u?"BibTeX copied to clipboard. Switch to Zotero and choose Import from Clipboard.":"Click to copy BibTeX to clipboard for Zotero import."})]}),(0,r.jsx)("pre",{style:c,children:(0,r.jsx)("code",{children:p})})]})}},67608:(e,t,o)=>{o.r(t),o.d(t,{default:()=>g});var n=o(96540),r=o(63018),i=o(62835),s=o(34619),a=o(74848);const l=1800,c=60,d=10,u={bgThreshold:35,noiseKernel:3,blurRadius:24,roiThreshold:32},h={info:"root-status--info",success:"root-status--success",warning:"root-status--warning",danger:"root-status--danger"};function g(){const e="undefined"!=typeof window,[t,o]=(0,n.useState)([]),[g,v]=(0,n.useState)(0),[j,P]=(0,n.useState)("polygon"),[C,k]=(0,n.useState)("draw"),[N,_]=(0,n.useState)(14),[R,S]=(0,n.useState)(u),[I,T]=(0,n.useState)(!1),[A,D]=(0,n.useState)({text:"Upload JPG/PNG scans of root systems to begin.",tone:"info"}),O=(0,n.useRef)(null),B=(0,n.useRef)(null),E=(0,n.useRef)(null),U=(0,n.useRef)({}),L=(0,n.useRef)({}),M=(0,n.useRef)({}),z=(0,n.useRef)({}),H=(0,n.useRef)(!1),K=(0,n.useRef)(null),V=t[g]||null,F=(e,t="info")=>D({text:e,tone:t}),$=(0,n.useCallback)(((e,t)=>{o((o=>o.map((o=>{if(o.id!==e)return o;const n="function"==typeof t?t(o):t;return{...o,...n}}))))}),[]),W=(e,t)=>{S((o=>({...o,[e]:t})))},Y=(0,n.useCallback)((()=>{if(!V)return;const e=B.current;if(!e)return;const t=e.getContext("2d").getImageData(0,0,e.width,e.height);L.current[V.id]=t;const o=z.current[V.id]||[];o.push(x(t)),o.length>d&&o.shift(),z.current[V.id]=o,$(V.id,{processedVersion:Date.now(),historySize:o.length})}),[V,$]),J=(0,n.useCallback)((e=>{if(!V||"manual"!==j)return;if(!L.current[V.id])return F("Run auto-processing before manual editing.","warning"),void(H.current=!1);const t=B.current;if(!t)return;const o=t.getContext("2d");o.lineCap="round",o.lineJoin="round",o.strokeStyle="draw"===C?"#000000":"#ffffff",o.lineWidth=N;const n=y(e,t);if(Number.isFinite(n.x)&&Number.isFinite(n.y))if(H.current){o.beginPath();const e=K.current||n;o.moveTo(e.x,e.y),o.lineTo(n.x,n.y),o.stroke(),K.current=n}else H.current=!0,K.current=n,o.beginPath(),o.moveTo(n.x,n.y),o.lineTo(n.x+.1,n.y+.1),o.stroke()}),[V,j,C,N,F]);return(0,n.useEffect)((()=>{if(!e)return;const t=B.current;if(!t)return;const o=e=>{"manual"===j&&J(e)},n=e=>{"manual"===j&&H.current&&(e.preventDefault(),J(e))},r=()=>{H.current&&(H.current=!1,K.current=null,Y())};return t.addEventListener("pointerdown",o),t.addEventListener("pointermove",n),window.addEventListener("pointerup",r),t.addEventListener("pointerleave",r),()=>{t.removeEventListener("pointerdown",o),t.removeEventListener("pointermove",n),window.removeEventListener("pointerup",r),t.removeEventListener("pointerleave",r)}}),[j,J,Y,e]),(0,n.useEffect)((()=>{if(!V)return p(O.current),void p(B.current);const e=U.current[V.id];e&&m(O.current,e)}),[V]),(0,n.useEffect)((()=>{if(!V)return void p(B.current);const e=L.current[V.id];if(e&&"manual"===j)return void m(B.current,e);const t=M.current[V.id];if(t)return void m(B.current,t,V.polygonPoints,V.isPolygonClosed);const o=U.current[V.id];o&&m(B.current,o,V.polygonPoints,V.isPolygonClosed)}),[V,V?.previewVersion,V?.processedVersion,V?.polygonPoints,V?.isPolygonClosed,j]),e?(0,a.jsx)(r.A,{title:"Root Image Preprocessor",children:(0,a.jsxs)("div",{className:"root-app",children:[(0,a.jsxs)("div",{className:"root-app__header",children:[(0,a.jsx)("div",{children:(0,a.jsx)("h1",{children:"Root Image Preprocessor"})}),(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,a.jsx)("a",{className:"button button--secondary",href:"/docs/tutorial-apps/root-preprocessor-tutorial",children:"Tutorial"}),(0,a.jsx)("button",{type:"button",className:"root-button secondary",onClick:()=>E.current?.click(),disabled:"undefined"!=typeof window&&!window.__APP_AUTH_OK__,children:"Upload Images"})]})]}),(0,a.jsx)(s.A,{}),(0,a.jsx)("p",{style:{margin:"12px 0 24px"},children:"Combine automated background removal with ROI high-pass filtering and manual cleanup directly in the browser."}),(0,a.jsx)("div",{className:`root-status ${h[A.tone]||""}`,children:A.text}),(0,a.jsxs)("div",{className:"root-app__grid",children:[(0,a.jsxs)("aside",{className:"root-sidebar",children:[(0,a.jsxs)("div",{className:"root-upload",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,ref:E,onChange:async n=>{if(!e)return;const r=Array.from(n.target.files||[]);if(!r.length)return;const i=t.length;F(`Loading ${r.length} image(s)...`,"info");const s=[];for(const e of r)try{const{imageData:t,width:o,height:n}=await f(e),r=`${e.name}-${Date.now()}-${Math.random().toString(16).slice(2)}`;U.current[r]=t,M.current[r]=x(t),s.push({id:r,name:e.name,width:o,height:n,polygonPoints:[],isPolygonClosed:!1,processedVersion:0,previewVersion:0,historySize:0})}catch(a){console.error(a),F(`Unable to read ${e.name}`,"warning")}s.length&&(o((e=>[...e,...s])),v(0===i?0:i),F("Images loaded. Select ROI points on the right canvas.","success")),n.target.value=""}}),(0,a.jsxs)("p",{children:["Drag & drop or pick files. Images larger than ",l,"px on the longest edge are scaled."]})]}),(0,a.jsxs)("div",{className:"root-filelist",children:[(0,a.jsxs)("div",{className:"root-filelist__header",children:[(0,a.jsx)("h3",{children:"Batch"}),(0,a.jsxs)("span",{children:[t.length," file(s)"]})]}),0===t.length&&(0,a.jsx)("p",{className:"root-muted",children:"No uploads yet."}),t.map(((e,t)=>(0,a.jsxs)("button",{className:"root-file "+(t===g?"root-file--active":""),onClick:()=>(e=>{v(e),P("polygon"),F("Polygon mode active. Click along the root area to define ROI.","info")})(t),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:e.name}),(0,a.jsxs)("div",{className:"root-file__meta",children:[e.width," \xd7 ",e.height,"px"]})]}),(0,a.jsx)("div",{className:"root-file__status",children:L.current[e.id]?"Processed":"Pending"})]},e.id)))]}),(0,a.jsxs)("div",{className:"root-settings",children:[(0,a.jsx)("h3",{children:"Automation Settings"}),(0,a.jsxs)("label",{children:["Background threshold (",R.bgThreshold,")",(0,a.jsx)("input",{type:"range",min:"5",max:"120",value:R.bgThreshold,onChange:e=>W("bgThreshold",Number(e.target.value))})]}),(0,a.jsxs)("label",{children:["Noise kernel (",R.noiseKernel,")",(0,a.jsx)("input",{type:"range",min:"1",max:"9",step:"2",value:R.noiseKernel,onChange:e=>W("noiseKernel",Number(e.target.value)||1)})]}),(0,a.jsxs)("label",{children:["Blur radius (",R.blurRadius,"px)",(0,a.jsx)("input",{type:"range",min:"5",max:"50",value:R.blurRadius,onChange:e=>W("blurRadius",Number(e.target.value))})]}),(0,a.jsxs)("label",{children:["ROI threshold (",R.roiThreshold,")",(0,a.jsx)("input",{type:"range",min:"10",max:"80",value:R.roiThreshold,onChange:e=>W("roiThreshold",Number(e.target.value))})]}),(0,a.jsx)("button",{type:"button",className:"root-button ghost",onClick:async()=>{if(!V)return;const e=U.current[V.id];if(!e)return;F("Running fast background cleanup preview...","info"),await Promise.resolve();const t=b(e,R.bgThreshold,R.noiseKernel);M.current[V.id]=t,$(V.id,{previewVersion:Date.now()}),F("Background preview updated.","success")},disabled:!V,children:"Preview Background Cleanup"})]})]}),(0,a.jsxs)("section",{className:"root-main",children:[(0,a.jsxs)("div",{className:"root-canvas-row",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"root-panel-heading",children:[(0,a.jsx)("h3",{children:"Original Preview"}),(0,a.jsx)("span",{className:"root-muted",children:"Read-only"})]}),(0,a.jsx)("canvas",{ref:O,className:"root-canvas"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"root-panel-heading",children:[(0,a.jsx)("h3",{children:"ROI / Processing Canvas"}),(0,a.jsx)("span",{className:"root-muted",children:"polygon"===j?"Click to add polygon points":"Brush to refine"})]}),(0,a.jsx)("canvas",{ref:B,className:"root-canvas "+("manual"===j?"root-canvas--draw":"root-canvas--polygon"),onClick:e=>{if(!V||"polygon"!==j)return;if(L.current[V.id])return void F("Processed result detected. Reset to original to redefine ROI.","warning");const t=B.current;if(!t)return;const{x:o,y:n}=y(e,t);Number.isFinite(o)&&Number.isFinite(n)&&(V.isPolygonClosed?F("Polygon already closed. Reset ROI to add more points.","warning"):V.polygonPoints.length>=c?F(`Point limit (${c}) reached. Close or reset the polygon.`,"warning"):$(V.id,(e=>({polygonPoints:[...e.polygonPoints,{x:o,y:n}],isPolygonClosed:!1}))))}})]})]}),(0,a.jsxs)("div",{className:"root-controls",children:[(0,a.jsxs)("div",{className:"root-controls__group",children:[(0,a.jsx)("h4",{children:"ROI Polygon"}),(0,a.jsx)("p",{children:"Click on the right canvas to trace the region containing the root system."}),(0,a.jsxs)("div",{className:"root-chip-row",children:[(0,a.jsxs)("span",{className:"root-chip",children:["Points: ",V?.polygonPoints.length||0]}),(0,a.jsx)("span",{className:"root-chip",children:V?.isPolygonClosed?"Closed":"Open"})]}),(0,a.jsxs)("div",{className:"root-button-row",children:[(0,a.jsx)("button",{type:"button",className:"root-button",onClick:()=>{V&&(V.polygonPoints.length<3?F("Need at least 3 points to close the polygon.","warning"):($(V.id,{isPolygonClosed:!0}),F("Polygon closed. You can still reset if needed.","success")))},disabled:!V,children:"Close Polygon"}),(0,a.jsx)("button",{type:"button",className:"root-button ghost",onClick:()=>{V&&V.polygonPoints.length&&$(V.id,(e=>({polygonPoints:e.polygonPoints.slice(0,-1),isPolygonClosed:!1})))},disabled:!V,children:"Undo Point"}),(0,a.jsx)("button",{type:"button",className:"root-button ghost",onClick:()=>{V&&($(V.id,{polygonPoints:[],isPolygonClosed:!1}),F("ROI polygon reset.","info"))},disabled:!V,children:"Reset Polygon"})]})]}),(0,a.jsxs)("div",{className:"root-controls__group",children:[(0,a.jsx)("h4",{children:"Automation"}),(0,a.jsx)("p",{children:"Background removal (0_tranbg) and ROI enhancement (1_process) are combined. Use the sliders to tune the binary mask before running."}),(0,a.jsx)("button",{type:"button",className:"root-button primary",onClick:async()=>{if(!V)return void F("Upload an image first.","warning");if(!V.isPolygonClosed)return void F("Close the ROI polygon before processing.","warning");const e=U.current[V.id];if(e){T(!0),F("Processing ROI ... this may take a few seconds.","info"),await Promise.resolve();try{const t=function(e,t,o){const n=document.createElement("canvas");n.width=e,n.height=t;const r=n.getContext("2d");r.fillStyle="#ffffff",r.beginPath(),r.moveTo(o[0].x,o[0].y),o.forEach((e=>r.lineTo(e.x,e.y))),r.closePath(),r.fill();const i=r.getImageData(0,0,e,t).data,s=new Uint8Array(e*t);for(let a=0;a<s.length;a+=1)s[a]=i[4*a];return s}(e.width,e.height,V.polygonPoints),o=b(e,R.bgThreshold,R.noiseKernel);M.current[V.id]=o;const n=function(e,t,o,n){const r=function(e,t){if(t<=0)return x(e);const{width:o,height:n}=e,r=document.createElement("canvas");r.width=o,r.height=n,r.getContext("2d").putImageData(e,0,0);const i=document.createElement("canvas");i.width=o,i.height=n;const s=i.getContext("2d");return s.filter=`blur(${t}px)`,s.drawImage(r,0,0),s.getImageData(0,0,o,n)}(e,o),i=w(e),s=w(r),{width:a,height:l}=e,c=new Float32Array(i.length);let d=1/0,u=-1/0;for(let m=0;m<c.length;m+=1){const e=Math.max(0,s[m]-i[m]);c[m]=e,e<d&&(d=e),e>u&&(u=e)}const h=Math.max(1,u-d),g=new ImageData(a,l),p=g.data;for(let m=0;m<c.length;m+=1){const e=(c[m]-d)/h*255>n?255:0,o=t[m]?255-e:255,r=4*m;p[r]=o,p[r+1]=o,p[r+2]=o,p[r+3]=255}return g}(e,t,R.blurRadius,R.roiThreshold);L.current[V.id]=n,z.current[V.id]=[x(n)],$(V.id,{processedVersion:Date.now(),previewVersion:Date.now(),historySize:1}),P("manual"),F("Processing complete. Switch to manual mode to clean up.","success")}catch(t){console.error(t),F("Processing failed. Try lowering the blur radius or image size.","danger")}finally{T(!1)}}else F("Original image data unavailable.","danger")},disabled:I||!V,children:I?"Processing...":"Run ROI Processing"})]}),(0,a.jsxs)("div",{className:"root-controls__group",children:[(0,a.jsx)("h4",{children:"Manual Cleanup"}),(0,a.jsx)("p",{children:"After automation, switch to manual mode to adjust fine details with brush + undo."}),(0,a.jsxs)("div",{className:"root-button-row",children:[(0,a.jsx)("button",{type:"button",className:"root-button "+("polygon"===j?"primary":"ghost"),onClick:()=>P("polygon"),disabled:!V,children:"Polygon Mode"}),(0,a.jsx)("button",{type:"button",className:"root-button "+("manual"===j?"primary":"ghost"),onClick:()=>{V&&(L.current[V.id]?P("manual"):F("Process the ROI before switching to manual mode.","warning"))},children:"Manual Brush"})]}),(0,a.jsxs)("div",{className:"root-manual-controls",children:[(0,a.jsxs)("label",{children:["Brush mode",(0,a.jsxs)("select",{value:C,onChange:e=>k(e.target.value),children:[(0,a.jsx)("option",{value:"draw",children:"Draw (black)"}),(0,a.jsx)("option",{value:"erase",children:"Erase (white)"})]})]}),(0,a.jsxs)("label",{children:["Brush size (",N,"px)",(0,a.jsx)("input",{type:"range",min:"4",max:"60",value:N,onChange:e=>_(Number(e.target.value))})]}),(0,a.jsx)("button",{type:"button",className:"root-button ghost",onClick:()=>{if(!V)return;const e=z.current[V.id];if(!e||e.length<2)return void F("Nothing to undo.","warning");e.pop();const t=e[e.length-1];L.current[V.id]=x(t),m(B.current,t),$(V.id,{processedVersion:Date.now(),historySize:e.length})},disabled:!V||!L.current[V?.id],children:"Undo Brush Stroke"})]})]}),(0,a.jsxs)("div",{className:"root-controls__group",children:[(0,a.jsx)("h4",{children:"Export"}),(0,a.jsxs)("div",{className:"root-button-row",children:[(0,a.jsx)("button",{type:"button",className:"root-button secondary",onClick:()=>{if(!V)return;const e=L.current[V.id];e?(!function(e,t){const o=document.createElement("canvas");o.width=e.width,o.height=e.height;if(o.getContext("2d").putImageData(e,0,0),o.toBlob)return void o.toBlob((e=>{if(!e)return;const o=URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download=t,n.click(),URL.revokeObjectURL(o)}),"image/png");const n=o.toDataURL("image/png"),r=document.createElement("a");r.href=n,r.download=t,r.click()}(e,`${function(e){const t=e.lastIndexOf(".");return t>0?e.slice(0,t):e}(V.name)}-processed.png`),F("Download triggered.","success")):F("Run processing before downloading.","warning")},disabled:!V,children:"Download Processed PNG"}),(0,a.jsx)("button",{type:"button",className:"root-button ghost",onClick:()=>{V&&(delete L.current[V.id],delete z.current[V.id],$(V.id,{processedVersion:Date.now(),historySize:0}),P("polygon"),F("Processed result cleared. You can redefine the ROI.","info"))},disabled:!V,children:"Reset Processed Result"})]})]})]})]})]}),(0,a.jsx)(i.A,{})]})}):(0,a.jsxs)(r.A,{title:"Root Image Preprocessor",children:[(0,a.jsx)("div",{className:"root-app root-app--placeholder",children:(0,a.jsx)("p",{children:"Loading root preprocessing workspace..."})}),(0,a.jsx)(i.A,{})]})}function p(e){if(!e)return;const t=e.getContext("2d");e.width=640,e.height=360,t.fillStyle="#f5f5f7",t.fillRect(0,0,e.width,e.height),t.setLineDash([6,6]),t.strokeStyle="#d2d2d7",t.strokeRect(16,16,e.width-32,e.height-32),t.setLineDash([]),t.fillStyle="#a1a1a6",t.font="16px Inter, sans-serif",t.textAlign="center",t.fillText("Awaiting image...",e.width/2,e.height/2)}function m(e,t,o=[],n=!1){if(!e||!t)return;const r=e.getContext("2d");e.width=t.width,e.height=t.height,r.putImageData(t,0,0),o.length&&(r.save(),r.strokeStyle="#2188ff",r.fillStyle="rgba(33,136,255,0.12)",r.lineWidth=2,r.beginPath(),r.moveTo(o[0].x,o[0].y),o.forEach((e=>r.lineTo(e.x,e.y))),n&&(r.closePath(),r.fill()),r.stroke(),o.forEach((e=>{r.beginPath(),r.arc(e.x,e.y,4,0,2*Math.PI),r.fillStyle="#ffffff",r.fill(),r.strokeStyle="#2188ff",r.stroke()})),r.restore())}async function f(e){const t=await function(e){return new Promise(((t,o)=>{if("createImageBitmap"in window)return void createImageBitmap(e).then((e=>{t({element:e,width:e.width,height:e.height,revoke:()=>e.close()})})).catch((e=>o(e)));const n=new Image,r=URL.createObjectURL(e);n.onload=()=>{t({element:n,width:n.naturalWidth,height:n.naturalHeight,revoke:()=>URL.revokeObjectURL(r)})},n.onerror=e=>o(e),n.src=r}))}(e),o=Math.min(1,l/Math.max(t.width,t.height)),n=Math.max(1,Math.round(t.width*o)),r=Math.max(1,Math.round(t.height*o)),i=document.createElement("canvas");i.width=n,i.height=r;const s=i.getContext("2d");s.drawImage(t.element,0,0,n,r);const a=s.getImageData(0,0,n,r);return t.revoke&&t.revoke(),{imageData:a,width:n,height:r}}function y(e,t){const o=t.getBoundingClientRect(),n=t.width/o.width,r=t.height/o.height;return{x:Math.round((e.clientX-o.left)*n),y:Math.round((e.clientY-o.top)*r)}}function x(e){return new ImageData(new Uint8ClampedArray(e.data),e.width,e.height)}function b(e,t,o){const{width:n,height:r,data:i}=e,s=w(e),a=new Uint8Array(s.length);for(let u=0;u<s.length;u+=1)a[u]=s[u]>t?255:0;const l=o>1?function(e,t,o,n){const r=function(e,t,o,n){const r=Math.max(1,Math.floor(n/2)),i=new Uint8Array(e.length);for(let s=0;s<o;s+=1)for(let n=0;n<t;n+=1){let a=255;for(let i=-r;i<=r&&a;i+=1){const l=s+i;if(l<0||l>=o){a=0;break}for(let o=-r;o<=r;o+=1){const r=n+o;if(r<0||r>=t||!e[l*t+r]){a=0;break}}}i[s*t+n]=a}return i}(e,t,o,n);return function(e,t,o,n){const r=Math.max(1,Math.floor(n/2)),i=new Uint8Array(e.length);for(let s=0;s<o;s+=1)for(let n=0;n<t;n+=1){let a=0;for(let i=-r;i<=r&&!a;i+=1){const l=s+i;if(!(l<0||l>=o))for(let o=-r;o<=r;o+=1){const r=n+o;if(r>=0&&r<t&&e[l*t+r]){a=255;break}}}i[s*t+n]=a}return i}(r,t,o,n)}(a,n,r,o):a,c=new ImageData(n,r),d=c.data;for(let u=0;u<s.length;u+=1){const e=4*u;l[u]?(d[e]=i[e],d[e+1]=i[e+1],d[e+2]=i[e+2]):(d[e]=255,d[e+1]=255,d[e+2]=255),d[e+3]=255}return c}function w(e){const{data:t,width:o,height:n}=e,r=new Float32Array(o*n);for(let i=0;i<r.length;i+=1){const e=4*i;r[i]=.299*t[e]+.587*t[e+1]+.114*t[e+2]}return r}},95082:(e,t,o)=>{o.d(t,{b:()=>i});var n=o(51270);let r=null;function i(){if(r)return r;if("undefined"==typeof window)return null;const e=window.__SUPABASE_URL__,t=window.__SUPABASE_ANON_KEY__;return e&&t?(r=(0,n.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}),r):null}}}]);