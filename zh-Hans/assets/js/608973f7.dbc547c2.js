"use strict";(self.webpackChunkliangchao_website=self.webpackChunkliangchao_website||[]).push([[7683],{43278:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var r=n(96540),a=n(96995);function s(){const e="undefined"!=typeof window?window.localStorage.getItem("app_users"):null;if(!e)return[];try{return JSON.parse(e)||[]}catch{return[]}}function i(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}async function o(e,t){const n=(new TextEncoder).encode(e),r=function(e){const t=new Uint8Array(e.length/2);for(let n=0;n<t.length;n++)t[n]=parseInt(e.substr(2*n,2),16);return t.buffer}(t),a=await crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveBits"]);return i(await crypto.subtle.deriveBits({name:"PBKDF2",salt:r,iterations:15e4,hash:"SHA-256"},a,256))}async function l(e,t){const n=s();if(n.find((t=>t.email.toLowerCase()===String(e).toLowerCase())))throw new Error("Email already registered");const r=i(crypto.getRandomValues(new Uint8Array(16)).buffer),a=await o(t,r);return n.push({email:e,saltHex:r,hashHex:a,createdAt:(new Date).toISOString()}),function(e){"undefined"!=typeof window&&window.localStorage.setItem("app_users",JSON.stringify(e))}(n),u({email:e}),{email:e}}function d(){if("undefined"==typeof window)return null;const e=window.localStorage.getItem("app_session");if(!e)return null;try{return JSON.parse(e)||null}catch{return null}}function u(e){"undefined"!=typeof window&&window.localStorage.setItem("app_session",JSON.stringify({email:e.email,at:Date.now()}))}var c=n(51270);let p=null;function g(){if(p)return p;if("undefined"==typeof window)return null;const e=window.__SUPABASE_URL__,t=window.__SUPABASE_ANON_KEY__;return e&&t?(p=(0,c.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}),p):null}var f=n(74848);function h(){const[e,t]=(0,r.useState)(null),n=d(),[i,c]=(0,r.useState)(n||e?"profile":"login"),[p,h]=(0,r.useState)(""),[w,m]=(0,r.useState)(""),[y,b]=(0,r.useState)(""),[v,x]=(0,r.useState)("");return(0,r.useEffect)((()=>{const e=g();if(!e)return;e.auth.getUser().then((({data:e})=>{e?.user&&(t(e.user),c("profile"))}));const{data:n}=e.auth.onAuthStateChange(((e,n)=>{t(n?.user||null),n?.user&&c("profile")}));return()=>n?.subscription?.unsubscribe?.()}),[]),(0,f.jsx)(a.A,{title:"Account",children:(0,f.jsxs)("div",{className:"app-container",style:{maxWidth:560},children:[(0,f.jsxs)("div",{className:"app-header",style:{marginBottom:12},children:[(0,f.jsx)("h1",{className:"app-title",children:"Account"}),(0,f.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,f.jsx)("button",{className:"button button--secondary",onClick:()=>c("login"),children:"Login"}),(0,f.jsx)("button",{className:"button button--secondary",onClick:()=>c("register"),children:"Register"})]})]}),"login"===i&&(0,f.jsx)("div",{className:"app-card",children:(0,f.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,f.jsx)("input",{type:"email",placeholder:"Email",value:p,onChange:e=>h(e.target.value),style:{padding:12,border:"1px solid var(--ifm-border-color)",borderRadius:8}}),(0,f.jsx)("input",{type:"password",placeholder:"Password",value:w,onChange:e=>m(e.target.value),style:{padding:12,border:"1px solid var(--ifm-border-color)",borderRadius:8}}),(0,f.jsx)("button",{className:"button button--primary",onClick:async function(){x("");const e=g();if(e){const{data:n,error:r}=await e.auth.signInWithPassword({email:p,password:w});return r?void x(r.message):(t(n.user),void c("profile"))}try{await async function(e,t){const n=s().find((t=>t.email.toLowerCase()===String(e).toLowerCase()));if(!n)throw new Error("Account not found");if(await o(t,n.saltHex)!==n.hashHex)throw new Error("Invalid credentials");return u({email:e}),{email:e}}(p,w),x("Logged in"),c("profile")}catch(n){x(String(n.message||n))}},children:"Login"})]})}),"register"===i&&(0,f.jsx)("div",{className:"app-card",children:(0,f.jsxs)("div",{style:{display:"grid",gap:12},children:[(0,f.jsx)("input",{type:"email",placeholder:"Email",value:p,onChange:e=>h(e.target.value),style:{padding:12,border:"1px solid var(--ifm-border-color)",borderRadius:8}}),(0,f.jsx)("input",{type:"password",placeholder:"Password",value:w,onChange:e=>m(e.target.value),style:{padding:12,border:"1px solid var(--ifm-border-color)",borderRadius:8}}),(0,f.jsx)("input",{type:"password",placeholder:"Confirm Password",value:y,onChange:e=>b(e.target.value),style:{padding:12,border:"1px solid var(--ifm-border-color)",borderRadius:8}}),(0,f.jsx)("button",{className:"button button--primary",onClick:async function(){if(x(""),!p||!w)return void x("Enter email and password");if(w!==y)return void x("Passwords do not match");const e=g();if(e){const{data:t,error:n}=await e.auth.signUp({email:p,password:w});return n?void x(n.message):void x("Registered. Please check your email to confirm.")}try{await l(p,w),x("Registered and logged in"),c("profile")}catch(t){x(String(t.message||t))}},children:"Register"})]})}),"profile"===i&&(0,f.jsxs)("div",{className:"app-card",style:{display:"grid",gap:12},children:[(0,f.jsxs)("div",{children:["Signed in as ",e?.email||d()?.email]}),(0,f.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,f.jsx)("a",{className:"button button--secondary",href:"/app",children:"Go to Apps"}),(0,f.jsx)("button",{className:"button button--secondary",onClick:async function(){const e=g();e&&(await e.auth.signOut(),t(null)),"undefined"!=typeof window&&window.localStorage.removeItem("app_session"),c("login"),x("Logged out")},children:"Logout"})]})]}),v&&(0,f.jsx)("p",{className:"app-muted",style:{marginTop:12},children:v})]})})}}}]);