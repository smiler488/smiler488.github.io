"use strict";(self.webpackChunkliangchao_website=self.webpackChunkliangchao_website||[]).push([[7137],{2835:(e,t,o)=>{o.d(t,{A:()=>u});var n=o(6540),r=o(4848);const i={maxWidth:"800px",margin:"60px auto 0",textAlign:"left",padding:"0 20px"},s={fontSize:"2rem",fontWeight:"600",marginBottom:"16px",color:"#000000"},a={fontSize:"1.1rem",color:"#333333",lineHeight:1.6,marginBottom:"16px"},l={borderLeft:"4px solid #cccccc",paddingLeft:"16px",color:"#333333",fontStyle:"italic",lineHeight:1.6,marginBottom:"16px"},c={backgroundColor:"#f6f6f7",padding:"16px",borderRadius:"12px",overflowX:"auto",border:"1px solid #e5e5e7"},d={fontSize:"1.5rem",fontWeight:"600",marginBottom:"16px",color:"#000000"};function u({containerStyle:e}){const[t,o]=(0,n.useState)(!1),[u,h]=(0,n.useState)(!1),g="LiangchaoDeng. (2025). smiler488/smiler488.github.io: Digital Plant Phenotyping Platform v25.0 (v25.0.0). Zenodo. https://doi.org/10.5281/zenodo.17544584",p="@software{Deng2025_DPPP_v25,\n  author       = {Deng, Liangchao},\n  title        = {Digital Plant Phenotyping Platform (v25.0)},\n  year         = {2025},\n  publisher    = {Zenodo},\n  doi          = {10.5281/zenodo.17544584},\n  url          = {https://doi.org/10.5281/zenodo.17544584},\n  note         = {[Computer software]}\n}";return(0,r.jsxs)("div",{style:{...i,...e},children:[(0,r.jsx)("h2",{style:s,children:"Citation"}),(0,r.jsxs)("p",{style:a,children:["If you use ",(0,r.jsx)("strong",{children:"Digital Plant Phenotyping Platform v25.0"})," or any of its applications in your research, please cite it as:"]}),(0,r.jsxs)("blockquote",{style:l,children:["LiangchaoDeng. (2025)."," ",(0,r.jsx)("em",{children:"smiler488/smiler488.github.io: Digital Plant Phenotyping Platform v25.0 (v25.0.0)"}),". Zenodo.",(0,r.jsx)("br",{}),(0,r.jsx)("a",{href:"https://doi.org/10.5281/zenodo.17544584",children:"https://doi.org/10.5281/zenodo.17544584"})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",gap:"12px"},children:[(0,r.jsx)("button",{type:"button",onClick:async()=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(g);else if("undefined"!=typeof document){const e=document.createElement("textarea");e.value=g,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}o(!0),setTimeout((()=>o(!1)),2e3)}catch{o(!1)}},style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid #000000",backgroundColor:"#000000",color:"#ffffff",cursor:"pointer",fontSize:"0.95rem",fontWeight:500,transition:"transform 0.15s ease, background-color 0.15s ease"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="#333333",e.currentTarget.style.transform="translateY(-1px)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="#000000",e.currentTarget.style.transform="translateY(0)"},children:t?"Copied!":"Copy citation"}),(0,r.jsx)("span",{style:{fontSize:"0.9rem",color:t?"#007f5f":"#6c6c70"},children:t?"Citation copied to clipboard.":"Click to copy APA citation."})]}),(0,r.jsx)("a",{href:"https://doi.org/10.5281/zenodo.17544584",style:{display:"inline-block",marginBottom:"24px"},children:(0,r.jsx)("img",{src:"https://zenodo.org/badge/DOI/10.5281/zenodo.17544584.svg",alt:"DOI badge",style:{height:"32px"}})}),(0,r.jsx)("hr",{style:{border:"none",borderTop:"1px solid #e5e5e7",marginBottom:"24px"}}),(0,r.jsx)("h3",{style:d,children:"BibTeX citation (Zotero \u2192 File \u2192 Import from Clipboard)"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",gap:"12px"},children:[(0,r.jsx)("button",{type:"button",onClick:async()=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(p);else if("undefined"!=typeof document){const e=document.createElement("textarea");e.value=p,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}h(!0),setTimeout((()=>h(!1)),2e3)}catch{h(!1)}},style:{padding:"8px 16px",borderRadius:"8px",border:"1px solid #000000",backgroundColor:"#000000",color:"#ffffff",cursor:"pointer",fontSize:"0.95rem",fontWeight:500,transition:"transform 0.15s ease, background-color 0.15s ease"},onMouseOver:e=>{e.currentTarget.style.backgroundColor="#333333",e.currentTarget.style.transform="translateY(-1px)"},onMouseOut:e=>{e.currentTarget.style.backgroundColor="#000000",e.currentTarget.style.transform="translateY(0)"},children:u?"Copied!":"Copy BibTeX"}),(0,r.jsx)("span",{style:{fontSize:"0.9rem",color:u?"#007f5f":"#6c6c70"},children:u?"BibTeX copied to clipboard. Switch to Zotero and choose Import from Clipboard.":"Click to copy BibTeX to clipboard for Zotero import."})]}),(0,r.jsx)("pre",{style:c,children:(0,r.jsx)("code",{children:p})})]})}},5227:(e,t,o)=>{o.r(t),o.d(t,{default:()=>h});var n=o(6540),r=o(3018),i=o(2835),s=o(4848);const a=1800,l=60,c=10,d={bgThreshold:35,noiseKernel:3,blurRadius:24,roiThreshold:32},u={info:"root-status--info",success:"root-status--success",warning:"root-status--warning",danger:"root-status--danger"};function h(){const e="undefined"!=typeof window,[t,o]=(0,n.useState)([]),[h,v]=(0,n.useState)(0),[w,j]=(0,n.useState)("polygon"),[C,P]=(0,n.useState)("draw"),[k,N]=(0,n.useState)(14),[R,I]=(0,n.useState)(d),[T,S]=(0,n.useState)(!1),[D,O]=(0,n.useState)({text:"Upload JPG/PNG scans of root systems to begin.",tone:"info"}),B=(0,n.useRef)(null),L=(0,n.useRef)(null),_=(0,n.useRef)(null),E=(0,n.useRef)({}),A=(0,n.useRef)({}),M=(0,n.useRef)({}),z=(0,n.useRef)({}),U=(0,n.useRef)(!1),V=(0,n.useRef)(null),$=t[h]||null,W=(e,t="info")=>O({text:e,tone:t}),F=(0,n.useCallback)(((e,t)=>{o((o=>o.map((o=>{if(o.id!==e)return o;const n="function"==typeof t?t(o):t;return{...o,...n}}))))}),[]),Y=(e,t)=>{I((o=>({...o,[e]:t})))},K=(0,n.useCallback)((()=>{if(!$)return;const e=L.current;if(!e)return;const t=e.getContext("2d").getImageData(0,0,e.width,e.height);A.current[$.id]=t;const o=z.current[$.id]||[];o.push(x(t)),o.length>c&&o.shift(),z.current[$.id]=o,F($.id,{processedVersion:Date.now(),historySize:o.length})}),[$,F]),X=(0,n.useCallback)((e=>{if(!$||"manual"!==w)return;if(!A.current[$.id])return W("Run auto-processing before manual editing.","warning"),void(U.current=!1);const t=L.current;if(!t)return;const o=t.getContext("2d");o.lineCap="round",o.lineJoin="round",o.strokeStyle="draw"===C?"#000000":"#ffffff",o.lineWidth=k;const n=f(e,t);if(Number.isFinite(n.x)&&Number.isFinite(n.y))if(U.current){o.beginPath();const e=V.current||n;o.moveTo(e.x,e.y),o.lineTo(n.x,n.y),o.stroke(),V.current=n}else U.current=!0,V.current=n,o.beginPath(),o.moveTo(n.x,n.y),o.lineTo(n.x+.1,n.y+.1),o.stroke()}),[$,w,C,k,W]);return(0,n.useEffect)((()=>{if(!e)return;const t=L.current;if(!t)return;const o=e=>{"manual"===w&&X(e)},n=e=>{"manual"===w&&U.current&&(e.preventDefault(),X(e))},r=()=>{U.current&&(U.current=!1,V.current=null,K())};return t.addEventListener("pointerdown",o),t.addEventListener("pointermove",n),window.addEventListener("pointerup",r),t.addEventListener("pointerleave",r),()=>{t.removeEventListener("pointerdown",o),t.removeEventListener("pointermove",n),window.removeEventListener("pointerup",r),t.removeEventListener("pointerleave",r)}}),[w,X,K,e]),(0,n.useEffect)((()=>{if(!$)return g(B.current),void g(L.current);const e=E.current[$.id];e&&p(B.current,e)}),[$]),(0,n.useEffect)((()=>{if(!$)return void g(L.current);const e=A.current[$.id];if(e&&"manual"===w)return void p(L.current,e);const t=M.current[$.id];if(t)return void p(L.current,t,$.polygonPoints,$.isPolygonClosed);const o=E.current[$.id];o&&p(L.current,o,$.polygonPoints,$.isPolygonClosed)}),[$,$?.previewVersion,$?.processedVersion,$?.polygonPoints,$?.isPolygonClosed,w]),e?(0,s.jsx)(r.A,{title:"Root Image Preprocessor",children:(0,s.jsxs)("div",{className:"root-app",children:[(0,s.jsxs)("div",{className:"root-app__header",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{children:"Root Image Preprocessor"}),(0,s.jsx)("p",{children:"Combine automated background removal with ROI high-pass filtering and manual cleanup directly in the browser. Inspired by 0_tranbg.py + 1_process.py."})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("a",{className:"button button--secondary",href:"/docs/tutorial-apps/root-preprocessor-tutorial",children:"Tutorial"}),(0,s.jsx)("button",{type:"button",className:"root-button secondary",onClick:()=>_.current?.click(),children:"Upload Images"})]})]}),(0,s.jsx)("div",{className:`root-status ${u[D.tone]||""}`,children:D.text}),(0,s.jsxs)("div",{className:"root-app__grid",children:[(0,s.jsxs)("aside",{className:"root-sidebar",children:[(0,s.jsxs)("div",{className:"root-upload",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",multiple:!0,ref:_,onChange:async n=>{if(!e)return;const r=Array.from(n.target.files||[]);if(!r.length)return;const i=t.length;W(`Loading ${r.length} image(s)...`,"info");const s=[];for(const e of r)try{const{imageData:t,width:o,height:n}=await m(e),r=`${e.name}-${Date.now()}-${Math.random().toString(16).slice(2)}`;E.current[r]=t,M.current[r]=x(t),s.push({id:r,name:e.name,width:o,height:n,polygonPoints:[],isPolygonClosed:!1,processedVersion:0,previewVersion:0,historySize:0})}catch(a){console.error(a),W(`Unable to read ${e.name}`,"warning")}s.length&&(o((e=>[...e,...s])),v(0===i?0:i),W("Images loaded. Select ROI points on the right canvas.","success")),n.target.value=""}}),(0,s.jsxs)("p",{children:["Drag & drop or pick files. Images larger than ",a,"px on the longest edge are scaled."]})]}),(0,s.jsxs)("div",{className:"root-filelist",children:[(0,s.jsxs)("div",{className:"root-filelist__header",children:[(0,s.jsx)("h3",{children:"Batch"}),(0,s.jsxs)("span",{children:[t.length," file(s)"]})]}),0===t.length&&(0,s.jsx)("p",{className:"root-muted",children:"No uploads yet."}),t.map(((e,t)=>(0,s.jsxs)("button",{className:"root-file "+(t===h?"root-file--active":""),onClick:()=>(e=>{v(e),j("polygon"),W("Polygon mode active. Click along the root area to define ROI.","info")})(t),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:e.name}),(0,s.jsxs)("div",{className:"root-file__meta",children:[e.width," \xd7 ",e.height,"px"]})]}),(0,s.jsx)("div",{className:"root-file__status",children:A.current[e.id]?"Processed":"Pending"})]},e.id)))]}),(0,s.jsxs)("div",{className:"root-settings",children:[(0,s.jsx)("h3",{children:"Automation Settings"}),(0,s.jsxs)("label",{children:["Background threshold (",R.bgThreshold,")",(0,s.jsx)("input",{type:"range",min:"5",max:"120",value:R.bgThreshold,onChange:e=>Y("bgThreshold",Number(e.target.value))})]}),(0,s.jsxs)("label",{children:["Noise kernel (",R.noiseKernel,")",(0,s.jsx)("input",{type:"range",min:"1",max:"9",step:"2",value:R.noiseKernel,onChange:e=>Y("noiseKernel",Number(e.target.value)||1)})]}),(0,s.jsxs)("label",{children:["Blur radius (",R.blurRadius,"px)",(0,s.jsx)("input",{type:"range",min:"5",max:"50",value:R.blurRadius,onChange:e=>Y("blurRadius",Number(e.target.value))})]}),(0,s.jsxs)("label",{children:["ROI threshold (",R.roiThreshold,")",(0,s.jsx)("input",{type:"range",min:"10",max:"80",value:R.roiThreshold,onChange:e=>Y("roiThreshold",Number(e.target.value))})]}),(0,s.jsx)("button",{type:"button",className:"root-button ghost",onClick:async()=>{if(!$)return;const e=E.current[$.id];if(!e)return;W("Running fast background cleanup preview...","info"),await Promise.resolve();const t=y(e,R.bgThreshold,R.noiseKernel);M.current[$.id]=t,F($.id,{previewVersion:Date.now()}),W("Background preview updated.","success")},disabled:!$,children:"Preview Background Cleanup"})]})]}),(0,s.jsxs)("section",{className:"root-main",children:[(0,s.jsxs)("div",{className:"root-canvas-row",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"root-panel-heading",children:[(0,s.jsx)("h3",{children:"Original Preview"}),(0,s.jsx)("span",{className:"root-muted",children:"Read-only"})]}),(0,s.jsx)("canvas",{ref:B,className:"root-canvas"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"root-panel-heading",children:[(0,s.jsx)("h3",{children:"ROI / Processing Canvas"}),(0,s.jsx)("span",{className:"root-muted",children:"polygon"===w?"Click to add polygon points":"Brush to refine"})]}),(0,s.jsx)("canvas",{ref:L,className:"root-canvas "+("manual"===w?"root-canvas--draw":"root-canvas--polygon"),onClick:e=>{if(!$||"polygon"!==w)return;if(A.current[$.id])return void W("Processed result detected. Reset to original to redefine ROI.","warning");const t=L.current;if(!t)return;const{x:o,y:n}=f(e,t);Number.isFinite(o)&&Number.isFinite(n)&&($.isPolygonClosed?W("Polygon already closed. Reset ROI to add more points.","warning"):$.polygonPoints.length>=l?W(`Point limit (${l}) reached. Close or reset the polygon.`,"warning"):F($.id,(e=>({polygonPoints:[...e.polygonPoints,{x:o,y:n}],isPolygonClosed:!1}))))}})]})]}),(0,s.jsxs)("div",{className:"root-controls",children:[(0,s.jsxs)("div",{className:"root-controls__group",children:[(0,s.jsx)("h4",{children:"ROI Polygon"}),(0,s.jsx)("p",{children:"Click on the right canvas to trace the region containing the root system."}),(0,s.jsxs)("div",{className:"root-chip-row",children:[(0,s.jsxs)("span",{className:"root-chip",children:["Points: ",$?.polygonPoints.length||0]}),(0,s.jsx)("span",{className:"root-chip",children:$?.isPolygonClosed?"Closed":"Open"})]}),(0,s.jsxs)("div",{className:"root-button-row",children:[(0,s.jsx)("button",{type:"button",className:"root-button",onClick:()=>{$&&($.polygonPoints.length<3?W("Need at least 3 points to close the polygon.","warning"):(F($.id,{isPolygonClosed:!0}),W("Polygon closed. You can still reset if needed.","success")))},disabled:!$,children:"Close Polygon"}),(0,s.jsx)("button",{type:"button",className:"root-button ghost",onClick:()=>{$&&$.polygonPoints.length&&F($.id,(e=>({polygonPoints:e.polygonPoints.slice(0,-1),isPolygonClosed:!1})))},disabled:!$,children:"Undo Point"}),(0,s.jsx)("button",{type:"button",className:"root-button ghost",onClick:()=>{$&&(F($.id,{polygonPoints:[],isPolygonClosed:!1}),W("ROI polygon reset.","info"))},disabled:!$,children:"Reset Polygon"})]})]}),(0,s.jsxs)("div",{className:"root-controls__group",children:[(0,s.jsx)("h4",{children:"Automation"}),(0,s.jsx)("p",{children:"Background removal (0_tranbg) and ROI enhancement (1_process) are combined. Use the sliders to tune the binary mask before running."}),(0,s.jsx)("button",{type:"button",className:"root-button primary",onClick:async()=>{if(!$)return void W("Upload an image first.","warning");if(!$.isPolygonClosed)return void W("Close the ROI polygon before processing.","warning");const e=E.current[$.id];if(e){S(!0),W("Processing ROI ... this may take a few seconds.","info"),await Promise.resolve();try{const t=function(e,t,o){const n=document.createElement("canvas");n.width=e,n.height=t;const r=n.getContext("2d");r.fillStyle="#ffffff",r.beginPath(),r.moveTo(o[0].x,o[0].y),o.forEach((e=>r.lineTo(e.x,e.y))),r.closePath(),r.fill();const i=r.getImageData(0,0,e,t).data,s=new Uint8Array(e*t);for(let a=0;a<s.length;a+=1)s[a]=i[4*a];return s}(e.width,e.height,$.polygonPoints),o=y(e,R.bgThreshold,R.noiseKernel);M.current[$.id]=o;const n=function(e,t,o,n){const r=function(e,t){if(t<=0)return x(e);const{width:o,height:n}=e,r=document.createElement("canvas");r.width=o,r.height=n,r.getContext("2d").putImageData(e,0,0);const i=document.createElement("canvas");i.width=o,i.height=n;const s=i.getContext("2d");return s.filter=`blur(${t}px)`,s.drawImage(r,0,0),s.getImageData(0,0,o,n)}(e,o),i=b(e),s=b(r),{width:a,height:l}=e,c=new Float32Array(i.length);let d=1/0,u=-1/0;for(let m=0;m<c.length;m+=1){const e=Math.max(0,s[m]-i[m]);c[m]=e,e<d&&(d=e),e>u&&(u=e)}const h=Math.max(1,u-d),g=new ImageData(a,l),p=g.data;for(let m=0;m<c.length;m+=1){const e=(c[m]-d)/h*255>n?255:0,o=t[m]?255-e:255,r=4*m;p[r]=o,p[r+1]=o,p[r+2]=o,p[r+3]=255}return g}(e,t,R.blurRadius,R.roiThreshold);A.current[$.id]=n,z.current[$.id]=[x(n)],F($.id,{processedVersion:Date.now(),previewVersion:Date.now(),historySize:1}),j("manual"),W("Processing complete. Switch to manual mode to clean up.","success")}catch(t){console.error(t),W("Processing failed. Try lowering the blur radius or image size.","danger")}finally{S(!1)}}else W("Original image data unavailable.","danger")},disabled:T||!$,children:T?"Processing...":"Run ROI Processing"})]}),(0,s.jsxs)("div",{className:"root-controls__group",children:[(0,s.jsx)("h4",{children:"Manual Cleanup"}),(0,s.jsx)("p",{children:"After automation, switch to manual mode to adjust fine details with brush + undo."}),(0,s.jsxs)("div",{className:"root-button-row",children:[(0,s.jsx)("button",{type:"button",className:"root-button "+("polygon"===w?"primary":"ghost"),onClick:()=>j("polygon"),disabled:!$,children:"Polygon Mode"}),(0,s.jsx)("button",{type:"button",className:"root-button "+("manual"===w?"primary":"ghost"),onClick:()=>{$&&(A.current[$.id]?j("manual"):W("Process the ROI before switching to manual mode.","warning"))},children:"Manual Brush"})]}),(0,s.jsxs)("div",{className:"root-manual-controls",children:[(0,s.jsxs)("label",{children:["Brush mode",(0,s.jsxs)("select",{value:C,onChange:e=>P(e.target.value),children:[(0,s.jsx)("option",{value:"draw",children:"Draw (black)"}),(0,s.jsx)("option",{value:"erase",children:"Erase (white)"})]})]}),(0,s.jsxs)("label",{children:["Brush size (",k,"px)",(0,s.jsx)("input",{type:"range",min:"4",max:"60",value:k,onChange:e=>N(Number(e.target.value))})]}),(0,s.jsx)("button",{type:"button",className:"root-button ghost",onClick:()=>{if(!$)return;const e=z.current[$.id];if(!e||e.length<2)return void W("Nothing to undo.","warning");e.pop();const t=e[e.length-1];A.current[$.id]=x(t),p(L.current,t),F($.id,{processedVersion:Date.now(),historySize:e.length})},disabled:!$||!A.current[$?.id],children:"Undo Brush Stroke"})]})]}),(0,s.jsxs)("div",{className:"root-controls__group",children:[(0,s.jsx)("h4",{children:"Export"}),(0,s.jsxs)("div",{className:"root-button-row",children:[(0,s.jsx)("button",{type:"button",className:"root-button secondary",onClick:()=>{if(!$)return;const e=A.current[$.id];e?(!function(e,t){const o=document.createElement("canvas");o.width=e.width,o.height=e.height;if(o.getContext("2d").putImageData(e,0,0),o.toBlob)return void o.toBlob((e=>{if(!e)return;const o=URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download=t,n.click(),URL.revokeObjectURL(o)}),"image/png");const n=o.toDataURL("image/png"),r=document.createElement("a");r.href=n,r.download=t,r.click()}(e,`${function(e){const t=e.lastIndexOf(".");return t>0?e.slice(0,t):e}($.name)}-processed.png`),W("Download triggered.","success")):W("Run processing before downloading.","warning")},disabled:!$,children:"Download Processed PNG"}),(0,s.jsx)("button",{type:"button",className:"root-button ghost",onClick:()=>{$&&(delete A.current[$.id],delete z.current[$.id],F($.id,{processedVersion:Date.now(),historySize:0}),j("polygon"),W("Processed result cleared. You can redefine the ROI.","info"))},disabled:!$,children:"Reset Processed Result"})]})]})]})]})]}),(0,s.jsx)(i.A,{})]})}):(0,s.jsxs)(r.A,{title:"Root Image Preprocessor",children:[(0,s.jsx)("div",{className:"root-app root-app--placeholder",children:(0,s.jsx)("p",{children:"Loading root preprocessing workspace..."})}),(0,s.jsx)(i.A,{})]})}function g(e){if(!e)return;const t=e.getContext("2d");e.width=640,e.height=360,t.fillStyle="#f5f5f7",t.fillRect(0,0,e.width,e.height),t.setLineDash([6,6]),t.strokeStyle="#d2d2d7",t.strokeRect(16,16,e.width-32,e.height-32),t.setLineDash([]),t.fillStyle="#a1a1a6",t.font="16px Inter, sans-serif",t.textAlign="center",t.fillText("Awaiting image...",e.width/2,e.height/2)}function p(e,t,o=[],n=!1){if(!e||!t)return;const r=e.getContext("2d");e.width=t.width,e.height=t.height,r.putImageData(t,0,0),o.length&&(r.save(),r.strokeStyle="#2188ff",r.fillStyle="rgba(33,136,255,0.12)",r.lineWidth=2,r.beginPath(),r.moveTo(o[0].x,o[0].y),o.forEach((e=>r.lineTo(e.x,e.y))),n&&(r.closePath(),r.fill()),r.stroke(),o.forEach((e=>{r.beginPath(),r.arc(e.x,e.y,4,0,2*Math.PI),r.fillStyle="#ffffff",r.fill(),r.strokeStyle="#2188ff",r.stroke()})),r.restore())}async function m(e){const t=await function(e){return new Promise(((t,o)=>{if("createImageBitmap"in window)return void createImageBitmap(e).then((e=>{t({element:e,width:e.width,height:e.height,revoke:()=>e.close()})})).catch((e=>o(e)));const n=new Image,r=URL.createObjectURL(e);n.onload=()=>{t({element:n,width:n.naturalWidth,height:n.naturalHeight,revoke:()=>URL.revokeObjectURL(r)})},n.onerror=e=>o(e),n.src=r}))}(e),o=Math.min(1,a/Math.max(t.width,t.height)),n=Math.max(1,Math.round(t.width*o)),r=Math.max(1,Math.round(t.height*o)),i=document.createElement("canvas");i.width=n,i.height=r;const s=i.getContext("2d");s.drawImage(t.element,0,0,n,r);const l=s.getImageData(0,0,n,r);return t.revoke&&t.revoke(),{imageData:l,width:n,height:r}}function f(e,t){const o=t.getBoundingClientRect(),n=t.width/o.width,r=t.height/o.height;return{x:Math.round((e.clientX-o.left)*n),y:Math.round((e.clientY-o.top)*r)}}function x(e){return new ImageData(new Uint8ClampedArray(e.data),e.width,e.height)}function y(e,t,o){const{width:n,height:r,data:i}=e,s=b(e),a=new Uint8Array(s.length);for(let u=0;u<s.length;u+=1)a[u]=s[u]>t?255:0;const l=o>1?function(e,t,o,n){const r=function(e,t,o,n){const r=Math.max(1,Math.floor(n/2)),i=new Uint8Array(e.length);for(let s=0;s<o;s+=1)for(let n=0;n<t;n+=1){let a=255;for(let i=-r;i<=r&&a;i+=1){const l=s+i;if(l<0||l>=o){a=0;break}for(let o=-r;o<=r;o+=1){const r=n+o;if(r<0||r>=t||!e[l*t+r]){a=0;break}}}i[s*t+n]=a}return i}(e,t,o,n);return function(e,t,o,n){const r=Math.max(1,Math.floor(n/2)),i=new Uint8Array(e.length);for(let s=0;s<o;s+=1)for(let n=0;n<t;n+=1){let a=0;for(let i=-r;i<=r&&!a;i+=1){const l=s+i;if(!(l<0||l>=o))for(let o=-r;o<=r;o+=1){const r=n+o;if(r>=0&&r<t&&e[l*t+r]){a=255;break}}}i[s*t+n]=a}return i}(r,t,o,n)}(a,n,r,o):a,c=new ImageData(n,r),d=c.data;for(let u=0;u<s.length;u+=1){const e=4*u;l[u]?(d[e]=i[e],d[e+1]=i[e+1],d[e+2]=i[e+2]):(d[e]=255,d[e+1]=255,d[e+2]=255),d[e+3]=255}return c}function b(e){const{data:t,width:o,height:n}=e,r=new Float32Array(o*n);for(let i=0;i<r.length;i+=1){const e=4*i;r[i]=.299*t[e]+.587*t[e+1]+.114*t[e+2]}return r}}}]);